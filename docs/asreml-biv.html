<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.2 Asreml-R | How to fit an animal model</title>
  <meta name="description" content="Updated and extended tutorials from An ecologist guide to animal model (Wilson et al. 2010)" />
  <meta name="generator" content="bookdown 0.30 and GitBook 2.6.7" />

  <meta property="og:title" content="3.2 Asreml-R | How to fit an animal model" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/images/missing.png" />
  <meta property="og:description" content="Updated and extended tutorials from An ecologist guide to animal model (Wilson et al. 2010)" />
  <meta name="github-repo" content="JulienGAMartin/wam_tuto" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.2 Asreml-R | How to fit an animal model" />
  
  <meta name="twitter:description" content="Updated and extended tutorials from An ecologist guide to animal model (Wilson et al. 2010)" />
  <meta name="twitter:image" content="/images/missing.png" />

<meta name="author" content="Julien Martin" />
<meta name="author" content="Matthieu Videlier" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="scenario-and-data-1.html"/>
<link rel="next" href="gremlin-2.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">How to fit an animal model</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i>Contributors</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>1.1</b> Data</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="data.html"><a href="data.html#data-files"><i class="fa fa-check"></i><b>1.1.1</b> Data files</a></li>
<li class="chapter" data-level="1.1.2" data-path="data.html"><a href="data.html#notes-on-data-and-pedigree"><i class="fa fa-check"></i><b>1.1.2</b> Notes on data and pedigree</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="r.html"><a href="r.html"><i class="fa fa-check"></i><b>1.2</b> R</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="r.html"><a href="r.html#r-packages"><i class="fa fa-check"></i><b>1.2.1</b> R packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="univariate-animal-model.html"><a href="univariate-animal-model.html"><i class="fa fa-check"></i><b>2</b> Univariate animal model</a>
<ul>
<li class="chapter" data-level="2.1" data-path="scenario-and-data.html"><a href="scenario-and-data.html"><i class="fa fa-check"></i><b>2.1</b> Scenario and data</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="scenario-and-data.html"><a href="scenario-and-data.html#scenario"><i class="fa fa-check"></i><b>2.1.1</b> Scenario</a></li>
<li class="chapter" data-level="2.1.2" data-path="scenario-and-data.html"><a href="scenario-and-data.html#data-files-1"><i class="fa fa-check"></i><b>2.1.2</b> Data files</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="asreml-r-1.html"><a href="asreml-r-1.html"><i class="fa fa-check"></i><b>2.2</b> Asreml-R</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="asreml-r-1.html"><a href="asreml-r-1.html#running-the-model"><i class="fa fa-check"></i><b>2.2.1</b> Running the model</a></li>
<li class="chapter" data-level="2.2.2" data-path="asreml-r-1.html"><a href="asreml-r-1.html#estimating-heritability"><i class="fa fa-check"></i><b>2.2.2</b> Estimating heritability</a></li>
<li class="chapter" data-level="2.2.3" data-path="asreml-r-1.html"><a href="asreml-r-1.html#adding-fixed-effects"><i class="fa fa-check"></i><b>2.2.3</b> Adding fixed effects</a></li>
<li class="chapter" data-level="2.2.4" data-path="asreml-r-1.html"><a href="asreml-r-1.html#adding-random-effects"><i class="fa fa-check"></i><b>2.2.4</b> Adding random effects</a></li>
<li class="chapter" data-level="2.2.5" data-path="asreml-r-1.html"><a href="asreml-r-1.html#testing-significance-of-random-effects"><i class="fa fa-check"></i><b>2.2.5</b> Testing significance of random effects</a></li>
<li class="chapter" data-level="2.2.6" data-path="asreml-r-1.html"><a href="asreml-r-1.html#further-partitioning-the-variance"><i class="fa fa-check"></i><b>2.2.6</b> Further partitioning the variance</a></li>
<li class="chapter" data-level="2.2.7" data-path="asreml-r-1.html"><a href="asreml-r-1.html#modification-of-the-varaince-matrix-parameters"><i class="fa fa-check"></i><b>2.2.7</b> Modification of the varaince matrix parameters</a></li>
<li class="chapter" data-level="2.2.8" data-path="asreml-r-1.html"><a href="asreml-r-1.html#covariance-between-two-random-effects"><i class="fa fa-check"></i><b>2.2.8</b> Covariance between two random effects</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="gremlin-1.html"><a href="gremlin-1.html"><i class="fa fa-check"></i><b>2.3</b> gremlin</a></li>
<li class="chapter" data-level="2.4" data-path="mcmcglmm-1.html"><a href="mcmcglmm-1.html"><i class="fa fa-check"></i><b>2.4</b> MCMCglmm</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="mcmcglmm-1.html"><a href="mcmcglmm-1.html#running-the-model-1"><i class="fa fa-check"></i><b>2.4.1</b> Running the model</a></li>
<li class="chapter" data-level="2.4.2" data-path="mcmcglmm-1.html"><a href="mcmcglmm-1.html#change-in-iteration-and-sampling"><i class="fa fa-check"></i><b>2.4.2</b> Change in iteration and sampling</a></li>
<li class="chapter" data-level="2.4.3" data-path="mcmcglmm-1.html"><a href="mcmcglmm-1.html#change-priors-parameters"><i class="fa fa-check"></i><b>2.4.3</b> Change priors parameters</a></li>
<li class="chapter" data-level="2.4.4" data-path="mcmcglmm-1.html"><a href="mcmcglmm-1.html#estimating-heritability-1"><i class="fa fa-check"></i><b>2.4.4</b> Estimating heritability</a></li>
<li class="chapter" data-level="2.4.5" data-path="mcmcglmm-1.html"><a href="mcmcglmm-1.html#adding-fixed-effects-1"><i class="fa fa-check"></i><b>2.4.5</b> Adding fixed effects</a></li>
<li class="chapter" data-level="2.4.6" data-path="mcmcglmm-1.html"><a href="mcmcglmm-1.html#adding-random-effects-1"><i class="fa fa-check"></i><b>2.4.6</b> Adding random effects</a></li>
<li class="chapter" data-level="2.4.7" data-path="mcmcglmm-1.html"><a href="mcmcglmm-1.html#testing-significance-of-variance-components"><i class="fa fa-check"></i><b>2.4.7</b> Testing significance of variance components</a></li>
<li class="chapter" data-level="2.4.8" data-path="mcmcglmm-1.html"><a href="mcmcglmm-1.html#further-partitioning-variance"><i class="fa fa-check"></i><b>2.4.8</b> Further partitioning variance</a></li>
<li class="chapter" data-level="2.4.9" data-path="mcmcglmm-1.html"><a href="mcmcglmm-1.html#modification-of-model-parameter"><i class="fa fa-check"></i><b>2.4.9</b> Modification of model parameter</a></li>
<li class="chapter" data-level="2.4.10" data-path="mcmcglmm-1.html"><a href="mcmcglmm-1.html#covariance-between-two-random-effects-1"><i class="fa fa-check"></i><b>2.4.10</b> Covariance between two random effects</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="brms-1.html"><a href="brms-1.html"><i class="fa fa-check"></i><b>2.5</b> brms</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="brms-1.html"><a href="brms-1.html#running-the-model-2"><i class="fa fa-check"></i><b>2.5.1</b> Running the model</a></li>
<li class="chapter" data-level="2.5.2" data-path="brms-1.html"><a href="brms-1.html#adding-fixed-effects-2"><i class="fa fa-check"></i><b>2.5.2</b> Adding fixed effects</a></li>
<li class="chapter" data-level="2.5.3" data-path="brms-1.html"><a href="brms-1.html#adding-random-effects-2"><i class="fa fa-check"></i><b>2.5.3</b> Adding random effects</a></li>
<li class="chapter" data-level="2.5.4" data-path="brms-1.html"><a href="brms-1.html#testing-significance-of-variance-components-1"><i class="fa fa-check"></i><b>2.5.4</b> Testing significance of variance components</a></li>
<li class="chapter" data-level="2.5.5" data-path="brms-1.html"><a href="brms-1.html#further-partitioning-of-the-variance"><i class="fa fa-check"></i><b>2.5.5</b> Further partitioning of the variance</a></li>
<li class="chapter" data-level="2.5.6" data-path="brms-1.html"><a href="brms-1.html#modification-of-model-parameter-1"><i class="fa fa-check"></i><b>2.5.6</b> Modification of model parameter</a></li>
<li class="chapter" data-level="2.5.7" data-path="brms-1.html"><a href="brms-1.html#covariance-between-two-random-effects-2"><i class="fa fa-check"></i><b>2.5.7</b> Covariance between two random effects</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="stan.html"><a href="stan.html"><i class="fa fa-check"></i><b>2.6</b> stan</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="multivariate-animal-model.html"><a href="multivariate-animal-model.html"><i class="fa fa-check"></i><b>3</b> Multivariate animal model</a>
<ul>
<li class="chapter" data-level="3.1" data-path="scenario-and-data-1.html"><a href="scenario-and-data-1.html"><i class="fa fa-check"></i><b>3.1</b> Scenario and data</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="scenario-and-data-1.html"><a href="scenario-and-data-1.html#scenario-1"><i class="fa fa-check"></i><b>3.1.1</b> Scenario</a></li>
<li class="chapter" data-level="3.1.2" data-path="scenario-and-data-1.html"><a href="scenario-and-data-1.html#gryphon-files"><i class="fa fa-check"></i><b>3.1.2</b> gryphon files</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="asreml-biv.html"><a href="asreml-biv.html"><i class="fa fa-check"></i><b>3.2</b> Asreml-R</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="asreml-biv.html"><a href="asreml-biv.html#running-the-model-3"><i class="fa fa-check"></i><b>3.2.1</b> Running the model</a></li>
<li class="chapter" data-level="3.2.2" data-path="asreml-biv.html"><a href="asreml-biv.html#adding-fixed-and-random-effects"><i class="fa fa-check"></i><b>3.2.2</b> Adding fixed and random effects</a></li>
<li class="chapter" data-level="3.2.3" data-path="asreml-biv.html"><a href="asreml-biv.html#significance-testing"><i class="fa fa-check"></i><b>3.2.3</b> Significance testing</a></li>
<li class="chapter" data-level="3.2.4" data-path="asreml-biv.html"><a href="asreml-biv.html#estimate-directly-the-genetic-correlation-within-the-model"><i class="fa fa-check"></i><b>3.2.4</b> Estimate directly the genetic correlation within the model</a></li>
<li class="chapter" data-level="3.2.5" data-path="asreml-biv.html"><a href="asreml-biv.html#visualisation-of-the-correlation-aka-blup-extraction"><i class="fa fa-check"></i><b>3.2.5</b> Visualisation of the correlation (aka BLUP extraction)</a></li>
<li class="chapter" data-level="3.2.6" data-path="asreml-biv.html"><a href="asreml-biv.html#partitionning-covariance-between-groups"><i class="fa fa-check"></i><b>3.2.6</b> Partitionning (co)variance between groups</a></li>
<li class="chapter" data-level="3.2.7" data-path="asreml-biv.html"><a href="asreml-biv.html#between-groups-covariances-and-the-b-matrix"><i class="fa fa-check"></i><b>3.2.7</b> Between groups (co)variances and the B-matrix</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="gremlin-2.html"><a href="gremlin-2.html"><i class="fa fa-check"></i><b>3.3</b> gremlin</a></li>
<li class="chapter" data-level="3.4" data-path="mcmcglmm-2.html"><a href="mcmcglmm-2.html"><i class="fa fa-check"></i><b>3.4</b> MCMCglmm</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="mcmcglmm-2.html"><a href="mcmcglmm-2.html#fitting-the-model"><i class="fa fa-check"></i><b>3.4.1</b> Fitting the model</a></li>
<li class="chapter" data-level="3.4.2" data-path="mcmcglmm-2.html"><a href="mcmcglmm-2.html#adding-fixed-and-random-effects-1"><i class="fa fa-check"></i><b>3.4.2</b> Adding fixed and random effects</a></li>
<li class="chapter" data-level="3.4.3" data-path="mcmcglmm-2.html"><a href="mcmcglmm-2.html#direct-estimate-of-the-correlation-instead-of-the-covariance."><i class="fa fa-check"></i><b>3.4.3</b> Direct estimate of the correlation instead of the covariance.</a></li>
<li class="chapter" data-level="3.4.4" data-path="mcmcglmm-2.html"><a href="mcmcglmm-2.html#partitioning-covariances"><i class="fa fa-check"></i><b>3.4.4</b> Partitioning (co)variances</a></li>
<li class="chapter" data-level="3.4.5" data-path="mcmcglmm-2.html"><a href="mcmcglmm-2.html#between-groups-covariances-and-the-b-matrix-1"><i class="fa fa-check"></i><b>3.4.5</b> Between groups (co)variances and the B-matrix</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="brms-2.html"><a href="brms-2.html"><i class="fa fa-check"></i><b>3.5</b> brms</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="brms-2.html"><a href="brms-2.html#fitting-the-model-1"><i class="fa fa-check"></i><b>3.5.1</b> Fitting the model</a></li>
<li class="chapter" data-level="3.5.2" data-path="brms-2.html"><a href="brms-2.html#adding-fixed-and-random-effects-2"><i class="fa fa-check"></i><b>3.5.2</b> Adding fixed and random effects</a></li>
<li class="chapter" data-level="3.5.3" data-path="brms-2.html"><a href="brms-2.html#partitioning-covariances-1"><i class="fa fa-check"></i><b>3.5.3</b> Partitioning (co)variances</a></li>
<li class="chapter" data-level="3.5.4" data-path="brms-2.html"><a href="brms-2.html#between-groups-covariances-and-the-b-matrix-2"><i class="fa fa-check"></i><b>3.5.4</b> Between groups (co)variances and the B-matrix</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="stan-1.html"><a href="stan-1.html"><i class="fa fa-check"></i><b>3.6</b> stan</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rep_measures.html"><a href="rep_measures.html"><i class="fa fa-check"></i><b>4</b> A repeated measures animal model</a>
<ul>
<li class="chapter" data-level="4.1" data-path="scenario-and-data-2.html"><a href="scenario-and-data-2.html"><i class="fa fa-check"></i><b>4.1</b> Scenario and data</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="scenario-and-data-2.html"><a href="scenario-and-data-2.html#scenario-2"><i class="fa fa-check"></i><b>4.1.1</b> scenario</a></li>
<li class="chapter" data-level="4.1.2" data-path="scenario-and-data-2.html"><a href="scenario-and-data-2.html#data-files-2"><i class="fa fa-check"></i><b>4.1.2</b> Data files</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="asreml-r-2.html"><a href="asreml-r-2.html"><i class="fa fa-check"></i><b>4.2</b> Asreml-R</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="asreml-r-2.html"><a href="asreml-r-2.html#estimating-repeatability"><i class="fa fa-check"></i><b>4.2.1</b> Estimating repeatability</a></li>
<li class="chapter" data-level="4.2.2" data-path="asreml-r-2.html"><a href="asreml-r-2.html#partitioning-additive-and-permanent-environment-effects"><i class="fa fa-check"></i><b>4.2.2</b> Partitioning additive and permanent environment effects</a></li>
<li class="chapter" data-level="4.2.3" data-path="asreml-r-2.html"><a href="asreml-r-2.html#adding-additional-effects-and-testing-significance"><i class="fa fa-check"></i><b>4.2.3</b> Adding additional effects and testing significance</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="gremlin-3.html"><a href="gremlin-3.html"><i class="fa fa-check"></i><b>4.3</b> gremlin</a></li>
<li class="chapter" data-level="4.4" data-path="mcmcglmm-3.html"><a href="mcmcglmm-3.html"><i class="fa fa-check"></i><b>4.4</b> MCMCglmm</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="mcmcglmm-3.html"><a href="mcmcglmm-3.html#estimating-repeatability-1"><i class="fa fa-check"></i><b>4.4.1</b> Estimating repeatability</a></li>
<li class="chapter" data-level="4.4.2" data-path="mcmcglmm-3.html"><a href="mcmcglmm-3.html#partitioning-additive-and-permanent-environment-effects-1"><i class="fa fa-check"></i><b>4.4.2</b> Partitioning additive and permanent environment effects</a></li>
<li class="chapter" data-level="4.4.3" data-path="mcmcglmm-3.html"><a href="mcmcglmm-3.html#adding-additional-effects-and-testing-significance-1"><i class="fa fa-check"></i><b>4.4.3</b> Adding additional effects and testing significance</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="brms-3.html"><a href="brms-3.html"><i class="fa fa-check"></i><b>4.5</b> brms</a></li>
<li class="chapter" data-level="4.6" data-path="stan-2.html"><a href="stan-2.html"><i class="fa fa-check"></i><b>4.6</b> stan</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="quick-comparison-of-codes.html"><a href="quick-comparison-of-codes.html"><i class="fa fa-check"></i><b>5</b> Quick comparison of codes</a>
<ul>
<li class="chapter" data-level="5.1" data-path="univariate-model-with-repeated-measures.html"><a href="univariate-model-with-repeated-measures.html"><i class="fa fa-check"></i><b>5.1</b> Univariate model with repeated measures</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="univariate-model-with-repeated-measures.html"><a href="univariate-model-with-repeated-measures.html#asreml-r-3"><i class="fa fa-check"></i><b>5.1.1</b> Asreml-R</a></li>
<li class="chapter" data-level="5.1.2" data-path="univariate-model-with-repeated-measures.html"><a href="univariate-model-with-repeated-measures.html#gremlin-4"><i class="fa fa-check"></i><b>5.1.2</b> gremlin</a></li>
<li class="chapter" data-level="5.1.3" data-path="univariate-model-with-repeated-measures.html"><a href="univariate-model-with-repeated-measures.html#mcmcglmm-4"><i class="fa fa-check"></i><b>5.1.3</b> MCMCglmm</a></li>
<li class="chapter" data-level="5.1.4" data-path="univariate-model-with-repeated-measures.html"><a href="univariate-model-with-repeated-measures.html#brms-4"><i class="fa fa-check"></i><b>5.1.4</b> brms</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="bivariate-model.html"><a href="bivariate-model.html"><i class="fa fa-check"></i><b>5.2</b> bivariate model</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="bivariate-model.html"><a href="bivariate-model.html#asreml-r-4"><i class="fa fa-check"></i><b>5.2.1</b> Asreml-R</a></li>
<li class="chapter" data-level="5.2.2" data-path="bivariate-model.html"><a href="bivariate-model.html#gremlin-5"><i class="fa fa-check"></i><b>5.2.2</b> gremlin</a></li>
<li class="chapter" data-level="5.2.3" data-path="bivariate-model.html"><a href="bivariate-model.html#mcmcglmm-5"><i class="fa fa-check"></i><b>5.2.3</b> MCMCglmm</a></li>
<li class="chapter" data-level="5.2.4" data-path="bivariate-model.html"><a href="bivariate-model.html#brms-5"><i class="fa fa-check"></i><b>5.2.4</b> brms</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="_blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">How to fit an animal model</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="asreml-biv" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Asreml-R<a href="asreml-biv.html#asreml-biv" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="running-the-model-3" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Running the model<a href="asreml-biv.html#running-the-model-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>First we need to load the <code>asreml</code> library:</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="asreml-biv.html#cb199-1" aria-hidden="true"></a><span class="kw">library</span>(asreml)</span></code></pre></div>
<p>For running multivariate analyses in ASReml-R, the code is slightly more complex than for the univariate case. This is because ASReml-R allows us to make different assumptions about the way in which traits might be related. We need to explicitly specify a covariance structure with difference covariance functions <code>us()</code>, <code>idh()</code> or <code>corgh()</code> which for example would estimate an unconstrained (co)variance matrix, an identity matrix and a variance and correlation matrix repestively. We can also specify some starting values for the variance matrices. These can be very approximate <em>guestimates</em> or not at all, but having reasonable starting values can help convergence. It is also possible to let the model running without specifying starting values. Finally, we have increased the default maximum number of iterations (<code>maxiter</code>) which can help to achieve convergence for more complicated models. Another way to increase the number of iteration will be to use the <code>update</code> function. Notes that if the <code>LogLik</code> is not stabilized after several iterations, it is good indication of the model require more iteration.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="asreml-biv.html#cb200-1" aria-hidden="true"></a>ainv &lt;-<span class="st"> </span><span class="kw">ainverse</span>(gryphonped)</span>
<span id="cb200-2"><a href="asreml-biv.html#cb200-2" aria-hidden="true"></a>modela &lt;-<span class="st"> </span><span class="kw">asreml</span>(</span>
<span id="cb200-3"><a href="asreml-biv.html#cb200-3" aria-hidden="true"></a>  <span class="dt">fixed =</span> <span class="kw">cbind</span>(bwt, tarsus) <span class="op">~</span><span class="st"> </span>trait,</span>
<span id="cb200-4"><a href="asreml-biv.html#cb200-4" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span><span class="kw">vm</span>(animal, ainv),</span>
<span id="cb200-5"><a href="asreml-biv.html#cb200-5" aria-hidden="true"></a>  <span class="dt">residual =</span> <span class="op">~</span><span class="st"> </span><span class="kw">id</span>(units)<span class="op">:</span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>)),</span>
<span id="cb200-6"><a href="asreml-biv.html#cb200-6" aria-hidden="true"></a>  <span class="dt">data =</span> gryphon,</span>
<span id="cb200-7"><a href="asreml-biv.html#cb200-7" aria-hidden="true"></a>  <span class="dt">na.action =</span> <span class="kw">na.method</span>(<span class="dt">x =</span> <span class="st">&quot;include&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;include&quot;</span>),</span>
<span id="cb200-8"><a href="asreml-biv.html#cb200-8" aria-hidden="true"></a>  <span class="dt">maxit =</span> <span class="dv">20</span></span>
<span id="cb200-9"><a href="asreml-biv.html#cb200-9" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## Model fitted using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:09 2022
##           LogLik        Sigma2     DF     wall    cpu
##  1     -7108.741           1.0   1535 16:50:09    0.0
##  2     -5837.803           1.0   1535 16:50:09    0.0
##  3     -4437.495           1.0   1535 16:50:09    0.0
##  4     -3459.378           1.0   1535 16:50:09    0.0
##  5     -2914.034           1.0   1535 16:50:09    0.0
##  6     -2729.131           1.0   1535 16:50:09    0.0
##  7     -2684.659           1.0   1535 16:50:09    0.0
##  8     -2679.838           1.0   1535 16:50:09    0.0
##  9     -2679.742           1.0   1535 16:50:09    0.0
## 10     -2679.741           1.0   1535 16:50:09    0.0</code></pre>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="asreml-biv.html#cb202-1" aria-hidden="true"></a>modela &lt;-<span class="st"> </span><span class="kw">update</span>(modela)</span></code></pre></div>
<pre><code>## Model fitted using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:10 2022
##           LogLik        Sigma2     DF     wall    cpu
##  1     -2679.741           1.0   1535 16:50:10    0.0
##  2     -2679.741           1.0   1535 16:50:10    0.0</code></pre>
<p><code>modela</code> has fitted a bivariate model of <code>bwt</code> and <code>tarsus</code>, with the mean for each of the traits as a fixed effect (<code>trait</code>). The additive genetic variance-covariance matrix (<span class="math inline">\(\textbf{G}\)</span>) is unstructured (<code>us</code>; <em>i.e.</em> all elements are free to vary) and the starting values for <span class="math inline">\(V_A\)</span> for <code>bwt</code>, <span class="math inline">\(COV_A\)</span> between <code>bwt</code> and <code>tarsus</code>, and <span class="math inline">\(V_A\)</span> for <code>tarsus</code> are set to 1, 0.1 and 1, respectively. Similarly, the residual matrix is unstructured and uses the same starting values.</p>
<p>Note that the argument <code>na.action = na.method(x = "include", y = "include")</code> can be added to the model. In a bivariate model, it will help calculate the covariance between two traits with different missing information <code>NA</code> and so help imbalance phenotypage and save sample size. However, it is important to scale ( mean =0, var =1) the two traits to correctly adjust the model(see Asreml-R manual for more information).</p>
<p>Let’s have a look at the variance components, and notice that there are now seven (co)variance components reported in the table:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="asreml-biv.html#cb204-1" aria-hidden="true"></a><span class="kw">summary</span>(modela)<span class="op">$</span>varcomp</span></code></pre></div>
<pre><code>##                                            component std.error  z.ratio bound
## trait:vm(animal, ainv)!trait_bwt:bwt        3.368397 0.6348307 5.305977     P
## trait:vm(animal, ainv)!trait_tarsus:bwt     2.459809 1.0732644 2.291895     P
## trait:vm(animal, ainv)!trait_tarsus:tarsus 12.345792 3.0744285 4.015638     P
## units:trait!R                               1.000000        NA       NA     F
## units:trait!trait_bwt:bwt                   3.849916 0.5200101 7.403541     P
## units:trait!trait_tarsus:bwt                3.313282 0.9129234 3.629310     P
## units:trait!trait_tarsus:tarsus            17.646432 2.6670380 6.616491     P
##                                            %ch
## trait:vm(animal, ainv)!trait_bwt:bwt         0
## trait:vm(animal, ainv)!trait_tarsus:bwt      0
## trait:vm(animal, ainv)!trait_tarsus:tarsus   0
## units:trait!R                                0
## units:trait!trait_bwt:bwt                    0
## units:trait!trait_tarsus:bwt                 0
## units:trait!trait_tarsus:tarsus              0</code></pre>
<p>The first three terms are related to the genetic matrix and, in order are <span class="math inline">\(V_{A,bwt}\)</span>, <span class="math inline">\(COV_A\)</span>, <span class="math inline">\(V_{A, tarsus}\)</span>. Below is again a line where the <code>units:traitr!R</code> component equals to 1, which again can be ignored. The final three terms relate to the residual matrix and correspond to <span class="math inline">\(V_{R,bwt}\)</span>, <span class="math inline">\(COV_R\)</span>, <span class="math inline">\(V_{R,tarsus}\)</span>. Based on our quick and dirty check (is <code>z.ratio</code> &gt; 1.96?) all components look to be statistically significant.</p>
<p>We can calculate the genetic correlation as <span class="math inline">\(COV_A / \sqrt{V_{A,bwt} \cdot V_{A,tarsus}}\)</span>. Thus this model gives an estimate of <span class="math inline">\(r_A\)</span> = 0.38. It is also possible to estimate the residual correlation <span class="math inline">\(r_{res}\)</span> = 0.4.
<!-- C1 issue the annotation of the residual correlation--></p>
<p>Both correlations are distinct in nature. The genetic correlation reflects how much the traits are linked by genetic via polygenic effect or linkage desequilibrium, whereas the residual correlation reflects the environmental correlation or errors measurement correlation.</p>
<p>Although we can calculate this by hand, we can also use <code>vpredict()</code>, which also provides an (approximate) standard error:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="asreml-biv.html#cb206-1" aria-hidden="true"></a><span class="kw">vpredict</span>(modela, r_A <span class="op">~</span><span class="st"> </span>V2 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(V1 <span class="op">*</span><span class="st"> </span>V3))</span></code></pre></div>
<pre><code>##      Estimate        SE
## r_A 0.3814436 0.1299759</code></pre>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="asreml-biv.html#cb208-1" aria-hidden="true"></a><span class="kw">vpredict</span>(modela, r_res <span class="op">~</span><span class="st"> </span>V6 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(V5 <span class="op">*</span><span class="st"> </span>V7))</span></code></pre></div>
<pre><code>##        Estimate         SE
## r_res 0.4019799 0.08607104</code></pre>
<p>Of course we can also calculate the heritability of <code>bwt</code> and <code>tarsus</code> from this model:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="asreml-biv.html#cb210-1" aria-hidden="true"></a><span class="kw">vpredict</span>(modela, h2.bwt <span class="op">~</span><span class="st"> </span>V1 <span class="op">/</span><span class="st"> </span>(V1 <span class="op">+</span><span class="st"> </span>V5))</span></code></pre></div>
<pre><code>##        Estimate         SE
## h2.bwt 0.466646 0.07671533</code></pre>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="asreml-biv.html#cb212-1" aria-hidden="true"></a><span class="kw">vpredict</span>(modela, h2.tarsus <span class="op">~</span><span class="st"> </span>V3 <span class="op">/</span><span class="st"> </span>(V3 <span class="op">+</span><span class="st"> </span>V7))</span></code></pre></div>
<pre><code>##            Estimate         SE
## h2.tarsus 0.4116331 0.09305863</code></pre>
</div>
<div id="adding-fixed-and-random-effects" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Adding fixed and random effects<a href="asreml-biv.html#adding-fixed-and-random-effects" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Fixed and random effects can be added just as for the univariate case. Given that our full model of bwt from tutorial 1 had sex as a fixed effect as well as birth year and mother as random effects, we could specify a bivariate formulation with the same complexity:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="asreml-biv.html#cb214-1" aria-hidden="true"></a>modelb &lt;-<span class="st"> </span><span class="kw">asreml</span>(</span>
<span id="cb214-2"><a href="asreml-biv.html#cb214-2" aria-hidden="true"></a>  <span class="dt">fixed =</span> <span class="kw">cbind</span>(bwt, tarsus) <span class="op">~</span><span class="st"> </span>trait <span class="op">+</span><span class="st"> </span><span class="kw">at</span>(trait)<span class="op">:</span>sex,</span>
<span id="cb214-3"><a href="asreml-biv.html#cb214-3" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span><span class="kw">vm</span>(animal, ainv) <span class="op">+</span></span>
<span id="cb214-4"><a href="asreml-biv.html#cb214-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span>byear <span class="op">+</span></span>
<span id="cb214-5"><a href="asreml-biv.html#cb214-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span>mother,</span>
<span id="cb214-6"><a href="asreml-biv.html#cb214-6" aria-hidden="true"></a>  <span class="dt">residual =</span> <span class="op">~</span><span class="st"> </span><span class="kw">id</span>(units)<span class="op">:</span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>)),</span>
<span id="cb214-7"><a href="asreml-biv.html#cb214-7" aria-hidden="true"></a>  <span class="dt">data =</span> gryphon,</span>
<span id="cb214-8"><a href="asreml-biv.html#cb214-8" aria-hidden="true"></a>  <span class="dt">na.action =</span> <span class="kw">na.method</span>(<span class="dt">x =</span> <span class="st">&quot;include&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;include&quot;</span>),</span>
<span id="cb214-9"><a href="asreml-biv.html#cb214-9" aria-hidden="true"></a>  <span class="dt">maxit =</span> <span class="dv">20</span></span>
<span id="cb214-10"><a href="asreml-biv.html#cb214-10" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## Model fitted using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:10 2022
##           LogLik        Sigma2     DF     wall    cpu
##  1     -4672.301           1.0   1533 16:50:10    0.0
##  2     -4005.615           1.0   1533 16:50:10    0.0
##  3     -3271.483           1.0   1533 16:50:10    0.0 (1 restrained)
##  4     -2761.414           1.0   1533 16:50:10    0.0 (1 restrained)
##  5     -2481.357           1.0   1533 16:50:10    0.0
##  6     -2395.858           1.0   1533 16:50:10    0.0
##  7     -2381.050           1.0   1533 16:50:10    0.0
##  8     -2380.251           1.0   1533 16:50:10    0.0
##  9     -2380.246           1.0   1533 16:50:10    0.0</code></pre>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="asreml-biv.html#cb216-1" aria-hidden="true"></a>modelb &lt;-<span class="st"> </span><span class="kw">update</span>(modelb)</span></code></pre></div>
<pre><code>## Model fitted using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:10 2022
##           LogLik        Sigma2     DF     wall    cpu
##  1     -2380.246           1.0   1533 16:50:10    0.1
##  2     -2380.246           1.0   1533 16:50:10    0.0</code></pre>
<p>Note that we have specified a covariance structure for each random effect and an estimate of the effect of sex on both birth weight and tarsus length.</p>
<p>There will now be thirteen (co)variance components reported after running the code:</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="asreml-biv.html#cb218-1" aria-hidden="true"></a><span class="kw">summary</span>(modelb)<span class="op">$</span>varcomp</span></code></pre></div>
<pre><code>##                                             component std.error    z.ratio
## trait:byear!trait_bwt:bwt                   0.9746385 0.2825727  3.4491602
## trait:byear!trait_tarsus:bwt                0.1624076 0.4185079  0.3880635
## trait:byear!trait_tarsus:tarsus             3.7383721 1.2065992  3.0982716
## trait:mother!trait_bwt:bwt                  1.1445184 0.2302182  4.9714512
## trait:mother!trait_tarsus:bwt              -1.5567306 0.4051848 -3.8420260
## trait:mother!trait_tarsus:tarsus            4.8206132 1.3201300  3.6516202
## trait:vm(animal, ainv)!trait_bwt:bwt        1.9893546 0.4410246  4.5107569
## trait:vm(animal, ainv)!trait_tarsus:bwt     3.3170404 0.9032323  3.6724110
## trait:vm(animal, ainv)!trait_tarsus:tarsus 10.2294887 2.8077066  3.6433610
## units:trait!R                               1.0000000        NA         NA
## units:trait!trait_bwt:bwt                   1.8443110 0.3443178  5.3564203
## units:trait!trait_tarsus:bwt                4.0142841 0.7412540  5.4155308
## units:trait!trait_tarsus:tarsus            12.4845955 2.2893363  5.4533690
##                                            bound %ch
## trait:byear!trait_bwt:bwt                      P   0
## trait:byear!trait_tarsus:bwt                   P   0
## trait:byear!trait_tarsus:tarsus                P   0
## trait:mother!trait_bwt:bwt                     P   0
## trait:mother!trait_tarsus:bwt                  P   0
## trait:mother!trait_tarsus:tarsus               P   0
## trait:vm(animal, ainv)!trait_bwt:bwt           P   0
## trait:vm(animal, ainv)!trait_tarsus:bwt        P   0
## trait:vm(animal, ainv)!trait_tarsus:tarsus     P   0
## units:trait!R                                  F   0
## units:trait!trait_bwt:bwt                      P   0
## units:trait!trait_tarsus:bwt                   P   0
## units:trait!trait_tarsus:tarsus                P   0</code></pre>
<p>we can estimate the different correlations using <code>vpredict</code>:</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="asreml-biv.html#cb220-1" aria-hidden="true"></a><span class="kw">vpredict</span>(modelb, r_byear <span class="op">~</span><span class="st"> </span>V2 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(V1 <span class="op">*</span><span class="st"> </span>V3))</span></code></pre></div>
<pre><code>##           Estimate        SE
## r_byear 0.08508312 0.2134209</code></pre>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="asreml-biv.html#cb222-1" aria-hidden="true"></a><span class="kw">vpredict</span>(modelb, r_M <span class="op">~</span><span class="st"> </span>V5 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(V4 <span class="op">*</span><span class="st"> </span>V6))</span></code></pre></div>
<pre><code>##       Estimate        SE
## r_M -0.6627518 0.2487963</code></pre>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="asreml-biv.html#cb224-1" aria-hidden="true"></a><span class="kw">vpredict</span>(modelb, r_A <span class="op">~</span><span class="st"> </span>V8 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(V7 <span class="op">*</span><span class="st"> </span>V9))</span></code></pre></div>
<pre><code>##      Estimate        SE
## r_A 0.7353053 0.1094747</code></pre>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="asreml-biv.html#cb226-1" aria-hidden="true"></a><span class="kw">vpredict</span>(modelb, r_res <span class="op">~</span><span class="st"> </span>V12 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(V11 <span class="op">*</span><span class="st"> </span>V13))</span></code></pre></div>
<pre><code>##        Estimate         SE
## r_res 0.8365729 0.07366762</code></pre>
<p>Now we can look at the fixed effects parameters and assess their significance with a conditional Wald F-test:</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="asreml-biv.html#cb228-1" aria-hidden="true"></a><span class="kw">summary</span>(modelb, <span class="dt">coef =</span> <span class="ot">TRUE</span>)<span class="op">$</span>coef.fi</span></code></pre></div>
<pre><code>##                           solution std error    z.ratio
## at(trait, tarsus):sex_1  0.0000000        NA         NA
## at(trait, tarsus):sex_2 -0.0684413 0.3823448 -0.1790041
## at(trait, bwt):sex_1     0.0000000        NA         NA
## at(trait, bwt):sex_2     1.9502053 0.1480467 13.1729086
## trait_bwt                6.3844483 0.2328210 27.4221324
## trait_tarsus            20.5936436 0.5098944 40.3880569</code></pre>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="asreml-biv.html#cb230-1" aria-hidden="true"></a><span class="kw">wald.asreml</span>(modelb, <span class="dt">denDF =</span> <span class="st">&quot;default&quot;</span>, <span class="dt">ssType =</span> <span class="st">&quot;conditional&quot;</span>)<span class="op">$</span>Wald</span></code></pre></div>
<pre><code>## Model fitted using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:10 2022
##           LogLik        Sigma2     DF     wall    cpu
##  1     -2380.246           1.0   1533 16:50:11    0.1
##  2     -2380.246           1.0   1533 16:50:11    0.0
## Calculating denominator DF</code></pre>
<pre><code>## [0;34m
## Wald tests for fixed effects.[0m
## [0;34mResponse: cbind(bwt, tarsus)[0m
## 
##                       Df denDF   F.inc   F.con Margin      Pr
## trait                  2  52.6 1396.00 1396.00        0.00000
## at(trait, bwt):sex     1 812.8  298.40  173.50      B 0.00000
## at(trait, tarsus):sex  1 747.9    0.03    0.03      B 0.85798</code></pre>
<p>Note that it is possible to specify a fixed effect to a specific trait by adding the number of order within <code>cbind</code> inside the argument <code>at(trait,x)</code>. For example, here we apply the fixed effect <code>sex</code> only to the response variable <code>tarsus</code>.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="asreml-biv.html#cb233-1" aria-hidden="true"></a>modelb_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">asreml</span>(</span>
<span id="cb233-2"><a href="asreml-biv.html#cb233-2" aria-hidden="true"></a>  <span class="dt">fixed =</span> <span class="kw">cbind</span>(bwt, tarsus) <span class="op">~</span><span class="st"> </span>trait <span class="op">+</span><span class="st"> </span><span class="kw">at</span>(trait, <span class="dv">2</span>)<span class="op">:</span>sex,</span>
<span id="cb233-3"><a href="asreml-biv.html#cb233-3" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span><span class="kw">vm</span>(animal, ainv) <span class="op">+</span></span>
<span id="cb233-4"><a href="asreml-biv.html#cb233-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span>byear <span class="op">+</span></span>
<span id="cb233-5"><a href="asreml-biv.html#cb233-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span>mother,</span>
<span id="cb233-6"><a href="asreml-biv.html#cb233-6" aria-hidden="true"></a>  <span class="dt">residual =</span> <span class="op">~</span><span class="st"> </span><span class="kw">id</span>(units)<span class="op">:</span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>)),</span>
<span id="cb233-7"><a href="asreml-biv.html#cb233-7" aria-hidden="true"></a>  <span class="dt">data =</span> gryphon,</span>
<span id="cb233-8"><a href="asreml-biv.html#cb233-8" aria-hidden="true"></a>  <span class="dt">na.action =</span> <span class="kw">na.method</span>(<span class="dt">x =</span> <span class="st">&quot;include&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;include&quot;</span>),</span>
<span id="cb233-9"><a href="asreml-biv.html#cb233-9" aria-hidden="true"></a>  <span class="dt">maxit =</span> <span class="dv">20</span></span>
<span id="cb233-10"><a href="asreml-biv.html#cb233-10" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## Model fitted using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:11 2022
##           LogLik        Sigma2     DF     wall    cpu
##  1     -4810.563           1.0   1534 16:50:11    0.0
##  2     -4129.799           1.0   1534 16:50:11    0.0
##  3     -3382.529           1.0   1534 16:50:11    0.0 (1 restrained)
##  4     -2864.076           1.0   1534 16:50:11    0.0
##  5     -2574.891           1.0   1534 16:50:11    0.0
##  6     -2478.879           1.0   1534 16:50:11    0.0
##  7     -2458.305           1.0   1534 16:50:11    0.0
##  8     -2456.425           1.0   1534 16:50:11    0.0
##  9     -2456.377           1.0   1534 16:50:11    0.0
## 10     -2456.376           1.0   1534 16:50:11    0.0</code></pre>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="asreml-biv.html#cb235-1" aria-hidden="true"></a><span class="kw">summary</span>(modelb_<span class="dv">2</span>, <span class="dt">coef =</span> <span class="ot">TRUE</span>)<span class="op">$</span>coef.fi</span></code></pre></div>
<pre><code>##                          solution std error   z.ratio
## at(trait, tarsus):sex_1  0.000000        NA        NA
## at(trait, tarsus):sex_2 -3.267042 0.2953279 -11.06242
## trait_bwt                7.636226 0.2389515  31.95722
## trait_tarsus            22.703658 0.4827348  47.03133</code></pre>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="asreml-biv.html#cb237-1" aria-hidden="true"></a><span class="kw">wald.asreml</span>(modelb_<span class="dv">2</span>, <span class="dt">denDF =</span> <span class="st">&quot;default&quot;</span>, <span class="dt">ssType =</span> <span class="st">&quot;conditional&quot;</span>)<span class="op">$</span>Wald</span></code></pre></div>
<pre><code>## Model fitted using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:11 2022
##           LogLik        Sigma2     DF     wall    cpu
##  1     -2456.376           1.0   1534 16:50:11    0.1
##  2     -2456.376           1.0   1534 16:50:12    0.0
## Calculating denominator DF</code></pre>
<pre><code>## [0;34m
## Wald tests for fixed effects.[0m
## [0;34mResponse: cbind(bwt, tarsus)[0m
## 
##                       Df denDF  F.inc  F.con Margin          Pr
## trait                  2  50.7 1233.0 1233.0        0.00000e+00
## at(trait, tarsus):sex  1 522.9  122.4  122.4      B 1.02886e-25</code></pre>
</div>
<div id="significance-testing" class="section level3 hasAnchor" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Significance testing<a href="asreml-biv.html#significance-testing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Under the model above <span class="math inline">\(r_M\)</span> is estimated as -0.66 and the <code>z.ratio</code> associated with the corresponding covariance (<span class="math inline">\(COV_M\)</span>) is &gt;2 (in absolute terms). We might therefore infer that there is evidence for a strong negative correlation between the traits with respect to the mother and that while maternal identity explains variance in both traits those mothers that tend to produce heavier offspring actually tend to produce offspring with shorter tarsus lengths.</p>
<p>To formally test if <span class="math inline">\(COV_M\)</span> is significantly different from zero, we can compare the log-likelihood for this model:</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="asreml-biv.html#cb240-1" aria-hidden="true"></a>modelb<span class="op">$</span>loglik</span></code></pre></div>
<pre><code>## [1] -2380.246</code></pre>
<p>to a model in which we specify that <span class="math inline">\(COV_M\)</span>=0. Since this constraint reduces the number of parameters to be estimated by one, we can use a likelihood ratio test (LRT) with one degree of freedom. To run the constrained model, we modify the G structure defined for the <code>mother</code> random effect to diagonal (<code>diag</code>), which means we only estimate the variances (the diagonal of the matrix) but not the covariance (the covariance are fixed to 0):</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="asreml-biv.html#cb242-1" aria-hidden="true"></a>modelc &lt;-<span class="st"> </span><span class="kw">asreml</span>(</span>
<span id="cb242-2"><a href="asreml-biv.html#cb242-2" aria-hidden="true"></a>  <span class="dt">fixed =</span> <span class="kw">cbind</span>(bwt, tarsus) <span class="op">~</span><span class="st"> </span>trait <span class="op">+</span><span class="st"> </span><span class="kw">at</span>(trait)<span class="op">:</span>sex,</span>
<span id="cb242-3"><a href="asreml-biv.html#cb242-3" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span><span class="kw">vm</span>(animal, ainv) <span class="op">+</span></span>
<span id="cb242-4"><a href="asreml-biv.html#cb242-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span>byear <span class="op">+</span></span>
<span id="cb242-5"><a href="asreml-biv.html#cb242-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">diag</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))<span class="op">:</span>mother,</span>
<span id="cb242-6"><a href="asreml-biv.html#cb242-6" aria-hidden="true"></a>  <span class="dt">residual =</span> <span class="op">~</span><span class="st"> </span><span class="kw">id</span>(units)<span class="op">:</span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>)),</span>
<span id="cb242-7"><a href="asreml-biv.html#cb242-7" aria-hidden="true"></a>  <span class="dt">data =</span> gryphon,</span>
<span id="cb242-8"><a href="asreml-biv.html#cb242-8" aria-hidden="true"></a>  <span class="dt">na.action =</span> <span class="kw">na.method</span>(<span class="dt">x =</span> <span class="st">&quot;include&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;include&quot;</span>),</span>
<span id="cb242-9"><a href="asreml-biv.html#cb242-9" aria-hidden="true"></a>  <span class="dt">maxit =</span> <span class="dv">20</span></span>
<span id="cb242-10"><a href="asreml-biv.html#cb242-10" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## Model fitted using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:12 2022
##           LogLik        Sigma2     DF     wall    cpu
##  1     -4677.820           1.0   1533 16:50:12    0.0
##  2     -4010.442           1.0   1533 16:50:12    0.0
##  3     -3275.409           1.0   1533 16:50:12    0.0
##  4     -2763.519           1.0   1533 16:50:12    0.0
##  5     -2483.732           1.0   1533 16:50:12    0.0
##  6     -2400.242           1.0   1533 16:50:12    0.0
##  7     -2386.663           1.0   1533 16:50:12    0.0
##  8     -2386.049           1.0   1533 16:50:12    0.0
##  9     -2386.045           1.0   1533 16:50:12    0.0</code></pre>
<p>You can run <code>summary(modelc)$varcomp</code> to confirm this worked. We can now obtain the log-likelihood of this model and compare this to that of <code>modelb</code> using a likelihood ratio test:</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="asreml-biv.html#cb244-1" aria-hidden="true"></a>modelc<span class="op">$</span>loglik</span></code></pre></div>
<pre><code>## [1] -2386.045</code></pre>
<p>We can see that the model log-likelihood is now -2386.05.
And comparing the models using a likelihood ratio test:</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="asreml-biv.html#cb246-1" aria-hidden="true"></a><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(modelb<span class="op">$</span>loglik <span class="op">-</span><span class="st"> </span>modelc<span class="op">$</span>loglik)</span></code></pre></div>
<pre><code>## [1] 11.59835</code></pre>
<p>So our chi-square test statistic is <span class="math inline">\(\chi^2_1\)</span>= 11.6.
The p-value that goes with this is obtained by:</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="asreml-biv.html#cb248-1" aria-hidden="true"></a><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pchisq</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(modelb<span class="op">$</span>loglik <span class="op">-</span><span class="st"> </span>modelc<span class="op">$</span>loglik), <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 0.0006601037</code></pre>
<p>We would therefore conclude that the maternal covariance is significantly different from zero.</p>
<p>We could apply the same procedure to show that the residual (environmental) covariance and the genetic covariance estimates are significantly greater than zero (<em>i.e.</em>, heavier individuals tend to have longer tarsus lengths). In contrast, we should find that the byear covariance between the two traits is non-significant.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="asreml-biv.html#cb250-1" aria-hidden="true"></a>modeld &lt;-<span class="st"> </span><span class="kw">asreml</span>(</span>
<span id="cb250-2"><a href="asreml-biv.html#cb250-2" aria-hidden="true"></a>  <span class="dt">fixed =</span> <span class="kw">cbind</span>(bwt, tarsus) <span class="op">~</span><span class="st"> </span>trait <span class="op">+</span><span class="st"> </span><span class="kw">at</span>(trait)<span class="op">:</span>sex,</span>
<span id="cb250-3"><a href="asreml-biv.html#cb250-3" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span><span class="kw">vm</span>(animal, ainv) <span class="op">+</span></span>
<span id="cb250-4"><a href="asreml-biv.html#cb250-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">diag</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))<span class="op">:</span>byear <span class="op">+</span></span>
<span id="cb250-5"><a href="asreml-biv.html#cb250-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span>mother,</span>
<span id="cb250-6"><a href="asreml-biv.html#cb250-6" aria-hidden="true"></a>  <span class="dt">residual =</span> <span class="op">~</span><span class="st"> </span><span class="kw">id</span>(units)<span class="op">:</span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>)),</span>
<span id="cb250-7"><a href="asreml-biv.html#cb250-7" aria-hidden="true"></a>  <span class="dt">data =</span> gryphon,</span>
<span id="cb250-8"><a href="asreml-biv.html#cb250-8" aria-hidden="true"></a>  <span class="dt">na.action =</span> <span class="kw">na.method</span>(<span class="dt">x =</span> <span class="st">&quot;include&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;include&quot;</span>),</span>
<span id="cb250-9"><a href="asreml-biv.html#cb250-9" aria-hidden="true"></a>  <span class="dt">maxit =</span> <span class="dv">20</span></span>
<span id="cb250-10"><a href="asreml-biv.html#cb250-10" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## Model fitted using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:12 2022
##           LogLik        Sigma2     DF     wall    cpu
##  1     -4672.708           1.0   1533 16:50:12    0.1
##  2     -4005.953           1.0   1533 16:50:12    0.0
##  3     -3271.737           1.0   1533 16:50:12    0.0 (1 restrained)
##  4     -2761.626           1.0   1533 16:50:12    0.0 (1 restrained)
##  5     -2481.649           1.0   1533 16:50:13    0.0
##  6     -2395.992           1.0   1533 16:50:13    0.0
##  7     -2381.136           1.0   1533 16:50:13    0.0
##  8     -2380.331           1.0   1533 16:50:13    0.0
##  9     -2380.326           1.0   1533 16:50:13    0.0</code></pre>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="asreml-biv.html#cb252-1" aria-hidden="true"></a><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(modelb<span class="op">$</span>loglik <span class="op">-</span><span class="st"> </span>modeld<span class="op">$</span>loglik)</span></code></pre></div>
<pre><code>## [1] 0.1600641</code></pre>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="asreml-biv.html#cb254-1" aria-hidden="true"></a><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pchisq</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(modelb<span class="op">$</span>loglik <span class="op">-</span><span class="st"> </span>modeld<span class="op">$</span>loglik), <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 0.6890975</code></pre>
</div>
<div id="estimate-directly-the-genetic-correlation-within-the-model" class="section level3 hasAnchor" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Estimate directly the genetic correlation within the model<a href="asreml-biv.html#estimate-directly-the-genetic-correlation-within-the-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Within Asreml-r, different matrix structure can be specify such as <code>us</code>,<code>corg</code>, <code>diag</code>, etc (cf see the Asreml-r guide). Instead of the fitting an unstructured matrix with the argument <code>us</code> or a reduced model with no covariance with the argument <code>diag</code>, we can also directly estimate the genetic correlation between the <code>bwt</code> and <code>tarsus</code> with <code>corgh</code>.</p>
<p>Here we decide to estimate directly the additive genetic correlation.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="asreml-biv.html#cb256-1" aria-hidden="true"></a>modele &lt;-<span class="st"> </span><span class="kw">asreml</span>(</span>
<span id="cb256-2"><a href="asreml-biv.html#cb256-2" aria-hidden="true"></a>  <span class="dt">fixed =</span> <span class="kw">cbind</span>(bwt, tarsus) <span class="op">~</span><span class="st"> </span>trait <span class="op">+</span><span class="st"> </span><span class="kw">at</span>(trait)<span class="op">:</span>sex,</span>
<span id="cb256-3"><a href="asreml-biv.html#cb256-3" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="kw">corgh</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">1</span>))<span class="op">:</span><span class="kw">vm</span>(animal, ainv) <span class="op">+</span></span>
<span id="cb256-4"><a href="asreml-biv.html#cb256-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span>byear <span class="op">+</span></span>
<span id="cb256-5"><a href="asreml-biv.html#cb256-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span>mother,</span>
<span id="cb256-6"><a href="asreml-biv.html#cb256-6" aria-hidden="true"></a>  <span class="dt">residual =</span> <span class="op">~</span><span class="st"> </span><span class="kw">id</span>(units)<span class="op">:</span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>)),</span>
<span id="cb256-7"><a href="asreml-biv.html#cb256-7" aria-hidden="true"></a>  <span class="dt">data =</span> gryphon,</span>
<span id="cb256-8"><a href="asreml-biv.html#cb256-8" aria-hidden="true"></a>  <span class="dt">na.action =</span> <span class="kw">na.method</span>(<span class="dt">x =</span> <span class="st">&quot;include&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;include&quot;</span>),</span>
<span id="cb256-9"><a href="asreml-biv.html#cb256-9" aria-hidden="true"></a>  <span class="dt">maxit =</span> <span class="dv">20</span></span>
<span id="cb256-10"><a href="asreml-biv.html#cb256-10" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## Model fitted using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:13 2022
##           LogLik        Sigma2     DF     wall    cpu
##  1     -4672.301           1.0   1533 16:50:13    0.1
##  2     -4003.183           1.0   1533 16:50:13    0.0
##  3     -3266.521           1.0   1533 16:50:13    0.0 (1 restrained)
##  4     -2757.188           1.0   1533 16:50:13    0.0 (1 restrained)
##  5     -2479.293           1.0   1533 16:50:13    0.0
##  6     -2395.477           1.0   1533 16:50:13    0.0
##  7     -2381.026           1.0   1533 16:50:13    0.0
##  8     -2380.251           1.0   1533 16:50:13    0.0
##  9     -2380.246           1.0   1533 16:50:13    0.0</code></pre>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="asreml-biv.html#cb258-1" aria-hidden="true"></a>modele &lt;-<span class="st"> </span><span class="kw">update</span>(modele)</span></code></pre></div>
<pre><code>## Model fitted using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:13 2022
##           LogLik        Sigma2     DF     wall    cpu
##  1     -2380.246           1.0   1533 16:50:13    0.1
##  2     -2380.246           1.0   1533 16:50:13    0.0</code></pre>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="asreml-biv.html#cb260-1" aria-hidden="true"></a><span class="kw">summary</span>(modele)<span class="op">$</span>varcomp</span></code></pre></div>
<pre><code>##                                                     component std.error
## trait:byear!trait_bwt:bwt                           0.9746386 0.2825728
## trait:byear!trait_tarsus:bwt                        0.1624071 0.4185082
## trait:byear!trait_tarsus:tarsus                     3.7383734 1.2066018
## trait:mother!trait_bwt:bwt                          1.1445186 0.2302183
## trait:mother!trait_tarsus:bwt                      -1.5567316 0.4051850
## trait:mother!trait_tarsus:tarsus                    4.8206154 1.3201324
## trait:vm(animal, ainv)!trait!tarsus:!trait!bwt.cor  0.7353061 0.1094807
## trait:vm(animal, ainv)!trait_bwt                    1.9893543 0.4410243
## trait:vm(animal, ainv)!trait_tarsus                10.2294850 2.8077055
## units:trait!R                                       1.0000000        NA
## units:trait!trait_bwt:bwt                           1.8443112 0.3443178
## units:trait!trait_tarsus:bwt                        4.0142825 0.7412540
## units:trait!trait_tarsus:tarsus                    12.4845977 2.2893355
##                                                      z.ratio bound %ch
## trait:byear!trait_bwt:bwt                           3.449159     P   0
## trait:byear!trait_tarsus:bwt                        0.388062     P   0
## trait:byear!trait_tarsus:tarsus                     3.098266     P   0
## trait:mother!trait_bwt:bwt                          4.971450     P   0
## trait:mother!trait_tarsus:bwt                      -3.842027     P   0
## trait:mother!trait_tarsus:tarsus                    3.651615     P   0
## trait:vm(animal, ainv)!trait!tarsus:!trait!bwt.cor  6.716310     U   0
## trait:vm(animal, ainv)!trait_bwt                    4.510758     P   0
## trait:vm(animal, ainv)!trait_tarsus                 3.643361     P   0
## units:trait!R                                             NA     F   0
## units:trait!trait_bwt:bwt                           5.356422     P   0
## units:trait!trait_tarsus:bwt                        5.415529     P   0
## units:trait!trait_tarsus:tarsus                     5.453372     P   0</code></pre>
<p>It is important to note that using <code>corgh</code> change the order of the estimate (co)variance/correlation. Thus, the initial values need to be reorder and all different calculation need to be adjust in consequence.
It is also important to check the difference between the model with <code>us</code> and <code>corgh</code> to make sure any mistake are made.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="asreml-biv.html#cb262-1" aria-hidden="true"></a><span class="kw">summary</span>(modelb)<span class="op">$</span>loglik</span></code></pre></div>
<pre><code>## [1] -2380.246</code></pre>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="asreml-biv.html#cb264-1" aria-hidden="true"></a><span class="kw">summary</span>(modele)<span class="op">$</span>loglik</span></code></pre></div>
<pre><code>## [1] -2380.246</code></pre>
<p>There two main advantages to use <code>corgh</code>: first, a direct estimation of correlation within the G matrix can avoid mistake in the <code>vpredict</code> calculation; second, it is possible to test if the correlation is significantly different than 0 (similar result as LRT with the covariance) but also to -1 and 1 which correspond of the correlation boundaries.
The following code showed how to create a reduced model with the correlation close to 1 and compared to the initial model.
Since we compared the correlation to its boundary, the degree of freedom is only half as a one tail LTR.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="asreml-biv.html#cb266-1" aria-hidden="true"></a>MODEL_MODIF &lt;-<span class="st"> </span><span class="kw">update.asreml</span>(modele, <span class="dt">start.values =</span> T)</span>
<span id="cb266-2"><a href="asreml-biv.html#cb266-2" aria-hidden="true"></a>G_MOD &lt;-<span class="st"> </span>MODEL_MODIF<span class="op">$</span>vparameters.table[(<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>), ]</span>
<span id="cb266-3"><a href="asreml-biv.html#cb266-3" aria-hidden="true"></a>G_MOD[<span class="dv">1</span>, <span class="dv">2</span>] &lt;-<span class="st"> </span><span class="fl">0.99999</span></span>
<span id="cb266-4"><a href="asreml-biv.html#cb266-4" aria-hidden="true"></a>G_MOD[<span class="dv">1</span>, <span class="dv">3</span>] &lt;-<span class="st"> &quot;F&quot;</span></span>
<span id="cb266-5"><a href="asreml-biv.html#cb266-5" aria-hidden="true"></a>modele.red &lt;-<span class="st"> </span><span class="kw">asreml</span>(</span>
<span id="cb266-6"><a href="asreml-biv.html#cb266-6" aria-hidden="true"></a>  <span class="dt">fixed =</span> <span class="kw">cbind</span>(bwt, tarsus) <span class="op">~</span><span class="st"> </span>trait <span class="op">+</span><span class="st"> </span><span class="kw">at</span>(trait)<span class="op">:</span>sex,</span>
<span id="cb266-7"><a href="asreml-biv.html#cb266-7" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="kw">corgh</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">1</span>))<span class="op">:</span><span class="kw">vm</span>(animal, ainv) <span class="op">+</span></span>
<span id="cb266-8"><a href="asreml-biv.html#cb266-8" aria-hidden="true"></a><span class="st">    </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span>byear <span class="op">+</span></span>
<span id="cb266-9"><a href="asreml-biv.html#cb266-9" aria-hidden="true"></a><span class="st">    </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span>mother,</span>
<span id="cb266-10"><a href="asreml-biv.html#cb266-10" aria-hidden="true"></a>  <span class="dt">residual =</span> <span class="op">~</span><span class="st"> </span><span class="kw">id</span>(units)<span class="op">:</span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>)),</span>
<span id="cb266-11"><a href="asreml-biv.html#cb266-11" aria-hidden="true"></a>  <span class="dt">data =</span> gryphon,</span>
<span id="cb266-12"><a href="asreml-biv.html#cb266-12" aria-hidden="true"></a>  <span class="dt">na.action =</span> <span class="kw">na.method</span>(<span class="dt">x =</span> <span class="st">&quot;include&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;include&quot;</span>),</span>
<span id="cb266-13"><a href="asreml-biv.html#cb266-13" aria-hidden="true"></a>  <span class="dt">maxit =</span> <span class="dv">20</span>,</span>
<span id="cb266-14"><a href="asreml-biv.html#cb266-14" aria-hidden="true"></a>  <span class="dt">G.param =</span> G_MOD</span>
<span id="cb266-15"><a href="asreml-biv.html#cb266-15" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## Model fitted using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:14 2022
##           LogLik        Sigma2     DF     wall    cpu
##  1     -2545.233           1.0   1533 16:50:14    0.1
##  2     -2483.883           1.0   1533 16:50:14    0.1
##  3     -2423.504           1.0   1533 16:50:14    0.1
##  4     -2392.509           1.0   1533 16:50:14    0.0
##  5     -2383.661           1.0   1533 16:50:14    0.0
##  6     -2383.084           1.0   1533 16:50:14    0.0
##  7     -2383.033           1.0   1533 16:50:14    0.0
##  8     -2383.022           1.0   1533 16:50:14    0.1
##  9     -2383.019           1.0   1533 16:50:14    0.1
## 10     -2383.019           1.0   1533 16:50:14    0.0</code></pre>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="asreml-biv.html#cb268-1" aria-hidden="true"></a><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(modele<span class="op">$</span>loglik <span class="op">-</span><span class="st"> </span>modele.red<span class="op">$</span>loglik)</span></code></pre></div>
<pre><code>## [1] 5.544679</code></pre>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="asreml-biv.html#cb270-1" aria-hidden="true"></a><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pchisq</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(modele<span class="op">$</span>loglik <span class="op">-</span><span class="st"> </span>modele.red<span class="op">$</span>loglik), <span class="dt">df =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## [1] 0.006598676</code></pre>
<p>Here, the correlation is significantly different than 1 (~0.99999).</p>
</div>
<div id="visualisation-of-the-correlation-aka-blup-extraction" class="section level3 hasAnchor" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span> Visualisation of the correlation (aka BLUP extraction)<a href="asreml-biv.html#visualisation-of-the-correlation-aka-blup-extraction" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When estimating correlation between traits, having a visualization of it can help the interpretation. In addition, visualizing the correlation can spot outliers in the dataset.
Thanks to mixed model, each breeding values is stored within the model and can be extract as BLUP (Best Linear Unbiased Predictor).BLUP should be normaly distributed, if not you need to check the assumption of your animal model.</p>
<p>To simplify the following code, we rename the variable T1 and T2.</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="asreml-biv.html#cb272-1" aria-hidden="true"></a>gryphon<span class="op">$</span>T1 &lt;-<span class="st"> </span>gryphon<span class="op">$</span>bwt</span>
<span id="cb272-2"><a href="asreml-biv.html#cb272-2" aria-hidden="true"></a>gryphon<span class="op">$</span>T2 &lt;-<span class="st"> </span>gryphon<span class="op">$</span>tarsus</span>
<span id="cb272-3"><a href="asreml-biv.html#cb272-3" aria-hidden="true"></a><span class="co">############</span></span>
<span id="cb272-4"><a href="asreml-biv.html#cb272-4" aria-hidden="true"></a>modele &lt;-<span class="st"> </span><span class="kw">asreml</span>(</span>
<span id="cb272-5"><a href="asreml-biv.html#cb272-5" aria-hidden="true"></a>  <span class="dt">fixed =</span> <span class="kw">cbind</span>(T1, T2) <span class="op">~</span><span class="st"> </span>trait <span class="op">+</span><span class="st"> </span><span class="kw">at</span>(trait)<span class="op">:</span>sex,</span>
<span id="cb272-6"><a href="asreml-biv.html#cb272-6" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="kw">corgh</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">1</span>))<span class="op">:</span><span class="kw">vm</span>(animal, ainv) <span class="op">+</span></span>
<span id="cb272-7"><a href="asreml-biv.html#cb272-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span>byear <span class="op">+</span></span>
<span id="cb272-8"><a href="asreml-biv.html#cb272-8" aria-hidden="true"></a><span class="st">    </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span>mother,</span>
<span id="cb272-9"><a href="asreml-biv.html#cb272-9" aria-hidden="true"></a>  <span class="dt">residual =</span> <span class="op">~</span><span class="st"> </span><span class="kw">id</span>(units)<span class="op">:</span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>)),</span>
<span id="cb272-10"><a href="asreml-biv.html#cb272-10" aria-hidden="true"></a>  <span class="dt">data =</span> gryphon,</span>
<span id="cb272-11"><a href="asreml-biv.html#cb272-11" aria-hidden="true"></a>  <span class="dt">na.action =</span> <span class="kw">na.method</span>(<span class="dt">x =</span> <span class="st">&quot;include&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;include&quot;</span>),</span>
<span id="cb272-12"><a href="asreml-biv.html#cb272-12" aria-hidden="true"></a>  <span class="dt">maxit =</span> <span class="dv">20</span></span>
<span id="cb272-13"><a href="asreml-biv.html#cb272-13" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## Model fitted using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:14 2022
##           LogLik        Sigma2     DF     wall    cpu
##  1     -4672.301           1.0   1533 16:50:14    0.1
##  2     -4003.183           1.0   1533 16:50:15    0.0
##  3     -3266.521           1.0   1533 16:50:15    0.0 (1 restrained)
##  4     -2757.188           1.0   1533 16:50:15    0.0 (1 restrained)
##  5     -2479.293           1.0   1533 16:50:15    0.0
##  6     -2395.477           1.0   1533 16:50:15    0.0
##  7     -2381.026           1.0   1533 16:50:15    0.0
##  8     -2380.251           1.0   1533 16:50:15    0.0
##  9     -2380.246           1.0   1533 16:50:15    0.0</code></pre>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="asreml-biv.html#cb274-1" aria-hidden="true"></a>modele &lt;-<span class="st"> </span><span class="kw">update</span>(modele)</span></code></pre></div>
<pre><code>## Model fitted using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:15 2022
##           LogLik        Sigma2     DF     wall    cpu
##  1     -2380.246           1.0   1533 16:50:15    0.1
##  2     -2380.246           1.0   1533 16:50:15    0.0</code></pre>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="asreml-biv.html#cb276-1" aria-hidden="true"></a><span class="kw">summary</span>(modele)<span class="op">$</span>varcomp</span></code></pre></div>
<pre><code>##                                                component std.error   z.ratio
## trait:byear!trait_T1:T1                        0.9746386 0.2825728  3.449159
## trait:byear!trait_T2:T1                        0.1624071 0.4185082  0.388062
## trait:byear!trait_T2:T2                        3.7383734 1.2066018  3.098266
## trait:mother!trait_T1:T1                       1.1445186 0.2302183  4.971450
## trait:mother!trait_T2:T1                      -1.5567316 0.4051850 -3.842027
## trait:mother!trait_T2:T2                       4.8206154 1.3201324  3.651615
## trait:vm(animal, ainv)!trait!T2:!trait!T1.cor  0.7353061 0.1094807  6.716310
## trait:vm(animal, ainv)!trait_T1                1.9893543 0.4410243  4.510758
## trait:vm(animal, ainv)!trait_T2               10.2294850 2.8077055  3.643361
## units:trait!R                                  1.0000000        NA        NA
## units:trait!trait_T1:T1                        1.8443112 0.3443178  5.356422
## units:trait!trait_T2:T1                        4.0142825 0.7412540  5.415529
## units:trait!trait_T2:T2                       12.4845977 2.2893355  5.453372
##                                               bound %ch
## trait:byear!trait_T1:T1                           P   0
## trait:byear!trait_T2:T1                           P   0
## trait:byear!trait_T2:T2                           P   0
## trait:mother!trait_T1:T1                          P   0
## trait:mother!trait_T2:T1                          P   0
## trait:mother!trait_T2:T2                          P   0
## trait:vm(animal, ainv)!trait!T2:!trait!T1.cor     U   0
## trait:vm(animal, ainv)!trait_T1                   P   0
## trait:vm(animal, ainv)!trait_T2                   P   0
## units:trait!R                                     F   0
## units:trait!trait_T1:T1                           P   0
## units:trait!trait_T2:T1                           P   0
## units:trait!trait_T2:T2                           P   0</code></pre>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="asreml-biv.html#cb278-1" aria-hidden="true"></a><span class="co">############</span></span>
<span id="cb278-2"><a href="asreml-biv.html#cb278-2" aria-hidden="true"></a>DvsS &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb278-3"><a href="asreml-biv.html#cb278-3" aria-hidden="true"></a>  <span class="dt">Trait =</span> <span class="kw">rownames</span>(modele<span class="op">$</span>coefficients<span class="op">$</span>random),</span>
<span id="cb278-4"><a href="asreml-biv.html#cb278-4" aria-hidden="true"></a>  <span class="dt">BLUP =</span> modele<span class="op">$</span>coefficients<span class="op">$</span>random,</span>
<span id="cb278-5"><a href="asreml-biv.html#cb278-5" aria-hidden="true"></a>  <span class="dt">SE =</span> <span class="kw">sqrt</span>(modele<span class="op">$</span>vcoeff<span class="op">$</span>random <span class="op">*</span><span class="st"> </span>modele<span class="op">$</span>sigma2)</span>
<span id="cb278-6"><a href="asreml-biv.html#cb278-6" aria-hidden="true"></a>)</span>
<span id="cb278-7"><a href="asreml-biv.html#cb278-7" aria-hidden="true"></a>DvsS<span class="op">$</span>ID &lt;-<span class="st"> </span><span class="kw">substr</span>(DvsS<span class="op">$</span>Trait, <span class="dv">27</span>, <span class="dv">30</span>)</span>
<span id="cb278-8"><a href="asreml-biv.html#cb278-8" aria-hidden="true"></a>DvsS<span class="op">$</span>TRAIT &lt;-<span class="st"> </span><span class="kw">substr</span>(DvsS<span class="op">$</span>Trait, <span class="dv">7</span>, <span class="dv">8</span>)</span>
<span id="cb278-9"><a href="asreml-biv.html#cb278-9" aria-hidden="true"></a>DvsS &lt;-<span class="st"> </span>DvsS[<span class="dv">927</span><span class="op">:</span><span class="dv">3544</span>, ] <span class="co"># keep only row associated to animal</span></span>
<span id="cb278-10"><a href="asreml-biv.html#cb278-10" aria-hidden="true"></a><span class="kw">summary</span>(<span class="kw">factor</span>(DvsS<span class="op">$</span>TRAIT)) <span class="co"># 1309 each</span></span></code></pre></div>
<pre><code>##   T1   T2 
## 1309 1309</code></pre>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="asreml-biv.html#cb280-1" aria-hidden="true"></a><span class="co">#</span></span>
<span id="cb280-2"><a href="asreml-biv.html#cb280-2" aria-hidden="true"></a>DvsS<span class="op">$</span>Trait &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb280-3"><a href="asreml-biv.html#cb280-3" aria-hidden="true"></a><span class="kw">colnames</span>(DvsS)[<span class="dv">1</span>] &lt;-<span class="st"> &quot;BLUP&quot;</span></span>
<span id="cb280-4"><a href="asreml-biv.html#cb280-4" aria-hidden="true"></a>BLUPS &lt;-<span class="st"> </span><span class="kw">reshape</span>(DvsS, <span class="dt">v.names =</span> <span class="kw">c</span>(<span class="st">&quot;BLUP&quot;</span>, <span class="st">&quot;SE&quot;</span>), <span class="dt">idvar =</span> <span class="st">&quot;ID&quot;</span>, <span class="dt">timevar =</span> <span class="st">&quot;TRAIT&quot;</span>, <span class="dt">direction =</span> <span class="st">&quot;wide&quot;</span>)</span>
<span id="cb280-5"><a href="asreml-biv.html#cb280-5" aria-hidden="true"></a><span class="kw">nrow</span>(BLUPS)</span></code></pre></div>
<pre><code>## [1] 1309</code></pre>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="asreml-biv.html#cb282-1" aria-hidden="true"></a><span class="kw">rownames</span>(BLUPS) &lt;-<span class="st"> </span><span class="kw">c</span>()</span>
<span id="cb282-2"><a href="asreml-biv.html#cb282-2" aria-hidden="true"></a><span class="kw">colnames</span>(BLUPS) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;BLUP.btw&quot;</span>, <span class="st">&quot;SE.btw&quot;</span>, <span class="st">&quot;BLUP.tarsus&quot;</span>, <span class="st">&quot;SE.tarsus&quot;</span>)</span>
<span id="cb282-3"><a href="asreml-biv.html#cb282-3" aria-hidden="true"></a><span class="kw">summary</span>(BLUPS)</span></code></pre></div>
<pre><code>##       ID               BLUP.btw             SE.btw        BLUP.tarsus      
##  Length:1309        Min.   :-3.165474   Min.   :0.7984   Min.   :-6.34104  
##  Class :character   1st Qu.:-0.559280   1st Qu.:0.9967   1st Qu.:-1.14428  
##  Mode  :character   Median :-0.001912   Median :1.0367   Median :-0.02641  
##                     Mean   :-0.009008   Mean   :1.0933   Mean   : 0.02134  
##                     3rd Qu.: 0.533972   3rd Qu.:1.2210   3rd Qu.: 1.18107  
##                     Max.   : 3.319657   Max.   :1.4377   Max.   : 6.71502  
##    SE.tarsus    
##  Min.   :1.928  
##  1st Qu.:2.371  
##  Median :2.451  
##  Mean   :2.576  
##  3rd Qu.:2.811  
##  Max.   :3.287</code></pre>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="asreml-biv.html#cb284-1" aria-hidden="true"></a><span class="co"># write.csv(BLUPS,file=&quot;BLUPS_6x6.csv&quot;,row.names=F)</span></span>
<span id="cb284-2"><a href="asreml-biv.html#cb284-2" aria-hidden="true"></a><span class="co">############</span></span>
<span id="cb284-3"><a href="asreml-biv.html#cb284-3" aria-hidden="true"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb284-4"><a href="asreml-biv.html#cb284-4" aria-hidden="true"></a><span class="kw">hist</span>(BLUPS<span class="op">$</span>BLUP.btw)</span>
<span id="cb284-5"><a href="asreml-biv.html#cb284-5" aria-hidden="true"></a><span class="kw">qqnorm</span>(BLUPS<span class="op">$</span>BLUP.btw)</span>
<span id="cb284-6"><a href="asreml-biv.html#cb284-6" aria-hidden="true"></a><span class="kw">qqline</span>(BLUPS<span class="op">$</span>BLUP.btw)</span>
<span id="cb284-7"><a href="asreml-biv.html#cb284-7" aria-hidden="true"></a><span class="kw">hist</span>(BLUPS<span class="op">$</span>BLUP.tarsus)</span>
<span id="cb284-8"><a href="asreml-biv.html#cb284-8" aria-hidden="true"></a><span class="kw">qqnorm</span>(BLUPS<span class="op">$</span>BLUP.tarsus)</span>
<span id="cb284-9"><a href="asreml-biv.html#cb284-9" aria-hidden="true"></a><span class="kw">qqline</span>(BLUPS<span class="op">$</span>BLUP.tarsus)</span></code></pre></div>
<p><img src="wam_tuto_files/figure-html/unnamed-chunk-97-1.svg" width="672" /></p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="asreml-biv.html#cb285-1" aria-hidden="true"></a><span class="co">#</span></span></code></pre></div>
<p>Here, some simple code to plot the genetic correlation.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="asreml-biv.html#cb286-1" aria-hidden="true"></a><span class="kw">plot</span>(BLUP.tarsus <span class="op">~</span><span class="st"> </span>BLUP.btw, BLUPS, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">las =</span> <span class="fl">1.2</span>, <span class="dt">bty =</span> <span class="st">&quot;o&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;white&quot;</span>)</span>
<span id="cb286-2"><a href="asreml-biv.html#cb286-2" aria-hidden="true"></a><span class="kw">arrows</span>(<span class="dt">x0 =</span> BLUPS<span class="op">$</span>BLUP.btw, <span class="dt">y0 =</span> BLUPS<span class="op">$</span>BLUP.tarsus <span class="op">-</span><span class="st"> </span>BLUPS<span class="op">$</span>SE.tarsus, <span class="dt">x1 =</span> BLUPS<span class="op">$</span>BLUP.btw, <span class="dt">y1 =</span> BLUPS<span class="op">$</span>BLUP.tarsus <span class="op">+</span><span class="st"> </span>BLUPS<span class="op">$</span>SE.tarsus, <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">code =</span> <span class="dv">3</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">length =</span> <span class="dv">0</span>)</span>
<span id="cb286-3"><a href="asreml-biv.html#cb286-3" aria-hidden="true"></a><span class="kw">arrows</span>(<span class="dt">x0 =</span> BLUPS<span class="op">$</span>BLUP.btw <span class="op">-</span><span class="st"> </span>BLUPS<span class="op">$</span>SE.btw, <span class="dt">y0 =</span> BLUPS<span class="op">$</span>BLUP.tarsus, <span class="dt">x1 =</span> BLUPS<span class="op">$</span>BLUP.btw <span class="op">+</span><span class="st"> </span>BLUPS<span class="op">$</span>SE.btw, <span class="dt">y1 =</span> BLUPS<span class="op">$</span>BLUP.tarsus, <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">code =</span> <span class="dv">3</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">length =</span> <span class="dv">0</span>)</span>
<span id="cb286-4"><a href="asreml-biv.html#cb286-4" aria-hidden="true"></a><span class="kw">points</span>(BLUP.tarsus <span class="op">~</span><span class="st"> </span>BLUP.btw, BLUPS, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">cex =</span> <span class="fl">1.5</span>)</span>
<span id="cb286-5"><a href="asreml-biv.html#cb286-5" aria-hidden="true"></a><span class="kw">points</span>(BLUP.tarsus <span class="op">~</span><span class="st"> </span>BLUP.btw, BLUPS, <span class="dt">pch =</span> <span class="dv">1</span>, <span class="dt">col =</span> <span class="kw">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.3</span>), <span class="dt">cex =</span> <span class="kw">c</span>(<span class="fl">1.5</span>))</span>
<span id="cb286-6"><a href="asreml-biv.html#cb286-6" aria-hidden="true"></a><span class="kw">mtext</span>(<span class="st">&quot;btw (BV±SE)&quot;</span>, <span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">line =</span> <span class="fl">2.4</span>)</span>
<span id="cb286-7"><a href="asreml-biv.html#cb286-7" aria-hidden="true"></a><span class="kw">mtext</span>(<span class="st">&quot;tarsus (BV±SE)&quot;</span>, <span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">line =</span> <span class="dv">2</span>, <span class="dt">las =</span> <span class="dv">3</span>)</span>
<span id="cb286-8"><a href="asreml-biv.html#cb286-8" aria-hidden="true"></a><span class="kw">mtext</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">italic</span>(r)[A], <span class="st">&quot; = 0.7353065 ±  0.1094838&quot;</span>)), <span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">line =</span> <span class="dv">-1</span>, <span class="dt">adj =</span> <span class="fl">0.95</span>, <span class="dt">cex =</span> <span class="fl">0.9</span>)</span></code></pre></div>
<p><img src="wam_tuto_files/figure-html/unnamed-chunk-98-1.svg" width="672" /></p>
</div>
<div id="partitionning-covariance-between-groups" class="section level3 hasAnchor" number="3.2.6">
<h3><span class="header-section-number">3.2.6</span> Partitionning (co)variance between groups<a href="asreml-biv.html#partitionning-covariance-between-groups" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Similar to the univariate model, it is possible to partition the variance and also the covariance between different groups within the dataset. Here, we can estimate sex-specific genetic correlation.
Note, to partition a correlation, it is require to have important sample size within each group. For this example, we simplify the model !</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="asreml-biv.html#cb287-1" aria-hidden="true"></a>gryphon &lt;-<span class="st"> </span>gryphon[<span class="kw">order</span>(gryphon<span class="op">$</span>sex), ]</span>
<span id="cb287-2"><a href="asreml-biv.html#cb287-2" aria-hidden="true"></a>model_sex &lt;-<span class="st"> </span><span class="kw">asreml</span>(</span>
<span id="cb287-3"><a href="asreml-biv.html#cb287-3" aria-hidden="true"></a>  <span class="dt">fixed =</span> <span class="kw">cbind</span>(bwt, tarsus) <span class="op">~</span><span class="st"> </span>trait <span class="op">+</span><span class="st"> </span><span class="kw">at</span>(trait)<span class="op">:</span>sex,</span>
<span id="cb287-4"><a href="asreml-biv.html#cb287-4" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="kw">at</span>(sex)<span class="op">:</span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span><span class="kw">vm</span>(animal, ainv) <span class="op">+</span></span>
<span id="cb287-5"><a href="asreml-biv.html#cb287-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span>byear <span class="op">+</span></span>
<span id="cb287-6"><a href="asreml-biv.html#cb287-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span>mother,</span>
<span id="cb287-7"><a href="asreml-biv.html#cb287-7" aria-hidden="true"></a>  <span class="dt">residual =</span> <span class="op">~</span><span class="st"> </span><span class="kw">dsum</span>(<span class="op">~</span><span class="st"> </span><span class="kw">id</span>(units)<span class="op">:</span><span class="kw">us</span>(trait) <span class="op">|</span><span class="st"> </span>sex),</span>
<span id="cb287-8"><a href="asreml-biv.html#cb287-8" aria-hidden="true"></a>  <span class="dt">data =</span> gryphon,</span>
<span id="cb287-9"><a href="asreml-biv.html#cb287-9" aria-hidden="true"></a>  <span class="dt">na.action =</span> <span class="kw">na.method</span>(<span class="dt">x =</span> <span class="st">&quot;include&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;include&quot;</span>),</span>
<span id="cb287-10"><a href="asreml-biv.html#cb287-10" aria-hidden="true"></a>  <span class="dt">maxit =</span> <span class="dv">20</span></span>
<span id="cb287-11"><a href="asreml-biv.html#cb287-11" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## Multi-section model using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:15 2022
##           LogLik        Sigma2     DF     wall    cpu
##  1     -2522.729           1.0   1807 16:50:16    0.2 (1 restrained)</code></pre>
<pre><code>## Warning in asreml(fixed = cbind(bwt, tarsus) ~ trait + at(trait):sex, random
## = ~at(sex):us(trait, : US updates modified 1 times in iteration 2 to remain
## positive definite.</code></pre>
<pre><code>##  2     -2459.512           1.0   1807 16:50:16    0.1 (3 restrained)
##  3     -2408.940           1.0   1807 16:50:16    0.1
##  4     -2392.691           1.0   1807 16:50:16    0.1
##  5     -2388.962           1.0   1807 16:50:16    0.1
##  6     -2388.743           1.0   1807 16:50:16    0.1
##  7     -2388.736           1.0   1807 16:50:16    0.1
##  8     -2388.736           1.0   1807 16:50:16    0.1</code></pre>
<pre><code>## Warning in asreml(fixed = cbind(bwt, tarsus) ~ trait + at(trait):sex, random =
## ~at(sex):us(trait, : US variance structures were modified in 1 instances to make
## them positive definite</code></pre>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="asreml-biv.html#cb292-1" aria-hidden="true"></a>model_sex &lt;-<span class="st"> </span><span class="kw">update</span>(model_sex)</span></code></pre></div>
<pre><code>## Multi-section model using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:16 2022
##           LogLik        Sigma2     DF     wall    cpu
##  1     -2388.736           1.0   1807 16:50:17    0.2
##  2     -2388.736           1.0   1807 16:50:17    0.1</code></pre>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="asreml-biv.html#cb294-1" aria-hidden="true"></a><span class="kw">summary</span>(model_sex)<span class="op">$</span>varcomp</span></code></pre></div>
<pre><code>##                                                        component std.error
## trait:byear!trait_bwt:bwt                              0.9858478 0.2863878
## trait:byear!trait_tarsus:bwt                           0.1525063 0.4334263
## trait:byear!trait_tarsus:tarsus                        3.9981983 1.2798747
## trait:mother!trait_bwt:bwt                             1.3312734 0.2484444
## trait:mother!trait_tarsus:bwt                         -1.6174228 0.4283851
## trait:mother!trait_tarsus:tarsus                       4.7542338 1.3546517
## at(sex, 1):trait:vm(animal, ainv)!trait_bwt:bwt        1.3402853 0.5670773
## at(sex, 1):trait:vm(animal, ainv)!trait_tarsus:bwt     2.3608392 1.1348473
## at(sex, 1):trait:vm(animal, ainv)!trait_tarsus:tarsus  6.0625993 3.1304394
## at(sex, 2):trait:vm(animal, ainv)!trait_bwt:bwt        1.8645998 0.8888206
## at(sex, 2):trait:vm(animal, ainv)!trait_tarsus:bwt     5.0954811 2.0684729
## at(sex, 2):trait:vm(animal, ainv)!trait_tarsus:tarsus 14.9771870 6.4479787
## sex_1!R                                                1.0000000        NA
## sex_1!trait_bwt:bwt                                    2.3079850 0.5015651
## sex_1!trait_tarsus:bwt                                 4.4287898 1.0376370
## sex_1!trait_tarsus:tarsus                             13.4857819 2.9284922
## sex_2!R                                                1.0000000        NA
## sex_2!trait_bwt:bwt                                    1.7956612 0.7549779
## sex_2!trait_tarsus:bwt                                 2.6340448 1.7685804
## sex_2!trait_tarsus:tarsus                              9.6094528 5.4917853
##                                                          z.ratio bound %ch
## trait:byear!trait_bwt:bwt                              3.4423530     P   0
## trait:byear!trait_tarsus:bwt                           0.3518622     P   0
## trait:byear!trait_tarsus:tarsus                        3.1238982     P   0
## trait:mother!trait_bwt:bwt                             5.3584371     P   0
## trait:mother!trait_tarsus:bwt                         -3.7756279     P   0
## trait:mother!trait_tarsus:tarsus                       3.5095618     P   0
## at(sex, 1):trait:vm(animal, ainv)!trait_bwt:bwt        2.3634965     P   0
## at(sex, 1):trait:vm(animal, ainv)!trait_tarsus:bwt     2.0803144     P   0
## at(sex, 1):trait:vm(animal, ainv)!trait_tarsus:tarsus  1.9366608     P   0
## at(sex, 2):trait:vm(animal, ainv)!trait_bwt:bwt        2.0978361     P   0
## at(sex, 2):trait:vm(animal, ainv)!trait_tarsus:bwt     2.4634024     P   0
## at(sex, 2):trait:vm(animal, ainv)!trait_tarsus:tarsus  2.3227724     P   0
## sex_1!R                                                       NA     F   0
## sex_1!trait_bwt:bwt                                    4.6015657     P   0
## sex_1!trait_tarsus:bwt                                 4.2681493     P   0
## sex_1!trait_tarsus:tarsus                              4.6050257     P   0
## sex_2!R                                                       NA     F   0
## sex_2!trait_bwt:bwt                                    2.3784288     P   0
## sex_2!trait_tarsus:bwt                                 1.4893554     P   0
## sex_2!trait_tarsus:tarsus                              1.7497867     P   0</code></pre>
<p>we can estimate the different correlations using <code>vpredict</code>:</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="asreml-biv.html#cb296-1" aria-hidden="true"></a><span class="kw">vpredict</span>(model_sex, r_byear <span class="op">~</span><span class="st"> </span>V2 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(V1 <span class="op">*</span><span class="st"> </span>V3))</span></code></pre></div>
<pre><code>##           Estimate       SE
## r_byear 0.07681584 0.213141</code></pre>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="asreml-biv.html#cb298-1" aria-hidden="true"></a><span class="kw">vpredict</span>(model_sex, r_M <span class="op">~</span><span class="st"> </span>V5 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(V4 <span class="op">*</span><span class="st"> </span>V6))</span></code></pre></div>
<pre><code>##       Estimate       SE
## r_M -0.6429092 0.248944</code></pre>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="asreml-biv.html#cb300-1" aria-hidden="true"></a><span class="kw">vpredict</span>(model_sex, r_A<span class="fl">.1</span> <span class="op">~</span><span class="st"> </span>V8 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(V7 <span class="op">*</span><span class="st"> </span>V9))</span></code></pre></div>
<pre><code>##        Estimate        SE
## r_A.1 0.8282059 0.1723596</code></pre>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="asreml-biv.html#cb302-1" aria-hidden="true"></a><span class="kw">vpredict</span>(model_sex, r_A<span class="fl">.2</span> <span class="op">~</span><span class="st"> </span>V11 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(V10 <span class="op">*</span><span class="st"> </span>V12))</span></code></pre></div>
<pre><code>##        Estimate        SE
## r_A.2 0.9642225 0.1241668</code></pre>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="asreml-biv.html#cb304-1" aria-hidden="true"></a><span class="kw">vpredict</span>(model_sex, r_res<span class="fl">.1</span> <span class="op">~</span><span class="st"> </span>V15 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(V14 <span class="op">*</span><span class="st"> </span>V16))</span></code></pre></div>
<pre><code>##          Estimate         SE
## r_res.1 0.7938355 0.07892634</code></pre>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="asreml-biv.html#cb306-1" aria-hidden="true"></a><span class="kw">vpredict</span>(model_sex, r_res<span class="fl">.2</span> <span class="op">~</span><span class="st"> </span>V19 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(V18 <span class="op">*</span><span class="st"> </span>V20))</span></code></pre></div>
<pre><code>##          Estimate        SE
## r_res.2 0.6341057 0.1894837</code></pre>
<p>and the heritability too:</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="asreml-biv.html#cb308-1" aria-hidden="true"></a><span class="kw">vpredict</span>(model_sex, h2.bwt<span class="fl">.1</span> <span class="op">~</span><span class="st"> </span>V7 <span class="op">/</span><span class="st"> </span>(V1 <span class="op">+</span><span class="st"> </span>V4 <span class="op">+</span><span class="st"> </span>V7 <span class="op">+</span><span class="st"> </span>V14))</span></code></pre></div>
<pre><code>##           Estimate         SE
## h2.bwt.1 0.2246768 0.09176827</code></pre>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="asreml-biv.html#cb310-1" aria-hidden="true"></a><span class="kw">vpredict</span>(model_sex, h2.bwt<span class="fl">.2</span> <span class="op">~</span><span class="st"> </span>V10 <span class="op">/</span><span class="st"> </span>(V1 <span class="op">+</span><span class="st"> </span>V4 <span class="op">+</span><span class="st"> </span>V10 <span class="op">+</span><span class="st"> </span>V18))</span></code></pre></div>
<pre><code>##           Estimate        SE
## h2.bwt.2 0.3119425 0.1442547</code></pre>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="asreml-biv.html#cb312-1" aria-hidden="true"></a><span class="kw">vpredict</span>(model_sex, h2.tarsus<span class="fl">.1</span> <span class="op">~</span><span class="st"> </span>V9 <span class="op">/</span><span class="st"> </span>(V3 <span class="op">+</span><span class="st"> </span>V6 <span class="op">+</span><span class="st"> </span>V9 <span class="op">+</span><span class="st"> </span>V16))</span></code></pre></div>
<pre><code>##             Estimate        SE
## h2.tarsus.1  0.21422 0.1070464</code></pre>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="asreml-biv.html#cb314-1" aria-hidden="true"></a><span class="kw">vpredict</span>(model_sex, h2.tarsus<span class="fl">.2</span> <span class="op">~</span><span class="st"> </span>V12 <span class="op">/</span><span class="st"> </span>(V3 <span class="op">+</span><span class="st"> </span>V6 <span class="op">+</span><span class="st"> </span>V12 <span class="op">+</span><span class="st"> </span>V20))</span></code></pre></div>
<pre><code>##              Estimate        SE
## h2.tarsus.2 0.4492383 0.1833858</code></pre>
<p>Now we can look at the fixed effects parameters and assess their significance with a conditional Wald F-test:</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="asreml-biv.html#cb316-1" aria-hidden="true"></a><span class="kw">summary</span>(model_sex, <span class="dt">coef =</span> <span class="ot">TRUE</span>)<span class="op">$</span>coef.fi</span></code></pre></div>
<pre><code>##                           solution std error    z.ratio
## at(trait, tarsus):sex_1  0.0000000        NA         NA
## at(trait, tarsus):sex_2 -0.0554799 0.4758708 -0.1165861
## at(trait, bwt):sex_1     0.0000000        NA         NA
## at(trait, bwt):sex_2     1.9393688 0.1903239 10.1898321
## trait_bwt                6.3779149 0.2311766 27.5889321
## trait_tarsus            20.5838787 0.4942649 41.6454395</code></pre>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="asreml-biv.html#cb318-1" aria-hidden="true"></a><span class="kw">wald.asreml</span>(model_sex, <span class="dt">denDF =</span> <span class="st">&quot;default&quot;</span>, <span class="dt">ssType =</span> <span class="st">&quot;conditional&quot;</span>)<span class="op">$</span>Wald</span></code></pre></div>
<pre><code>## Multi-section model using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:17 2022
##           LogLik        Sigma2     DF     wall    cpu
##  1     -2388.736           1.0   1807 16:50:17    0.1
##  2     -2388.736           1.0   1807 16:50:17    0.1
## Calculating denominator DF</code></pre>
<pre><code>## [0;34m
## Wald tests for fixed effects.[0m
## [0;34mResponse: cbind(bwt, tarsus)[0m
## 
##                       Df denDF   F.inc   F.con Margin      Pr
## trait                  2  44.8 1522.00 1522.00        0.00000
## at(trait, bwt):sex     1 137.5  220.90  103.80      B 0.00000
## at(trait, tarsus):sex  1 138.6    0.01    0.01      B 0.90737</code></pre>
<p>To assess the significant of the covariance, a LTR test can be done with a reduced model where a specific covariance can be fixed to 0 (for example the female covariance, following code).</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="asreml-biv.html#cb321-1" aria-hidden="true"></a>model_modif &lt;-<span class="st"> </span><span class="kw">update.asreml</span>(model_sex, <span class="dt">start.values =</span> T)</span>
<span id="cb321-2"><a href="asreml-biv.html#cb321-2" aria-hidden="true"></a>G &lt;-<span class="st"> </span>model_modif<span class="op">$</span>vparameters[(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>), ]</span>
<span id="cb321-3"><a href="asreml-biv.html#cb321-3" aria-hidden="true"></a>G<span class="op">$</span>Constraint[(<span class="dv">2</span>)] &lt;-<span class="st"> &quot;F&quot;</span></span>
<span id="cb321-4"><a href="asreml-biv.html#cb321-4" aria-hidden="true"></a>G<span class="op">$</span>Value[(<span class="dv">2</span>)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb321-5"><a href="asreml-biv.html#cb321-5" aria-hidden="true"></a><span class="co">#</span></span>
<span id="cb321-6"><a href="asreml-biv.html#cb321-6" aria-hidden="true"></a>reduc.model_sex &lt;-<span class="st"> </span><span class="kw">asreml</span>(</span>
<span id="cb321-7"><a href="asreml-biv.html#cb321-7" aria-hidden="true"></a>  <span class="dt">fixed =</span> <span class="kw">cbind</span>(bwt, tarsus) <span class="op">~</span><span class="st"> </span>trait <span class="op">+</span><span class="st"> </span><span class="kw">at</span>(trait)<span class="op">:</span>sex,</span>
<span id="cb321-8"><a href="asreml-biv.html#cb321-8" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="kw">at</span>(sex)<span class="op">:</span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span><span class="kw">vm</span>(animal, ainv) <span class="op">+</span></span>
<span id="cb321-9"><a href="asreml-biv.html#cb321-9" aria-hidden="true"></a><span class="st">    </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span>byear <span class="op">+</span></span>
<span id="cb321-10"><a href="asreml-biv.html#cb321-10" aria-hidden="true"></a><span class="st">    </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span>mother,</span>
<span id="cb321-11"><a href="asreml-biv.html#cb321-11" aria-hidden="true"></a>  <span class="dt">residual =</span> <span class="op">~</span><span class="st"> </span><span class="kw">dsum</span>(<span class="op">~</span><span class="st"> </span><span class="kw">id</span>(units)<span class="op">:</span><span class="kw">us</span>(trait) <span class="op">|</span><span class="st"> </span>sex),</span>
<span id="cb321-12"><a href="asreml-biv.html#cb321-12" aria-hidden="true"></a>  <span class="dt">data =</span> gryphon,</span>
<span id="cb321-13"><a href="asreml-biv.html#cb321-13" aria-hidden="true"></a>  <span class="dt">na.action =</span> <span class="kw">na.method</span>(<span class="dt">x =</span> <span class="st">&quot;include&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;include&quot;</span>),</span>
<span id="cb321-14"><a href="asreml-biv.html#cb321-14" aria-hidden="true"></a>  <span class="dt">maxit =</span> <span class="dv">20</span>,</span>
<span id="cb321-15"><a href="asreml-biv.html#cb321-15" aria-hidden="true"></a>  <span class="dt">G.param =</span> G</span>
<span id="cb321-16"><a href="asreml-biv.html#cb321-16" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## Multi-section model using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:18 2022</code></pre>
<pre><code>## Warning in asreml(fixed = cbind(bwt, tarsus) ~ trait + at(trait):sex, random
## = ~at(sex):us(trait, : US updates modified 1 times in iteration 1 to remain
## positive definite.</code></pre>
<pre><code>##           LogLik        Sigma2     DF     wall    cpu
##  1     -2474.972           1.0   1807 16:50:18    0.2 (3 restrained)
##  2     -2406.283           1.0   1807 16:50:19    0.1
##  3     -2394.010           1.0   1807 16:50:19    0.1
##  4     -2391.718           1.0   1807 16:50:19    0.1
##  5     -2391.480           1.0   1807 16:50:19    0.1
##  6     -2391.477           1.0   1807 16:50:19    0.1</code></pre>
<pre><code>## Warning in asreml(fixed = cbind(bwt, tarsus) ~ trait + at(trait):sex, random =
## ~at(sex):us(trait, : US variance structures were modified in 1 instances to make
## them positive definite</code></pre>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="asreml-biv.html#cb326-1" aria-hidden="true"></a>reduc.model_sex &lt;-<span class="st"> </span><span class="kw">update</span>(reduc.model_sex)</span></code></pre></div>
<pre><code>## Multi-section model using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:19 2022
##           LogLik        Sigma2     DF     wall    cpu
##  1     -2391.476           1.0   1807 16:50:19    0.2
##  2     -2391.476           1.0   1807 16:50:19    0.1</code></pre>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="asreml-biv.html#cb328-1" aria-hidden="true"></a><span class="kw">summary</span>(reduc.model_sex)<span class="op">$</span>varcomp</span></code></pre></div>
<pre><code>##                                                        component std.error
## trait:byear!trait_bwt:bwt                              0.9794331 0.2848997
## trait:byear!trait_tarsus:bwt                           0.1428995 0.4322719
## trait:byear!trait_tarsus:tarsus                        4.0021595 1.2818624
## trait:mother!trait_bwt:bwt                             1.4956509 0.2568074
## trait:mother!trait_tarsus:bwt                         -1.2460057 0.4438357
## trait:mother!trait_tarsus:tarsus                       5.3945609 1.4035705
## at(sex, 1):trait:vm(animal, ainv)!trait_bwt:bwt        0.5265716 0.3579555
## at(sex, 1):trait:vm(animal, ainv)!trait_tarsus:bwt     0.0000000        NA
## at(sex, 1):trait:vm(animal, ainv)!trait_tarsus:tarsus  1.4223969 1.9103795
## at(sex, 2):trait:vm(animal, ainv)!trait_bwt:bwt        1.5835813 0.8671365
## at(sex, 2):trait:vm(animal, ainv)!trait_tarsus:bwt     4.4288714 2.0173971
## at(sex, 2):trait:vm(animal, ainv)!trait_tarsus:tarsus 12.9349047 6.2946996
## sex_1!R                                                1.0000000        NA
## sex_1!trait_bwt:bwt                                    2.9539767 0.4196755
## sex_1!trait_tarsus:bwt                                 6.3138301 0.6802598
## sex_1!trait_tarsus:tarsus                             17.3577089 2.4730547
## sex_2!R                                                1.0000000        NA
## sex_2!trait_bwt:bwt                                    1.9341439 0.7416691
## sex_2!trait_tarsus:bwt                                 2.9467290 1.7370018
## sex_2!trait_tarsus:tarsus                             10.7245912 5.4025888
##                                                          z.ratio bound %ch
## trait:byear!trait_bwt:bwt                              3.4378175     P   0
## trait:byear!trait_tarsus:bwt                           0.3305778     P   0
## trait:byear!trait_tarsus:tarsus                        3.1221444     P   0
## trait:mother!trait_bwt:bwt                             5.8240170     P   0
## trait:mother!trait_tarsus:bwt                         -2.8073580     P   0
## trait:mother!trait_tarsus:tarsus                       3.8434556     P   0
## at(sex, 1):trait:vm(animal, ainv)!trait_bwt:bwt        1.4710530     P   0
## at(sex, 1):trait:vm(animal, ainv)!trait_tarsus:bwt            NA     F  NA
## at(sex, 1):trait:vm(animal, ainv)!trait_tarsus:tarsus  0.7445625     P   0
## at(sex, 2):trait:vm(animal, ainv)!trait_bwt:bwt        1.8262193     P   0
## at(sex, 2):trait:vm(animal, ainv)!trait_tarsus:bwt     2.1953395     P   0
## at(sex, 2):trait:vm(animal, ainv)!trait_tarsus:tarsus  2.0548883     P   0
## sex_1!R                                                       NA     F   0
## sex_1!trait_bwt:bwt                                    7.0387165     P   0
## sex_1!trait_tarsus:bwt                                 9.2814981     P   0
## sex_1!trait_tarsus:tarsus                              7.0187323     P   0
## sex_2!R                                                       NA     F   0
## sex_2!trait_bwt:bwt                                    2.6078261     P   0
## sex_2!trait_tarsus:bwt                                 1.6964455     P   0
## sex_2!trait_tarsus:tarsus                              1.9850837     P   0</code></pre>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="asreml-biv.html#cb330-1" aria-hidden="true"></a><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(model_sex<span class="op">$</span>loglik <span class="op">-</span><span class="st"> </span>reduc.model_sex<span class="op">$</span>loglik)</span></code></pre></div>
<pre><code>## [1] 5.481033</code></pre>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="asreml-biv.html#cb332-1" aria-hidden="true"></a><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pchisq</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(model_sex<span class="op">$</span>loglik <span class="op">-</span><span class="st"> </span>reduc.model_sex<span class="op">$</span>loglik), <span class="dt">df =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 0.0192239</code></pre>
<p>In addition, it is also possible to test the sexesif sexes has significant differences with another reduced model where both covariance are fixed to their average values.</p>
<!-- Issue with this model!!!  my code should be ok !-->
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="asreml-biv.html#cb334-1" aria-hidden="true"></a><span class="co"># code provided as an example for the moment since the model cannot run on this data</span></span>
<span id="cb334-2"><a href="asreml-biv.html#cb334-2" aria-hidden="true"></a>model_modif &lt;-<span class="st"> </span><span class="kw">update.asreml</span>(model_sex, <span class="dt">start.values =</span> T)</span>
<span id="cb334-3"><a href="asreml-biv.html#cb334-3" aria-hidden="true"></a>G &lt;-<span class="st"> </span>model_modif<span class="op">$</span>vparameters[(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>), ]</span>
<span id="cb334-4"><a href="asreml-biv.html#cb334-4" aria-hidden="true"></a>G<span class="op">$</span>fac &lt;-<span class="st"> </span><span class="kw">factor</span>(</span>
<span id="cb334-5"><a href="asreml-biv.html#cb334-5" aria-hidden="true"></a>  <span class="kw">c</span>(</span>
<span id="cb334-6"><a href="asreml-biv.html#cb334-6" aria-hidden="true"></a>    <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">6</span>, <span class="co"># Additive genetic matrix  2 =5</span></span>
<span id="cb334-7"><a href="asreml-biv.html#cb334-7" aria-hidden="true"></a>    <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="co"># byear  matrix</span></span>
<span id="cb334-8"><a href="asreml-biv.html#cb334-8" aria-hidden="true"></a>    <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span> <span class="co"># mother matrix</span></span>
<span id="cb334-9"><a href="asreml-biv.html#cb334-9" aria-hidden="true"></a>  )</span>
<span id="cb334-10"><a href="asreml-biv.html#cb334-10" aria-hidden="true"></a>)</span>
<span id="cb334-11"><a href="asreml-biv.html#cb334-11" aria-hidden="true"></a>Modif &lt;-<span class="st"> </span><span class="kw">vcm.lm</span>(<span class="op">~</span>fac, <span class="dt">data =</span> G)</span>
<span id="cb334-12"><a href="asreml-biv.html#cb334-12" aria-hidden="true"></a><span class="kw">attr</span>(Modif, <span class="st">&quot;assign&quot;</span>) &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb334-13"><a href="asreml-biv.html#cb334-13" aria-hidden="true"></a><span class="kw">attr</span>(Modif, <span class="st">&quot;contrasts&quot;</span>) &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb334-14"><a href="asreml-biv.html#cb334-14" aria-hidden="true"></a><span class="co">#</span></span>
<span id="cb334-15"><a href="asreml-biv.html#cb334-15" aria-hidden="true"></a>reduc.model_sex_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">asreml</span>(</span>
<span id="cb334-16"><a href="asreml-biv.html#cb334-16" aria-hidden="true"></a>  <span class="dt">fixed =</span> <span class="kw">cbind</span>(bwt, tarsus) <span class="op">~</span><span class="st"> </span>trait <span class="op">+</span><span class="st"> </span><span class="kw">at</span>(trait)<span class="op">:</span>sex,</span>
<span id="cb334-17"><a href="asreml-biv.html#cb334-17" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="kw">at</span>(sex)<span class="op">:</span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span><span class="kw">vm</span>(animal, ainv) <span class="op">+</span></span>
<span id="cb334-18"><a href="asreml-biv.html#cb334-18" aria-hidden="true"></a><span class="st">    </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span>byear <span class="op">+</span></span>
<span id="cb334-19"><a href="asreml-biv.html#cb334-19" aria-hidden="true"></a><span class="st">    </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span>mother,</span>
<span id="cb334-20"><a href="asreml-biv.html#cb334-20" aria-hidden="true"></a>  <span class="dt">residual =</span> <span class="op">~</span><span class="st"> </span><span class="kw">dsum</span>(<span class="op">~</span><span class="st"> </span><span class="kw">id</span>(units)<span class="op">:</span><span class="kw">us</span>(trait) <span class="op">|</span><span class="st"> </span>sex),</span>
<span id="cb334-21"><a href="asreml-biv.html#cb334-21" aria-hidden="true"></a>  <span class="dt">data =</span> gryphon,</span>
<span id="cb334-22"><a href="asreml-biv.html#cb334-22" aria-hidden="true"></a>  <span class="dt">na.action =</span> <span class="kw">na.method</span>(<span class="dt">x =</span> <span class="st">&quot;include&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;include&quot;</span>),</span>
<span id="cb334-23"><a href="asreml-biv.html#cb334-23" aria-hidden="true"></a>  <span class="dt">maxit =</span> <span class="dv">20</span>,</span>
<span id="cb334-24"><a href="asreml-biv.html#cb334-24" aria-hidden="true"></a>  <span class="dt">G.param =</span> G, <span class="dt">vcm =</span> Modif</span>
<span id="cb334-25"><a href="asreml-biv.html#cb334-25" aria-hidden="true"></a>)</span>
<span id="cb334-26"><a href="asreml-biv.html#cb334-26" aria-hidden="true"></a>reduc.model_sex_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">update</span>(reduc.model_sex_<span class="dv">2</span>)</span>
<span id="cb334-27"><a href="asreml-biv.html#cb334-27" aria-hidden="true"></a><span class="kw">summary</span>(reduc.model_sex_<span class="dv">2</span>)<span class="op">$</span>varcomp</span>
<span id="cb334-28"><a href="asreml-biv.html#cb334-28" aria-hidden="true"></a></span>
<span id="cb334-29"><a href="asreml-biv.html#cb334-29" aria-hidden="true"></a></span>
<span id="cb334-30"><a href="asreml-biv.html#cb334-30" aria-hidden="true"></a></span>
<span id="cb334-31"><a href="asreml-biv.html#cb334-31" aria-hidden="true"></a><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(model_sex<span class="op">$</span>loglik <span class="op">-</span><span class="st"> </span>reduc.model_sex_<span class="dv">2</span><span class="op">$</span>loglik)</span>
<span id="cb334-32"><a href="asreml-biv.html#cb334-32" aria-hidden="true"></a><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pchisq</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(model_sex<span class="op">$</span>loglik <span class="op">-</span><span class="st"> </span>reduc.model_sex_<span class="dv">2</span><span class="op">$</span>loglik), <span class="dt">df =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>Here a plot to visualize the overlaps of covariances.</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="asreml-biv.html#cb335-1" aria-hidden="true"></a>genetic.correlation.F &lt;-<span class="st"> </span><span class="kw">vpredict</span>(model_sex, r_A<span class="fl">.1</span> <span class="op">~</span><span class="st"> </span>V8 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(V7 <span class="op">*</span><span class="st"> </span>V9))</span>
<span id="cb335-2"><a href="asreml-biv.html#cb335-2" aria-hidden="true"></a>genetic.correlation.M &lt;-<span class="st"> </span><span class="kw">vpredict</span>(model_sex, r_A<span class="fl">.2</span> <span class="op">~</span><span class="st"> </span>V11 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(V10 <span class="op">*</span><span class="st"> </span>V12))</span>
<span id="cb335-3"><a href="asreml-biv.html#cb335-3" aria-hidden="true"></a>residual.correlation.F &lt;-<span class="st"> </span><span class="kw">vpredict</span>(model_sex, r_res<span class="fl">.1</span> <span class="op">~</span><span class="st"> </span>V15 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(V14 <span class="op">*</span><span class="st"> </span>V16))</span>
<span id="cb335-4"><a href="asreml-biv.html#cb335-4" aria-hidden="true"></a>residual.correlation.M &lt;-<span class="st"> </span><span class="kw">vpredict</span>(model_sex, r_res<span class="fl">.2</span> <span class="op">~</span><span class="st"> </span>V19 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(V18 <span class="op">*</span><span class="st"> </span>V20))</span>
<span id="cb335-5"><a href="asreml-biv.html#cb335-5" aria-hidden="true"></a>cor.est &lt;-<span class="st"> </span><span class="kw">rbind</span>(genetic.correlation.F, genetic.correlation.M, residual.correlation.F, residual.correlation.M)</span>
<span id="cb335-6"><a href="asreml-biv.html#cb335-6" aria-hidden="true"></a></span>
<span id="cb335-7"><a href="asreml-biv.html#cb335-7" aria-hidden="true"></a><span class="kw">plot</span>(<span class="kw">c</span>(<span class="fl">0.95</span>, <span class="fl">1.05</span>, <span class="fl">1.95</span>, <span class="fl">2.05</span>) <span class="op">~</span><span class="st"> </span>cor.est[, <span class="dv">1</span>], <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">2.5</span>), <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>), <span class="dt">pch =</span> <span class="kw">c</span>(<span class="dv">16</span>, <span class="dv">17</span>), <span class="dt">cex =</span> <span class="dv">2</span>, <span class="dt">yaxt =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb335-8"><a href="asreml-biv.html#cb335-8" aria-hidden="true"></a><span class="kw">arrows</span>(<span class="dt">y0 =</span> <span class="fl">0.95</span>, <span class="dt">x0 =</span> cor.est[<span class="dv">1</span>, <span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>cor.est[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dt">y1 =</span> <span class="fl">0.95</span>, <span class="dt">x1 =</span> cor.est[<span class="dv">1</span>, <span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>cor.est[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dt">code =</span> <span class="dv">3</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">length =</span> <span class="dv">0</span>, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;red&quot;</span>), <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb335-9"><a href="asreml-biv.html#cb335-9" aria-hidden="true"></a><span class="kw">arrows</span>(<span class="dt">y0 =</span> <span class="fl">1.05</span>, <span class="dt">x0 =</span> cor.est[<span class="dv">2</span>, <span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>cor.est[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dt">y1 =</span> <span class="fl">1.05</span>, <span class="dt">x1 =</span> cor.est[<span class="dv">2</span>, <span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>cor.est[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dt">code =</span> <span class="dv">3</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">length =</span> <span class="dv">0</span>, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>), <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb335-10"><a href="asreml-biv.html#cb335-10" aria-hidden="true"></a><span class="kw">arrows</span>(<span class="dt">y0 =</span> <span class="fl">1.95</span>, <span class="dt">x0 =</span> cor.est[<span class="dv">3</span>, <span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>cor.est[<span class="dv">3</span>, <span class="dv">2</span>], <span class="dt">y1 =</span> <span class="fl">1.95</span>, <span class="dt">x1 =</span> cor.est[<span class="dv">3</span>, <span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>cor.est[<span class="dv">3</span>, <span class="dv">2</span>], <span class="dt">code =</span> <span class="dv">3</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">length =</span> <span class="dv">0</span>, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;red&quot;</span>), <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb335-11"><a href="asreml-biv.html#cb335-11" aria-hidden="true"></a><span class="kw">arrows</span>(<span class="dt">y0 =</span> <span class="fl">2.05</span>, <span class="dt">x0 =</span> cor.est[<span class="dv">4</span>, <span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>cor.est[<span class="dv">4</span>, <span class="dv">2</span>], <span class="dt">y1 =</span> <span class="fl">2.05</span>, <span class="dt">x1 =</span> cor.est[<span class="dv">4</span>, <span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>cor.est[<span class="dv">4</span>, <span class="dv">2</span>], <span class="dt">code =</span> <span class="dv">3</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">length =</span> <span class="dv">0</span>, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>), <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb335-12"><a href="asreml-biv.html#cb335-12" aria-hidden="true"></a><span class="kw">mtext</span>(<span class="st">&quot;Correlation (±CI)&quot;</span>, <span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">adj =</span> <span class="fl">0.4</span>, <span class="dt">line =</span> <span class="dv">3</span>, <span class="dt">cex =</span> <span class="fl">1.6</span>)</span>
<span id="cb335-13"><a href="asreml-biv.html#cb335-13" aria-hidden="true"></a><span class="kw">axis</span>(<span class="dv">2</span>, <span class="dt">at =</span> <span class="dv">1</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;genetic&quot;</span>), <span class="dt">las =</span> <span class="dv">3</span>, <span class="dt">cex.axis =</span> <span class="fl">1.6</span>)</span>
<span id="cb335-14"><a href="asreml-biv.html#cb335-14" aria-hidden="true"></a><span class="kw">axis</span>(<span class="dv">2</span>, <span class="dt">at =</span> <span class="dv">2</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;residual&quot;</span>), <span class="dt">las =</span> <span class="dv">3</span>, <span class="dt">cex.axis =</span> <span class="fl">1.6</span>)</span></code></pre></div>
<p><img src="wam_tuto_files/figure-html/unnamed-chunk-106-1.svg" width="672" /></p>
<p>By using <code>corgh</code>, we can extract the BLUPs and plot the sex-specific correlation.</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="asreml-biv.html#cb336-1" aria-hidden="true"></a>gryphon<span class="op">$</span>T1 &lt;-<span class="st"> </span>gryphon<span class="op">$</span>bwt</span>
<span id="cb336-2"><a href="asreml-biv.html#cb336-2" aria-hidden="true"></a>gryphon<span class="op">$</span>T2 &lt;-<span class="st"> </span>gryphon<span class="op">$</span>tarsus</span>
<span id="cb336-3"><a href="asreml-biv.html#cb336-3" aria-hidden="true"></a><span class="co">###</span></span>
<span id="cb336-4"><a href="asreml-biv.html#cb336-4" aria-hidden="true"></a>model_sex &lt;-<span class="st"> </span><span class="kw">asreml</span>(</span>
<span id="cb336-5"><a href="asreml-biv.html#cb336-5" aria-hidden="true"></a>  <span class="dt">fixed =</span> <span class="kw">cbind</span>(T1, T2) <span class="op">~</span><span class="st"> </span>trait <span class="op">+</span><span class="st"> </span><span class="kw">at</span>(trait)<span class="op">:</span>sex,</span>
<span id="cb336-6"><a href="asreml-biv.html#cb336-6" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="kw">at</span>(sex)<span class="op">:</span><span class="kw">corgh</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">1</span>))<span class="op">:</span><span class="kw">vm</span>(animal, ainv) <span class="op">+</span></span>
<span id="cb336-7"><a href="asreml-biv.html#cb336-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span>byear <span class="op">+</span></span>
<span id="cb336-8"><a href="asreml-biv.html#cb336-8" aria-hidden="true"></a><span class="st">    </span><span class="kw">us</span>(trait, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">1</span>))<span class="op">:</span>mother,</span>
<span id="cb336-9"><a href="asreml-biv.html#cb336-9" aria-hidden="true"></a>  <span class="dt">residual =</span> <span class="op">~</span><span class="st"> </span><span class="kw">dsum</span>(<span class="op">~</span><span class="st"> </span><span class="kw">id</span>(units)<span class="op">:</span><span class="kw">us</span>(trait) <span class="op">|</span><span class="st"> </span>sex),</span>
<span id="cb336-10"><a href="asreml-biv.html#cb336-10" aria-hidden="true"></a>  <span class="dt">data =</span> gryphon,</span>
<span id="cb336-11"><a href="asreml-biv.html#cb336-11" aria-hidden="true"></a>  <span class="dt">na.action =</span> <span class="kw">na.method</span>(<span class="dt">x =</span> <span class="st">&quot;include&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;include&quot;</span>),</span>
<span id="cb336-12"><a href="asreml-biv.html#cb336-12" aria-hidden="true"></a>  <span class="dt">maxit =</span> <span class="dv">20</span></span>
<span id="cb336-13"><a href="asreml-biv.html#cb336-13" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## Multi-section model using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:19 2022
##           LogLik        Sigma2     DF     wall    cpu
##  1     -2522.729           1.0   1807 16:50:20    0.1 (2 restrained)
##  2     -2457.755           1.0   1807 16:50:20    0.1 (2 restrained)
##  3     -2407.462           1.0   1807 16:50:20    0.1 (2 restrained)
##  4     -2394.143           1.0   1807 16:50:20    0.1 (1 restrained)
##  5     -2389.368           1.0   1807 16:50:20    0.1
##  6     -2388.741           1.0   1807 16:50:20    0.1
##  7     -2388.736           1.0   1807 16:50:20    0.1</code></pre>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="asreml-biv.html#cb338-1" aria-hidden="true"></a>model_sex &lt;-<span class="st"> </span><span class="kw">update</span>(model_sex)</span></code></pre></div>
<pre><code>## Multi-section model using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:20 2022
##           LogLik        Sigma2     DF     wall    cpu
##  1     -2388.736           1.0   1807 16:50:20    0.2
##  2     -2388.736           1.0   1807 16:50:21    0.1</code></pre>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="asreml-biv.html#cb340-1" aria-hidden="true"></a>DvsS &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb340-2"><a href="asreml-biv.html#cb340-2" aria-hidden="true"></a>  <span class="dt">Trait =</span> <span class="kw">rownames</span>(model_sex<span class="op">$</span>coefficients<span class="op">$</span>random),</span>
<span id="cb340-3"><a href="asreml-biv.html#cb340-3" aria-hidden="true"></a>  <span class="dt">BLUP =</span> model_sex<span class="op">$</span>coefficients<span class="op">$</span>random,</span>
<span id="cb340-4"><a href="asreml-biv.html#cb340-4" aria-hidden="true"></a>  <span class="dt">SE =</span> <span class="kw">sqrt</span>(model_sex<span class="op">$</span>vcoeff<span class="op">$</span>random <span class="op">*</span><span class="st"> </span>model_sex<span class="op">$</span>sigma2)</span>
<span id="cb340-5"><a href="asreml-biv.html#cb340-5" aria-hidden="true"></a>)</span>
<span id="cb340-6"><a href="asreml-biv.html#cb340-6" aria-hidden="true"></a>DvsS<span class="op">$</span>ID &lt;-<span class="st"> </span><span class="kw">substr</span>(DvsS<span class="op">$</span>Trait, <span class="dv">38</span>, <span class="dv">40</span>)</span>
<span id="cb340-7"><a href="asreml-biv.html#cb340-7" aria-hidden="true"></a>DvsS<span class="op">$</span>TRAIT &lt;-<span class="st"> </span><span class="kw">substr</span>(DvsS<span class="op">$</span>Trait, <span class="dv">18</span>, <span class="dv">19</span>)</span>
<span id="cb340-8"><a href="asreml-biv.html#cb340-8" aria-hidden="true"></a>DvsS<span class="op">$</span>SEX &lt;-<span class="st"> </span><span class="kw">substr</span>(DvsS<span class="op">$</span>Trait, <span class="dv">9</span>, <span class="dv">9</span>)</span>
<span id="cb340-9"><a href="asreml-biv.html#cb340-9" aria-hidden="true"></a>DvsS &lt;-<span class="st"> </span>DvsS[<span class="dv">927</span><span class="op">:</span><span class="dv">6162</span>, ] <span class="co"># keep only row associated to animal</span></span>
<span id="cb340-10"><a href="asreml-biv.html#cb340-10" aria-hidden="true"></a><span class="kw">summary</span>(<span class="kw">factor</span>(DvsS<span class="op">$</span>TRAIT)) <span class="co"># 1309 each</span></span></code></pre></div>
<pre><code>##   T1   T2 
## 2618 2618</code></pre>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="asreml-biv.html#cb342-1" aria-hidden="true"></a><span class="co">#</span></span>
<span id="cb342-2"><a href="asreml-biv.html#cb342-2" aria-hidden="true"></a>DvsS<span class="op">$</span>Trait &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb342-3"><a href="asreml-biv.html#cb342-3" aria-hidden="true"></a><span class="kw">colnames</span>(DvsS)[<span class="dv">1</span>] &lt;-<span class="st"> &quot;BLUP&quot;</span></span>
<span id="cb342-4"><a href="asreml-biv.html#cb342-4" aria-hidden="true"></a>BLUPS &lt;-<span class="st"> </span><span class="kw">reshape</span>(DvsS, <span class="dt">v.names =</span> <span class="kw">c</span>(<span class="st">&quot;BLUP&quot;</span>, <span class="st">&quot;SE&quot;</span>), <span class="dt">idvar =</span> <span class="kw">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;SEX&quot;</span>), <span class="dt">timevar =</span> <span class="st">&quot;TRAIT&quot;</span>, <span class="dt">direction =</span> <span class="st">&quot;wide&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in reshapeWide(data, idvar = idvar, timevar = timevar, varying =
## varying, : multiple rows match for TRAIT=T1: first taken</code></pre>
<pre><code>## Warning in reshapeWide(data, idvar = idvar, timevar = timevar, varying =
## varying, : multiple rows match for TRAIT=T2: first taken</code></pre>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="asreml-biv.html#cb345-1" aria-hidden="true"></a><span class="kw">nrow</span>(BLUPS)</span></code></pre></div>
<pre><code>## [1] 1998</code></pre>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="asreml-biv.html#cb347-1" aria-hidden="true"></a><span class="kw">rownames</span>(BLUPS) &lt;-<span class="st"> </span><span class="kw">c</span>()</span>
<span id="cb347-2"><a href="asreml-biv.html#cb347-2" aria-hidden="true"></a><span class="kw">colnames</span>(BLUPS) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;SEX&quot;</span>, <span class="st">&quot;BLUP.btw&quot;</span>, <span class="st">&quot;SE.btw&quot;</span>, <span class="st">&quot;BLUP.tarsus&quot;</span>, <span class="st">&quot;SE.tarsus&quot;</span>)</span>
<span id="cb347-3"><a href="asreml-biv.html#cb347-3" aria-hidden="true"></a><span class="kw">summary</span>(BLUPS)</span></code></pre></div>
<pre><code>##       ID                SEX               BLUP.btw             SE.btw      
##  Length:1998        Length:1998        Min.   :-2.625088   Min.   :0.8383  
##  Class :character   Class :character   1st Qu.:-0.281979   1st Qu.:0.9412  
##  Mode  :character   Mode  :character   Median : 0.000000   Median :1.1018  
##                                        Mean   : 0.008687   Mean   :1.0931  
##                                        3rd Qu.: 0.293571   3rd Qu.:1.1777  
##                                        Max.   : 2.344440   Max.   :1.3650  
##   BLUP.tarsus         SE.tarsus    
##  Min.   :-7.49444   Min.   :1.829  
##  1st Qu.:-0.66206   1st Qu.:2.345  
##  Median : 0.00000   Median :2.462  
##  Mean   : 0.02557   Mean   :2.730  
##  3rd Qu.: 0.71508   3rd Qu.:3.326  
##  Max.   : 6.80950   Max.   :3.868</code></pre>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="asreml-biv.html#cb349-1" aria-hidden="true"></a><span class="co"># write.csv(BLUPS,file=&quot;BLUPS_6x6_SEX.csv&quot;,row.names=F)</span></span>
<span id="cb349-2"><a href="asreml-biv.html#cb349-2" aria-hidden="true"></a><span class="co">############</span></span>
<span id="cb349-3"><a href="asreml-biv.html#cb349-3" aria-hidden="true"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb349-4"><a href="asreml-biv.html#cb349-4" aria-hidden="true"></a><span class="kw">hist</span>(BLUPS<span class="op">$</span>BLUP.btw)</span>
<span id="cb349-5"><a href="asreml-biv.html#cb349-5" aria-hidden="true"></a><span class="kw">qqnorm</span>(BLUPS<span class="op">$</span>BLUP.btw)</span>
<span id="cb349-6"><a href="asreml-biv.html#cb349-6" aria-hidden="true"></a><span class="kw">qqline</span>(BLUPS<span class="op">$</span>BLUP.btw)</span>
<span id="cb349-7"><a href="asreml-biv.html#cb349-7" aria-hidden="true"></a><span class="kw">hist</span>(BLUPS<span class="op">$</span>BLUP.tarsus)</span>
<span id="cb349-8"><a href="asreml-biv.html#cb349-8" aria-hidden="true"></a><span class="kw">qqnorm</span>(BLUPS<span class="op">$</span>BLUP.tarsus)</span>
<span id="cb349-9"><a href="asreml-biv.html#cb349-9" aria-hidden="true"></a><span class="kw">qqline</span>(BLUPS<span class="op">$</span>BLUP.tarsus)</span></code></pre></div>
<p><img src="wam_tuto_files/figure-html/unnamed-chunk-107-1.svg" width="672" /></p>
<p>Here, some simple codes to plot the genetic correlation.</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="asreml-biv.html#cb350-1" aria-hidden="true"></a>FEM &lt;-<span class="st"> </span><span class="kw">subset</span>(BLUPS, SEX <span class="op">==</span><span class="st"> &quot;1&quot;</span>)</span>
<span id="cb350-2"><a href="asreml-biv.html#cb350-2" aria-hidden="true"></a>MAL &lt;-<span class="st"> </span><span class="kw">subset</span>(BLUPS, SEX <span class="op">==</span><span class="st"> &quot;2&quot;</span>)</span>
<span id="cb350-3"><a href="asreml-biv.html#cb350-3" aria-hidden="true"></a><span class="co">#</span></span>
<span id="cb350-4"><a href="asreml-biv.html#cb350-4" aria-hidden="true"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb350-5"><a href="asreml-biv.html#cb350-5" aria-hidden="true"></a><span class="co">#</span></span>
<span id="cb350-6"><a href="asreml-biv.html#cb350-6" aria-hidden="true"></a><span class="kw">plot</span>(BLUP.tarsus <span class="op">~</span><span class="st"> </span>BLUP.btw, FEM, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">las =</span> <span class="fl">1.2</span>, <span class="dt">bty =</span> <span class="st">&quot;o&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;white&quot;</span>)</span>
<span id="cb350-7"><a href="asreml-biv.html#cb350-7" aria-hidden="true"></a><span class="kw">arrows</span>(<span class="dt">x0 =</span> FEM<span class="op">$</span>BLUP.btw, <span class="dt">y0 =</span> FEM<span class="op">$</span>BLUP.tarsus <span class="op">-</span><span class="st"> </span>FEM<span class="op">$</span>SE.tarsus, <span class="dt">x1 =</span> FEM<span class="op">$</span>BLUP.btw, <span class="dt">y1 =</span> FEM<span class="op">$</span>BLUP.tarsus <span class="op">+</span><span class="st"> </span>FEM<span class="op">$</span>SE.tarsus, <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">code =</span> <span class="dv">3</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">length =</span> <span class="dv">0</span>)</span>
<span id="cb350-8"><a href="asreml-biv.html#cb350-8" aria-hidden="true"></a><span class="kw">arrows</span>(<span class="dt">x0 =</span> FEM<span class="op">$</span>BLUP.btw <span class="op">-</span><span class="st"> </span>FEM<span class="op">$</span>SE.btw, <span class="dt">y0 =</span> FEM<span class="op">$</span>BLUP.tarsus, <span class="dt">x1 =</span> FEM<span class="op">$</span>BLUP.btw <span class="op">+</span><span class="st"> </span>FEM<span class="op">$</span>SE.btw, <span class="dt">y1 =</span> FEM<span class="op">$</span>BLUP.tarsus, <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">code =</span> <span class="dv">3</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">length =</span> <span class="dv">0</span>)</span>
<span id="cb350-9"><a href="asreml-biv.html#cb350-9" aria-hidden="true"></a><span class="kw">points</span>(BLUP.tarsus <span class="op">~</span><span class="st"> </span>BLUP.btw, FEM, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">cex =</span> <span class="fl">1.5</span>)</span>
<span id="cb350-10"><a href="asreml-biv.html#cb350-10" aria-hidden="true"></a><span class="kw">points</span>(BLUP.tarsus <span class="op">~</span><span class="st"> </span>BLUP.btw, FEM, <span class="dt">pch =</span> <span class="dv">1</span>, <span class="dt">col =</span> <span class="kw">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.3</span>), <span class="dt">cex =</span> <span class="kw">c</span>(<span class="fl">1.5</span>))</span>
<span id="cb350-11"><a href="asreml-biv.html#cb350-11" aria-hidden="true"></a><span class="kw">mtext</span>(<span class="st">&quot;btw (BV±SE)&quot;</span>, <span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">line =</span> <span class="fl">2.4</span>)</span>
<span id="cb350-12"><a href="asreml-biv.html#cb350-12" aria-hidden="true"></a><span class="kw">mtext</span>(<span class="st">&quot;tarsus (BV±SE)&quot;</span>, <span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">line =</span> <span class="dv">2</span>, <span class="dt">las =</span> <span class="dv">3</span>)</span>
<span id="cb350-13"><a href="asreml-biv.html#cb350-13" aria-hidden="true"></a><span class="co">#</span></span>
<span id="cb350-14"><a href="asreml-biv.html#cb350-14" aria-hidden="true"></a><span class="kw">plot</span>(BLUP.tarsus <span class="op">~</span><span class="st"> </span>BLUP.btw, MAL, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">las =</span> <span class="fl">1.2</span>, <span class="dt">bty =</span> <span class="st">&quot;o&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;white&quot;</span>)</span>
<span id="cb350-15"><a href="asreml-biv.html#cb350-15" aria-hidden="true"></a><span class="kw">arrows</span>(<span class="dt">x0 =</span> MAL<span class="op">$</span>BLUP.btw, <span class="dt">y0 =</span> MAL<span class="op">$</span>BLUP.tarsus <span class="op">-</span><span class="st"> </span>MAL<span class="op">$</span>SE.tarsus, <span class="dt">x1 =</span> MAL<span class="op">$</span>BLUP.btw, <span class="dt">y1 =</span> MAL<span class="op">$</span>BLUP.tarsus <span class="op">+</span><span class="st"> </span>MAL<span class="op">$</span>SE.tarsus, <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">code =</span> <span class="dv">3</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">length =</span> <span class="dv">0</span>)</span>
<span id="cb350-16"><a href="asreml-biv.html#cb350-16" aria-hidden="true"></a><span class="kw">arrows</span>(<span class="dt">x0 =</span> MAL<span class="op">$</span>BLUP.btw <span class="op">-</span><span class="st"> </span>MAL<span class="op">$</span>SE.btw, <span class="dt">y0 =</span> MAL<span class="op">$</span>BLUP.tarsus, <span class="dt">x1 =</span> MAL<span class="op">$</span>BLUP.btw <span class="op">+</span><span class="st"> </span>MAL<span class="op">$</span>SE.btw, <span class="dt">y1 =</span> MAL<span class="op">$</span>BLUP.tarsus, <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">code =</span> <span class="dv">3</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">length =</span> <span class="dv">0</span>)</span>
<span id="cb350-17"><a href="asreml-biv.html#cb350-17" aria-hidden="true"></a><span class="kw">points</span>(BLUP.tarsus <span class="op">~</span><span class="st"> </span>BLUP.btw, MAL, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">cex =</span> <span class="fl">1.5</span>)</span>
<span id="cb350-18"><a href="asreml-biv.html#cb350-18" aria-hidden="true"></a><span class="kw">points</span>(BLUP.tarsus <span class="op">~</span><span class="st"> </span>BLUP.btw, MAL, <span class="dt">pch =</span> <span class="dv">1</span>, <span class="dt">col =</span> <span class="kw">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.3</span>), <span class="dt">cex =</span> <span class="kw">c</span>(<span class="fl">1.5</span>))</span>
<span id="cb350-19"><a href="asreml-biv.html#cb350-19" aria-hidden="true"></a><span class="kw">mtext</span>(<span class="st">&quot;btw (BV±SE)&quot;</span>, <span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">line =</span> <span class="fl">2.4</span>)</span>
<span id="cb350-20"><a href="asreml-biv.html#cb350-20" aria-hidden="true"></a><span class="kw">mtext</span>(<span class="st">&quot;tarsus (BV±SE)&quot;</span>, <span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">line =</span> <span class="dv">2</span>, <span class="dt">las =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="wam_tuto_files/figure-html/unnamed-chunk-108-1.svg" width="672" /></p>
</div>
<div id="between-groups-covariances-and-the-b-matrix" class="section level3 hasAnchor" number="3.2.7">
<h3><span class="header-section-number">3.2.7</span> Between groups (co)variances and the B-matrix<a href="asreml-biv.html#between-groups-covariances-and-the-b-matrix" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Animal models are amazing model. With different group within a population, it is also possible to estimate how much the different groups shared the same genetic via the cross-group genetic covariance.
This covariance is essential to understand ontogenic or sexual conflict, which can constraint or enhanced response to evolution.
As an example, we estimate the cross-sex genetic correlation <code>r_{fm}</code></p>
<p>First, we need to dissociate the trait values for females and males into distinct variables. Then, we use a bivariate model (for one trait: <code>tarsus</code>) and a multivariate model (for various traits: <code>tarsus</code> and <code>bwt</code>). With a multivariate model, the cross-sex-cross trait covariance matrixis also named <code>B matrix</code>.</p>
<p>The coding is a bit complex but pretty straightforward. It is important to modify the covariance matrix at the residual level to avoid the calculation of a cross-sex residual covariance (no individual switched sex during the experiment).</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="asreml-biv.html#cb351-1" aria-hidden="true"></a>gryphon<span class="op">$</span>bwt<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb351-2"><a href="asreml-biv.html#cb351-2" aria-hidden="true"></a>gryphon<span class="op">$</span>tarsus<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb351-3"><a href="asreml-biv.html#cb351-3" aria-hidden="true"></a>animal &lt;-<span class="st"> </span>gryphon[gryphon<span class="op">$</span>sex <span class="op">==</span><span class="st"> &quot;1&quot;</span>, ]<span class="op">$</span>animal</span>
<span id="cb351-4"><a href="asreml-biv.html#cb351-4" aria-hidden="true"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">unique</span>(animal)) {</span>
<span id="cb351-5"><a href="asreml-biv.html#cb351-5" aria-hidden="true"></a>  gryphon<span class="op">$</span>bwt<span class="fl">.1</span>[<span class="kw">which</span>(gryphon<span class="op">$</span>animal <span class="op">==</span><span class="st"> </span>i)] &lt;-<span class="st"> </span>gryphon<span class="op">$</span>bwt[<span class="kw">which</span>(gryphon<span class="op">$</span>animal <span class="op">==</span><span class="st"> </span>i)]</span>
<span id="cb351-6"><a href="asreml-biv.html#cb351-6" aria-hidden="true"></a>  gryphon<span class="op">$</span>tarsus<span class="fl">.1</span>[<span class="kw">which</span>(gryphon<span class="op">$</span>animal <span class="op">==</span><span class="st"> </span>i)] &lt;-<span class="st"> </span>gryphon<span class="op">$</span>tarsus[<span class="kw">which</span>(gryphon<span class="op">$</span>animal <span class="op">==</span><span class="st"> </span>i)]</span>
<span id="cb351-7"><a href="asreml-biv.html#cb351-7" aria-hidden="true"></a>}</span>
<span id="cb351-8"><a href="asreml-biv.html#cb351-8" aria-hidden="true"></a><span class="co">#</span></span>
<span id="cb351-9"><a href="asreml-biv.html#cb351-9" aria-hidden="true"></a>gryphon<span class="op">$</span>bwt<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb351-10"><a href="asreml-biv.html#cb351-10" aria-hidden="true"></a>gryphon<span class="op">$</span>tarsus<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb351-11"><a href="asreml-biv.html#cb351-11" aria-hidden="true"></a>animal &lt;-<span class="st"> </span>gryphon[gryphon<span class="op">$</span>sex <span class="op">==</span><span class="st"> &quot;2&quot;</span>, ]<span class="op">$</span>animal</span>
<span id="cb351-12"><a href="asreml-biv.html#cb351-12" aria-hidden="true"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">unique</span>(animal)) {</span>
<span id="cb351-13"><a href="asreml-biv.html#cb351-13" aria-hidden="true"></a>  gryphon<span class="op">$</span>bwt<span class="fl">.2</span>[<span class="kw">which</span>(gryphon<span class="op">$</span>animal <span class="op">==</span><span class="st"> </span>i)] &lt;-<span class="st"> </span>gryphon<span class="op">$</span>bwt[<span class="kw">which</span>(gryphon<span class="op">$</span>animal <span class="op">==</span><span class="st"> </span>i)]</span>
<span id="cb351-14"><a href="asreml-biv.html#cb351-14" aria-hidden="true"></a>  gryphon<span class="op">$</span>tarsus<span class="fl">.2</span>[<span class="kw">which</span>(gryphon<span class="op">$</span>animal <span class="op">==</span><span class="st"> </span>i)] &lt;-<span class="st"> </span>gryphon<span class="op">$</span>tarsus[<span class="kw">which</span>(gryphon<span class="op">$</span>animal <span class="op">==</span><span class="st"> </span>i)]</span>
<span id="cb351-15"><a href="asreml-biv.html#cb351-15" aria-hidden="true"></a>}</span>
<span id="cb351-16"><a href="asreml-biv.html#cb351-16" aria-hidden="true"></a></span>
<span id="cb351-17"><a href="asreml-biv.html#cb351-17" aria-hidden="true"></a><span class="co">###########</span></span>
<span id="cb351-18"><a href="asreml-biv.html#cb351-18" aria-hidden="true"></a>temp &lt;-<span class="st"> </span><span class="kw">asreml</span>(<span class="kw">cbind</span>(tarsus<span class="fl">.1</span>, tarsus<span class="fl">.2</span>) <span class="op">~</span><span class="st"> </span>trait,</span>
<span id="cb351-19"><a href="asreml-biv.html#cb351-19" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="kw">us</span>(trait)<span class="op">:</span><span class="kw">vm</span>(animal, ainv) <span class="op">+</span></span>
<span id="cb351-20"><a href="asreml-biv.html#cb351-20" aria-hidden="true"></a><span class="st">    </span><span class="kw">diag</span>(trait)<span class="op">:</span>byear <span class="op">+</span><span class="st"> </span><span class="kw">diag</span>(trait)<span class="op">:</span>mother,</span>
<span id="cb351-21"><a href="asreml-biv.html#cb351-21" aria-hidden="true"></a>  <span class="dt">residual =</span> <span class="op">~</span><span class="st"> </span>units<span class="op">:</span><span class="kw">us</span>(trait),</span>
<span id="cb351-22"><a href="asreml-biv.html#cb351-22" aria-hidden="true"></a>  <span class="dt">data =</span> gryphon, <span class="dt">na.action =</span> <span class="kw">na.method</span>(<span class="dt">y =</span> <span class="st">&quot;include&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;include&quot;</span>), <span class="dt">maxiter =</span> <span class="dv">20</span>,</span>
<span id="cb351-23"><a href="asreml-biv.html#cb351-23" aria-hidden="true"></a>  <span class="dt">start.values =</span> T</span>
<span id="cb351-24"><a href="asreml-biv.html#cb351-24" aria-hidden="true"></a>)</span>
<span id="cb351-25"><a href="asreml-biv.html#cb351-25" aria-hidden="true"></a>G &lt;-<span class="st"> </span>temp<span class="op">$</span>vparameters[(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>), ]</span>
<span id="cb351-26"><a href="asreml-biv.html#cb351-26" aria-hidden="true"></a>R &lt;-<span class="st"> </span>temp<span class="op">$</span>vparameters[<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>), ]</span>
<span id="cb351-27"><a href="asreml-biv.html#cb351-27" aria-hidden="true"></a><span class="co">#</span></span>
<span id="cb351-28"><a href="asreml-biv.html#cb351-28" aria-hidden="true"></a>G<span class="op">$</span>Constraint &lt;-<span class="st"> &quot;U&quot;</span></span>
<span id="cb351-29"><a href="asreml-biv.html#cb351-29" aria-hidden="true"></a>R<span class="op">$</span>Value[<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb351-30"><a href="asreml-biv.html#cb351-30" aria-hidden="true"></a>R<span class="op">$</span>Constraint[<span class="dv">3</span>] &lt;-<span class="st"> &quot;F&quot;</span></span>
<span id="cb351-31"><a href="asreml-biv.html#cb351-31" aria-hidden="true"></a><span class="co">#</span></span>
<span id="cb351-32"><a href="asreml-biv.html#cb351-32" aria-hidden="true"></a>model.BiV_Sex &lt;-<span class="st"> </span><span class="kw">asreml</span>(<span class="kw">cbind</span>(tarsus<span class="fl">.1</span>, tarsus<span class="fl">.2</span>) <span class="op">~</span><span class="st"> </span>trait,</span>
<span id="cb351-33"><a href="asreml-biv.html#cb351-33" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="kw">us</span>(trait)<span class="op">:</span><span class="kw">vm</span>(animal, ainv) <span class="op">+</span></span>
<span id="cb351-34"><a href="asreml-biv.html#cb351-34" aria-hidden="true"></a><span class="st">    </span><span class="kw">diag</span>(trait)<span class="op">:</span>byear <span class="op">+</span><span class="st"> </span><span class="kw">diag</span>(trait)<span class="op">:</span>mother,</span>
<span id="cb351-35"><a href="asreml-biv.html#cb351-35" aria-hidden="true"></a>  <span class="dt">residual =</span> <span class="op">~</span><span class="st"> </span>units<span class="op">:</span><span class="kw">us</span>(trait),</span>
<span id="cb351-36"><a href="asreml-biv.html#cb351-36" aria-hidden="true"></a>  <span class="dt">data =</span> gryphon, <span class="dt">na.action =</span> <span class="kw">na.method</span>(<span class="dt">y =</span> <span class="st">&quot;include&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;include&quot;</span>), <span class="dt">maxiter =</span> <span class="dv">20</span>,</span>
<span id="cb351-37"><a href="asreml-biv.html#cb351-37" aria-hidden="true"></a>  <span class="dt">G.param =</span> G, <span class="dt">R.param =</span> R</span>
<span id="cb351-38"><a href="asreml-biv.html#cb351-38" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## Model fitted using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:21 2022
##           LogLik        Sigma2     DF     wall    cpu
##  1     -1494.807           1.0    681 16:50:21    0.0 (1 restrained)
##  2     -1484.793           1.0    681 16:50:21    0.0 (1 restrained)
##  3     -1475.726           1.0    681 16:50:21    0.0 (1 restrained)
##  4     -1471.905           1.0    681 16:50:21    0.0 (1 restrained)
##  5     -1470.716           1.0    681 16:50:21    0.0
##  6     -1468.154           1.0    681 16:50:21    0.0
##  7     -1467.969           1.0    681 16:50:21    0.0
##  8     -1467.967           1.0    681 16:50:21    0.0</code></pre>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="asreml-biv.html#cb353-1" aria-hidden="true"></a>model.BiV_Sex &lt;-<span class="st"> </span><span class="kw">update.asreml</span>(model.BiV_Sex)</span></code></pre></div>
<pre><code>## Model fitted using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:21 2022
##           LogLik        Sigma2     DF     wall    cpu
##  1     -1467.967           1.0    681 16:50:21    0.0
##  2     -1467.967           1.0    681 16:50:21    0.0</code></pre>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="asreml-biv.html#cb355-1" aria-hidden="true"></a><span class="co">#</span></span>
<span id="cb355-2"><a href="asreml-biv.html#cb355-2" aria-hidden="true"></a><span class="kw">summary</span>(model.BiV_Sex)<span class="op">$</span>varcomp</span></code></pre></div>
<pre><code>##                                                component std.error   z.ratio
## trait:byear!trait_tarsus.1                      3.280319  1.532909 2.1399299
## trait:byear!trait_tarsus.2                      4.743134  1.891252 2.5079332
## trait:mother!trait_tarsus.1                     1.875132  2.424092 0.7735398
## trait:mother!trait_tarsus.2                     4.314158  2.785254 1.5489283
## trait:vm(animal, ainv)!trait_tarsus.1:tarsus.1  6.582654  3.636467 1.8101781
## trait:vm(animal, ainv)!trait_tarsus.2:tarsus.1  8.396245  3.278591 2.5609306
## trait:vm(animal, ainv)!trait_tarsus.2:tarsus.2 12.898424  8.038362 1.6046084
## units:trait!R                                   1.000000        NA        NA
## units:trait!trait_tarsus.1:tarsus.1            14.872757  3.637545 4.0886803
## units:trait!trait_tarsus.2:tarsus.1             0.000000        NA        NA
## units:trait!trait_tarsus.2:tarsus.2            10.760849  6.294585 1.7095406
##                                                bound %ch
## trait:byear!trait_tarsus.1                         U   0
## trait:byear!trait_tarsus.2                         U   0
## trait:mother!trait_tarsus.1                        U   0
## trait:mother!trait_tarsus.2                        U   0
## trait:vm(animal, ainv)!trait_tarsus.1:tarsus.1     U   0
## trait:vm(animal, ainv)!trait_tarsus.2:tarsus.1     U   0
## trait:vm(animal, ainv)!trait_tarsus.2:tarsus.2     U   0
## units:trait!R                                      F   0
## units:trait!trait_tarsus.1:tarsus.1                P   0
## units:trait!trait_tarsus.2:tarsus.1                F  NA
## units:trait!trait_tarsus.2:tarsus.2                P   0</code></pre>
<p>The cross-sex genetic correlation can estimate form the output of the model.
For tarsus length at fledging, sexes shared a lot of genetic variance which is commun for a trait with low sexual dimorphism. If the selection is antagonistic between males and females, sexes can not evolve freely form the other sexes and a sexual conflict appears.</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="asreml-biv.html#cb357-1" aria-hidden="true"></a><span class="kw">vpredict</span>(model.BiV_Sex, r_fm <span class="op">~</span><span class="st"> </span>V6 <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(V5 <span class="op">*</span><span class="st"> </span>V7))</span></code></pre></div>
<pre><code>##       Estimate        SE
## r_fm 0.9112054 0.4229764</code></pre>
<p>We can estimate directly the correlation and plot the cross-sex genetic correlation</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="asreml-biv.html#cb359-1" aria-hidden="true"></a>temp &lt;-<span class="st"> </span><span class="kw">asreml</span>(<span class="kw">cbind</span>(tarsus<span class="fl">.1</span>, tarsus<span class="fl">.2</span>) <span class="op">~</span><span class="st"> </span>trait,</span>
<span id="cb359-2"><a href="asreml-biv.html#cb359-2" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="kw">corgh</span>(trait)<span class="op">:</span><span class="kw">vm</span>(animal, ainv) <span class="op">+</span></span>
<span id="cb359-3"><a href="asreml-biv.html#cb359-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">diag</span>(trait)<span class="op">:</span>byear <span class="op">+</span><span class="st"> </span><span class="kw">diag</span>(trait)<span class="op">:</span>mother,</span>
<span id="cb359-4"><a href="asreml-biv.html#cb359-4" aria-hidden="true"></a>  <span class="dt">residual =</span> <span class="op">~</span><span class="st"> </span>units<span class="op">:</span><span class="kw">corgh</span>(trait),</span>
<span id="cb359-5"><a href="asreml-biv.html#cb359-5" aria-hidden="true"></a>  <span class="dt">data =</span> gryphon, <span class="dt">na.action =</span> <span class="kw">na.method</span>(<span class="dt">y =</span> <span class="st">&quot;include&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;include&quot;</span>), <span class="dt">maxiter =</span> <span class="dv">20</span>,</span>
<span id="cb359-6"><a href="asreml-biv.html#cb359-6" aria-hidden="true"></a>  <span class="dt">start.values =</span> T</span>
<span id="cb359-7"><a href="asreml-biv.html#cb359-7" aria-hidden="true"></a>)</span>
<span id="cb359-8"><a href="asreml-biv.html#cb359-8" aria-hidden="true"></a>G &lt;-<span class="st"> </span>temp<span class="op">$</span>vparameters[(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>), ]</span>
<span id="cb359-9"><a href="asreml-biv.html#cb359-9" aria-hidden="true"></a>R &lt;-<span class="st"> </span>temp<span class="op">$</span>vparameters[<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>), ]</span>
<span id="cb359-10"><a href="asreml-biv.html#cb359-10" aria-hidden="true"></a><span class="co">#</span></span>
<span id="cb359-11"><a href="asreml-biv.html#cb359-11" aria-hidden="true"></a>G<span class="op">$</span>Constraint &lt;-<span class="st"> &quot;U&quot;</span></span>
<span id="cb359-12"><a href="asreml-biv.html#cb359-12" aria-hidden="true"></a>R<span class="op">$</span>Value[<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb359-13"><a href="asreml-biv.html#cb359-13" aria-hidden="true"></a>R<span class="op">$</span>Constraint[<span class="dv">2</span>] &lt;-<span class="st"> &quot;F&quot;</span></span>
<span id="cb359-14"><a href="asreml-biv.html#cb359-14" aria-hidden="true"></a><span class="co">#</span></span>
<span id="cb359-15"><a href="asreml-biv.html#cb359-15" aria-hidden="true"></a>model.BiV_Sex &lt;-<span class="st"> </span><span class="kw">asreml</span>(<span class="kw">cbind</span>(tarsus<span class="fl">.1</span>, tarsus<span class="fl">.2</span>) <span class="op">~</span><span class="st"> </span>trait,</span>
<span id="cb359-16"><a href="asreml-biv.html#cb359-16" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="kw">corgh</span>(trait)<span class="op">:</span><span class="kw">vm</span>(animal, ainv) <span class="op">+</span></span>
<span id="cb359-17"><a href="asreml-biv.html#cb359-17" aria-hidden="true"></a><span class="st">    </span><span class="kw">diag</span>(trait)<span class="op">:</span>byear <span class="op">+</span><span class="st"> </span><span class="kw">diag</span>(trait)<span class="op">:</span>mother,</span>
<span id="cb359-18"><a href="asreml-biv.html#cb359-18" aria-hidden="true"></a>  <span class="dt">residual =</span> <span class="op">~</span><span class="st"> </span>units<span class="op">:</span><span class="kw">corgh</span>(trait),</span>
<span id="cb359-19"><a href="asreml-biv.html#cb359-19" aria-hidden="true"></a>  <span class="dt">data =</span> gryphon, <span class="dt">na.action =</span> <span class="kw">na.method</span>(<span class="dt">y =</span> <span class="st">&quot;include&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;include&quot;</span>), <span class="dt">maxiter =</span> <span class="dv">20</span>,</span>
<span id="cb359-20"><a href="asreml-biv.html#cb359-20" aria-hidden="true"></a>  <span class="dt">G.param =</span> G, <span class="dt">R.param =</span> R</span>
<span id="cb359-21"><a href="asreml-biv.html#cb359-21" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## Model fitted using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:22 2022
##           LogLik        Sigma2     DF     wall    cpu
##  1     -1494.323           1.0    681 16:50:22    0.0 (1 restrained)
##  2     -1482.996           1.0    681 16:50:22    0.0 (1 restrained)
##  3     -1472.827           1.0    681 16:50:22    0.0 (1 restrained)
##  4     -1468.707           1.0    681 16:50:22    0.0
##  5     -1467.984           1.0    681 16:50:22    0.0
##  6     -1467.968           1.0    681 16:50:22    0.0
##  7     -1467.967           1.0    681 16:50:22    0.0</code></pre>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="asreml-biv.html#cb361-1" aria-hidden="true"></a>model.BiV_Sex &lt;-<span class="st"> </span><span class="kw">update.asreml</span>(model.BiV_Sex)</span></code></pre></div>
<pre><code>## Model fitted using the sigma parameterization.
## ASReml 4.1.0 Tue Nov 29 16:50:22 2022
##           LogLik        Sigma2     DF     wall    cpu
##  1     -1467.967           1.0    681 16:50:22    0.1
##  2     -1467.967           1.0    681 16:50:22    0.0</code></pre>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="asreml-biv.html#cb363-1" aria-hidden="true"></a><span class="co">#</span></span>
<span id="cb363-2"><a href="asreml-biv.html#cb363-2" aria-hidden="true"></a><span class="kw">summary</span>(model.BiV_Sex)<span class="op">$</span>varcomp</span></code></pre></div>
<pre><code>##                                                            component std.error
## trait:byear!trait_tarsus.1                                 3.2803263 1.5329224
## trait:byear!trait_tarsus.2                                 4.7431679 1.8913244
## trait:mother!trait_tarsus.1                                1.8751274 2.4240942
## trait:mother!trait_tarsus.2                                4.3141262 2.7852550
## trait:vm(animal, ainv)!trait!tarsus.2:!trait!tarsus.1.cor  0.9111864 0.4230261
## trait:vm(animal, ainv)!trait_tarsus.1                      6.5826478 3.6364929
## trait:vm(animal, ainv)!trait_tarsus.2                     12.8988848 8.0388517
## units:trait!R                                              1.0000000        NA
## units:trait!trait!tarsus.2:!trait!tarsus.1.cor             0.0000000        NA
## units:trait!trait_tarsus.1                                14.8727602 3.6375549
## units:trait!trait_tarsus.2                                10.7604420 6.2948051
##                                                             z.ratio bound %ch
## trait:byear!trait_tarsus.1                                2.1399167     U   0
## trait:byear!trait_tarsus.2                                2.5078553     U   0
## trait:mother!trait_tarsus.1                               0.7735373     U   0
## trait:mother!trait_tarsus.2                               1.5489160     U   0
## trait:vm(animal, ainv)!trait!tarsus.2:!trait!tarsus.1.cor 2.1539720     U   0
## trait:vm(animal, ainv)!trait_tarsus.1                     1.8101638     U   0
## trait:vm(animal, ainv)!trait_tarsus.2                     1.6045681     U   0
## units:trait!R                                                    NA     F   0
## units:trait!trait!tarsus.2:!trait!tarsus.1.cor                   NA     F  NA
## units:trait!trait_tarsus.1                                4.0886696     P   0
## units:trait!trait_tarsus.2                                1.7094162     P   0</code></pre>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="asreml-biv.html#cb365-1" aria-hidden="true"></a><span class="co">###########</span></span>
<span id="cb365-2"><a href="asreml-biv.html#cb365-2" aria-hidden="true"></a>DvsS &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb365-3"><a href="asreml-biv.html#cb365-3" aria-hidden="true"></a>  <span class="dt">Trait =</span> <span class="kw">rownames</span>(model.BiV_Sex<span class="op">$</span>coefficients<span class="op">$</span>random),</span>
<span id="cb365-4"><a href="asreml-biv.html#cb365-4" aria-hidden="true"></a>  <span class="dt">BLUP =</span> model.BiV_Sex<span class="op">$</span>coefficients<span class="op">$</span>random,</span>
<span id="cb365-5"><a href="asreml-biv.html#cb365-5" aria-hidden="true"></a>  <span class="dt">SE =</span> <span class="kw">sqrt</span>(model.BiV_Sex<span class="op">$</span>vcoeff<span class="op">$</span>random <span class="op">*</span><span class="st"> </span>model.BiV_Sex<span class="op">$</span>sigma2)</span>
<span id="cb365-6"><a href="asreml-biv.html#cb365-6" aria-hidden="true"></a>)</span>
<span id="cb365-7"><a href="asreml-biv.html#cb365-7" aria-hidden="true"></a>DvsS<span class="op">$</span>ID &lt;-<span class="st"> </span><span class="kw">substr</span>(DvsS<span class="op">$</span>Trait, <span class="dv">33</span>, <span class="dv">35</span>)</span>
<span id="cb365-8"><a href="asreml-biv.html#cb365-8" aria-hidden="true"></a>DvsS<span class="op">$</span>TRAIT &lt;-<span class="st"> </span><span class="kw">substr</span>(DvsS<span class="op">$</span>Trait, <span class="dv">7</span>, <span class="dv">14</span>)</span>
<span id="cb365-9"><a href="asreml-biv.html#cb365-9" aria-hidden="true"></a>DvsS &lt;-<span class="st"> </span>DvsS[<span class="dv">927</span><span class="op">:</span><span class="dv">3544</span>, ] <span class="co"># keep only row associated to animal</span></span>
<span id="cb365-10"><a href="asreml-biv.html#cb365-10" aria-hidden="true"></a><span class="kw">summary</span>(<span class="kw">factor</span>(DvsS<span class="op">$</span>TRAIT))</span></code></pre></div>
<pre><code>## tarsus.1 tarsus.2 
##     1309     1309</code></pre>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="asreml-biv.html#cb367-1" aria-hidden="true"></a><span class="co">#</span></span>
<span id="cb367-2"><a href="asreml-biv.html#cb367-2" aria-hidden="true"></a>DvsS<span class="op">$</span>Trait &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb367-3"><a href="asreml-biv.html#cb367-3" aria-hidden="true"></a><span class="kw">colnames</span>(DvsS)[<span class="dv">1</span>] &lt;-<span class="st"> &quot;BLUP&quot;</span></span>
<span id="cb367-4"><a href="asreml-biv.html#cb367-4" aria-hidden="true"></a>BLUPS &lt;-<span class="st"> </span><span class="kw">reshape</span>(DvsS, <span class="dt">v.names =</span> <span class="kw">c</span>(<span class="st">&quot;BLUP&quot;</span>, <span class="st">&quot;SE&quot;</span>), <span class="dt">idvar =</span> <span class="st">&quot;ID&quot;</span>, <span class="dt">timevar =</span> <span class="st">&quot;TRAIT&quot;</span>, <span class="dt">direction =</span> <span class="st">&quot;wide&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in reshapeWide(data, idvar = idvar, timevar = timevar, varying =
## varying, : multiple rows match for TRAIT=tarsus.1: first taken</code></pre>
<pre><code>## Warning in reshapeWide(data, idvar = idvar, timevar = timevar, varying =
## varying, : multiple rows match for TRAIT=tarsus.2: first taken</code></pre>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="asreml-biv.html#cb370-1" aria-hidden="true"></a><span class="kw">nrow</span>(BLUPS)</span></code></pre></div>
<pre><code>## [1] 999</code></pre>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="asreml-biv.html#cb372-1" aria-hidden="true"></a><span class="kw">rownames</span>(BLUPS) &lt;-<span class="st"> </span><span class="kw">c</span>()</span>
<span id="cb372-2"><a href="asreml-biv.html#cb372-2" aria-hidden="true"></a><span class="kw">colnames</span>(BLUPS) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;BLUP.1&quot;</span>, <span class="st">&quot;SE.1&quot;</span>, <span class="st">&quot;BLUP.2&quot;</span>, <span class="st">&quot;SE.2&quot;</span>)</span>
<span id="cb372-3"><a href="asreml-biv.html#cb372-3" aria-hidden="true"></a><span class="kw">summary</span>(BLUPS)</span></code></pre></div>
<pre><code>##       ID                BLUP.1              SE.1           BLUP.2        
##  Length:999         Min.   :-4.27022   Min.   :1.724   Min.   :-5.98516  
##  Class :character   1st Qu.:-0.69816   1st Qu.:2.010   1st Qu.:-0.99808  
##  Mode  :character   Median : 0.00000   Median :2.143   Median : 0.00000  
##                     Mean   : 0.05588   Mean   :2.204   Mean   : 0.06904  
##                     3rd Qu.: 0.84250   3rd Qu.:2.426   3rd Qu.: 1.13426  
##                     Max.   : 4.55405   Max.   :2.567   Max.   : 6.35309  
##       SE.2      
##  Min.   :2.375  
##  1st Qu.:2.677  
##  Median :3.055  
##  Mean   :3.047  
##  3rd Qu.:3.378  
##  Max.   :3.591</code></pre>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="asreml-biv.html#cb374-1" aria-hidden="true"></a><span class="co">###########</span></span>
<span id="cb374-2"><a href="asreml-biv.html#cb374-2" aria-hidden="true"></a>Y &lt;-<span class="st"> </span>BLUPS<span class="op">$</span>BLUP<span class="fl">.1</span></span>
<span id="cb374-3"><a href="asreml-biv.html#cb374-3" aria-hidden="true"></a>X &lt;-<span class="st"> </span>BLUPS<span class="op">$</span>BLUP<span class="fl">.2</span></span>
<span id="cb374-4"><a href="asreml-biv.html#cb374-4" aria-hidden="true"></a>se.Y &lt;-<span class="st"> </span>BLUPS<span class="op">$</span>SE<span class="fl">.1</span></span>
<span id="cb374-5"><a href="asreml-biv.html#cb374-5" aria-hidden="true"></a>se.X &lt;-<span class="st"> </span>BLUPS<span class="op">$</span>SE<span class="fl">.2</span></span>
<span id="cb374-6"><a href="asreml-biv.html#cb374-6" aria-hidden="true"></a></span>
<span id="cb374-7"><a href="asreml-biv.html#cb374-7" aria-hidden="true"></a><span class="kw">plot</span>(X, Y, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">las =</span> <span class="fl">1.2</span>, <span class="dt">bty =</span> <span class="st">&quot;o&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;white&quot;</span>)</span>
<span id="cb374-8"><a href="asreml-biv.html#cb374-8" aria-hidden="true"></a><span class="kw">arrows</span>(<span class="dt">x0 =</span> X, <span class="dt">y0 =</span> Y <span class="op">-</span><span class="st"> </span>se.Y, <span class="dt">x1 =</span> X, <span class="dt">y1 =</span> Y <span class="op">+</span><span class="st"> </span>se.Y, <span class="dt">col =</span> <span class="kw">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">code =</span> <span class="dv">3</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">length =</span> <span class="dv">0</span>)</span>
<span id="cb374-9"><a href="asreml-biv.html#cb374-9" aria-hidden="true"></a><span class="kw">arrows</span>(<span class="dt">x0 =</span> X <span class="op">-</span><span class="st"> </span>se.X, <span class="dt">y0 =</span> Y, <span class="dt">x1 =</span> X <span class="op">+</span><span class="st"> </span>se.X, <span class="dt">y1 =</span> Y, <span class="dt">col =</span> <span class="kw">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">code =</span> <span class="dv">3</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">length =</span> <span class="dv">0</span>)</span>
<span id="cb374-10"><a href="asreml-biv.html#cb374-10" aria-hidden="true"></a><span class="kw">points</span>(X, Y, <span class="dt">pch =</span> <span class="dv">1</span>, <span class="dt">col =</span> <span class="kw">rgb</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>), <span class="dt">cex =</span> <span class="fl">1.5</span>)</span>
<span id="cb374-11"><a href="asreml-biv.html#cb374-11" aria-hidden="true"></a><span class="kw">points</span>(X, Y, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="kw">rgb</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>), <span class="dt">cex =</span> <span class="fl">1.5</span>)</span>
<span id="cb374-12"><a href="asreml-biv.html#cb374-12" aria-hidden="true"></a><span class="co"># abline(v=0,lty=3);abline(h=0,lty=3)</span></span>
<span id="cb374-13"><a href="asreml-biv.html#cb374-13" aria-hidden="true"></a><span class="kw">mtext</span>(<span class="st">&quot;Male tarsus (BV±SE)&quot;</span>, <span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">line =</span> <span class="dv">2</span>, <span class="dt">las =</span> <span class="dv">3</span>)</span>
<span id="cb374-14"><a href="asreml-biv.html#cb374-14" aria-hidden="true"></a><span class="kw">mtext</span>(<span class="st">&quot;Female tarsus (BV±SE)&quot;</span>, <span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">line =</span> <span class="fl">2.2</span>)</span></code></pre></div>
<p><img src="wam_tuto_files/figure-html/unnamed-chunk-111-1.svg" width="672" /></p>
<p>The B matrix used the same code but in a multivariate animal model framework. Here some example code, however due to the nature of the dataset, the cross-sex genetic covariance for birth weight is hard to estimate making difficulty to fit this multivariate animal model.</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="asreml-biv.html#cb375-1" aria-hidden="true"></a>temp &lt;-<span class="st"> </span><span class="kw">asreml</span>(<span class="kw">cbind</span>(tarsus<span class="fl">.1</span>, bwt<span class="fl">.1</span>, tarsus<span class="fl">.2</span>, bwt<span class="fl">.2</span>) <span class="op">~</span><span class="st"> </span>trait,</span>
<span id="cb375-2"><a href="asreml-biv.html#cb375-2" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="kw">us</span>(trait)<span class="op">:</span><span class="kw">vm</span>(animal, ainv) <span class="op">+</span></span>
<span id="cb375-3"><a href="asreml-biv.html#cb375-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">diag</span>(trait)<span class="op">:</span>byear <span class="op">+</span><span class="st"> </span><span class="kw">diag</span>(trait)<span class="op">:</span>mother,</span>
<span id="cb375-4"><a href="asreml-biv.html#cb375-4" aria-hidden="true"></a>  <span class="dt">residual =</span> <span class="op">~</span><span class="st"> </span>units<span class="op">:</span><span class="kw">us</span>(trait),</span>
<span id="cb375-5"><a href="asreml-biv.html#cb375-5" aria-hidden="true"></a>  <span class="dt">data =</span> gryphon, <span class="dt">na.action =</span> <span class="kw">na.method</span>(<span class="dt">y =</span> <span class="st">&quot;include&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;include&quot;</span>), <span class="dt">maxiter =</span> <span class="dv">20</span>,</span>
<span id="cb375-6"><a href="asreml-biv.html#cb375-6" aria-hidden="true"></a>  <span class="dt">start.values =</span> T</span>
<span id="cb375-7"><a href="asreml-biv.html#cb375-7" aria-hidden="true"></a>)</span>
<span id="cb375-8"><a href="asreml-biv.html#cb375-8" aria-hidden="true"></a>G &lt;-<span class="st"> </span>temp<span class="op">$</span>vparameters[(<span class="dv">1</span><span class="op">:</span><span class="dv">18</span>), ]</span>
<span id="cb375-9"><a href="asreml-biv.html#cb375-9" aria-hidden="true"></a>R &lt;-<span class="st"> </span>temp<span class="op">$</span>vparameters[<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">18</span>), ]</span>
<span id="cb375-10"><a href="asreml-biv.html#cb375-10" aria-hidden="true"></a><span class="co">#</span></span>
<span id="cb375-11"><a href="asreml-biv.html#cb375-11" aria-hidden="true"></a>G<span class="op">$</span>Constraint &lt;-<span class="st"> &quot;U&quot;</span></span>
<span id="cb375-12"><a href="asreml-biv.html#cb375-12" aria-hidden="true"></a>R<span class="op">$</span>Value[<span class="dv">5</span><span class="op">:</span><span class="dv">6</span>] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb375-13"><a href="asreml-biv.html#cb375-13" aria-hidden="true"></a>R<span class="op">$</span>Constraint[<span class="dv">5</span><span class="op">:</span><span class="dv">6</span>] &lt;-<span class="st"> &quot;F&quot;</span></span>
<span id="cb375-14"><a href="asreml-biv.html#cb375-14" aria-hidden="true"></a>R<span class="op">$</span>Value[<span class="dv">8</span><span class="op">:</span><span class="dv">9</span>] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb375-15"><a href="asreml-biv.html#cb375-15" aria-hidden="true"></a>R<span class="op">$</span>Constraint[<span class="dv">8</span><span class="op">:</span><span class="dv">9</span>] &lt;-<span class="st"> &quot;F&quot;</span></span>
<span id="cb375-16"><a href="asreml-biv.html#cb375-16" aria-hidden="true"></a><span class="co">#</span></span>
<span id="cb375-17"><a href="asreml-biv.html#cb375-17" aria-hidden="true"></a><span class="co"># model.MultV_Sex&lt;-asreml(cbind(tarsus.1,bwt.1,tarsus.2,bwt.2)~trait,</span></span>
<span id="cb375-18"><a href="asreml-biv.html#cb375-18" aria-hidden="true"></a><span class="co">#          random=~us(trait):vm(animal,ainv)+</span></span>
<span id="cb375-19"><a href="asreml-biv.html#cb375-19" aria-hidden="true"></a><span class="co">#         diag(trait):byear +   diag(trait):mother,</span></span>
<span id="cb375-20"><a href="asreml-biv.html#cb375-20" aria-hidden="true"></a><span class="co">#         residual = ~units:us(trait),</span></span>
<span id="cb375-21"><a href="asreml-biv.html#cb375-21" aria-hidden="true"></a><span class="co">#         data=gryphon,na.action=na.method(y=&quot;include&quot;,x=&quot;include&quot;),maxiter=20,</span></span>
<span id="cb375-22"><a href="asreml-biv.html#cb375-22" aria-hidden="true"></a><span class="co">#     G.param=G,R.param=R)</span></span>
<span id="cb375-23"><a href="asreml-biv.html#cb375-23" aria-hidden="true"></a><span class="co"># model.MultV_Sex&lt;-update.asreml(model.MultV_Sex)</span></span>
<span id="cb375-24"><a href="asreml-biv.html#cb375-24" aria-hidden="true"></a><span class="co">#</span></span>
<span id="cb375-25"><a href="asreml-biv.html#cb375-25" aria-hidden="true"></a><span class="co"># summary(model.MultV_Sex)$varcomp</span></span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="scenario-and-data-1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="gremlin-2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/JulienGAMartin/wam_tuto/edit/master/03_01-biv_asreml.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["wam_tuto.pdf", "wam_tuto.epub", "wam_tuto.mobi"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toc_depth": 4
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
