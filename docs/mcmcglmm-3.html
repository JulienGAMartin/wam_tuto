<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4.4 MCMCglmm | How to fit an animal model</title>
  <meta name="description" content="Updated and extended tutorials from An ecologist guide to animal model (Wilson et al. 2010)" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="4.4 MCMCglmm | How to fit an animal model" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/images/missing.png" />
  <meta property="og:description" content="Updated and extended tutorials from An ecologist guide to animal model (Wilson et al. 2010)" />
  <meta name="github-repo" content="JulienGAMartin/wam_tuto" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4.4 MCMCglmm | How to fit an animal model" />
  
  <meta name="twitter:description" content="Updated and extended tutorials from An ecologist guide to animal model (Wilson et al. 2010)" />
  <meta name="twitter:image" content="/images/missing.png" />

<meta name="author" content="Julien Martin" />
<meta name="author" content="Matthieu Videlier" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="gremlin-3.html"/>
<link rel="next" href="brms-3.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">How to fit an animal model</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i>Contributors</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>1.1</b> Data</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="data.html"><a href="data.html#data-files"><i class="fa fa-check"></i><b>1.1.1</b> Data files</a></li>
<li class="chapter" data-level="1.1.2" data-path="data.html"><a href="data.html#notes-on-data-and-pedigree"><i class="fa fa-check"></i><b>1.1.2</b> Notes on data and pedigree</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="r.html"><a href="r.html"><i class="fa fa-check"></i><b>1.2</b> R</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="r.html"><a href="r.html#r-packages"><i class="fa fa-check"></i><b>1.2.1</b> R packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="univariate-animal-model.html"><a href="univariate-animal-model.html"><i class="fa fa-check"></i><b>2</b> Univariate animal model</a>
<ul>
<li class="chapter" data-level="2.1" data-path="scenario-and-data.html"><a href="scenario-and-data.html"><i class="fa fa-check"></i><b>2.1</b> Scenario and data</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="scenario-and-data.html"><a href="scenario-and-data.html#scenario"><i class="fa fa-check"></i><b>2.1.1</b> Scenario</a></li>
<li class="chapter" data-level="2.1.2" data-path="scenario-and-data.html"><a href="scenario-and-data.html#data-files-1"><i class="fa fa-check"></i><b>2.1.2</b> Data files</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="asreml-r-1.html"><a href="asreml-r-1.html"><i class="fa fa-check"></i><b>2.2</b> Asreml-R</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="asreml-r-1.html"><a href="asreml-r-1.html#running-the-model"><i class="fa fa-check"></i><b>2.2.1</b> Running the model</a></li>
<li class="chapter" data-level="2.2.2" data-path="asreml-r-1.html"><a href="asreml-r-1.html#estimating-heritability"><i class="fa fa-check"></i><b>2.2.2</b> Estimating heritability</a></li>
<li class="chapter" data-level="2.2.3" data-path="asreml-r-1.html"><a href="asreml-r-1.html#adding-fixed-effects"><i class="fa fa-check"></i><b>2.2.3</b> Adding fixed effects</a></li>
<li class="chapter" data-level="2.2.4" data-path="asreml-r-1.html"><a href="asreml-r-1.html#adding-random-effects"><i class="fa fa-check"></i><b>2.2.4</b> Adding random effects</a></li>
<li class="chapter" data-level="2.2.5" data-path="asreml-r-1.html"><a href="asreml-r-1.html#testing-significance-of-random-effects"><i class="fa fa-check"></i><b>2.2.5</b> Testing significance of random effects</a></li>
<li class="chapter" data-level="2.2.6" data-path="asreml-r-1.html"><a href="asreml-r-1.html#further-partitioning-the-variance"><i class="fa fa-check"></i><b>2.2.6</b> Further partitioning the variance</a></li>
<li class="chapter" data-level="2.2.7" data-path="asreml-r-1.html"><a href="asreml-r-1.html#modification-of-the-varaince-matrix-parameters"><i class="fa fa-check"></i><b>2.2.7</b> Modification of the varaince matrix parameters</a></li>
<li class="chapter" data-level="2.2.8" data-path="asreml-r-1.html"><a href="asreml-r-1.html#covariance-between-two-random-effects"><i class="fa fa-check"></i><b>2.2.8</b> Covariance between two random effects</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="gremlin-1.html"><a href="gremlin-1.html"><i class="fa fa-check"></i><b>2.3</b> gremlin</a></li>
<li class="chapter" data-level="2.4" data-path="mcmcglmm-1.html"><a href="mcmcglmm-1.html"><i class="fa fa-check"></i><b>2.4</b> MCMCglmm</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="mcmcglmm-1.html"><a href="mcmcglmm-1.html#running-the-model-1"><i class="fa fa-check"></i><b>2.4.1</b> Running the model</a></li>
<li class="chapter" data-level="2.4.2" data-path="mcmcglmm-1.html"><a href="mcmcglmm-1.html#change-in-iteration-and-sampling"><i class="fa fa-check"></i><b>2.4.2</b> Change in iteration and sampling</a></li>
<li class="chapter" data-level="2.4.3" data-path="mcmcglmm-1.html"><a href="mcmcglmm-1.html#change-priors-parameters"><i class="fa fa-check"></i><b>2.4.3</b> Change priors parameters</a></li>
<li class="chapter" data-level="2.4.4" data-path="mcmcglmm-1.html"><a href="mcmcglmm-1.html#estimating-heritability-1"><i class="fa fa-check"></i><b>2.4.4</b> Estimating heritability</a></li>
<li class="chapter" data-level="2.4.5" data-path="mcmcglmm-1.html"><a href="mcmcglmm-1.html#adding-fixed-effects-1"><i class="fa fa-check"></i><b>2.4.5</b> Adding fixed effects</a></li>
<li class="chapter" data-level="2.4.6" data-path="mcmcglmm-1.html"><a href="mcmcglmm-1.html#adding-random-effects-1"><i class="fa fa-check"></i><b>2.4.6</b> Adding random effects</a></li>
<li class="chapter" data-level="2.4.7" data-path="mcmcglmm-1.html"><a href="mcmcglmm-1.html#testing-significance-of-variance-components"><i class="fa fa-check"></i><b>2.4.7</b> Testing significance of variance components</a></li>
<li class="chapter" data-level="2.4.8" data-path="mcmcglmm-1.html"><a href="mcmcglmm-1.html#further-partitioning-variance"><i class="fa fa-check"></i><b>2.4.8</b> Further partitioning variance</a></li>
<li class="chapter" data-level="2.4.9" data-path="mcmcglmm-1.html"><a href="mcmcglmm-1.html#modification-of-model-parameter"><i class="fa fa-check"></i><b>2.4.9</b> Modification of model parameter</a></li>
<li class="chapter" data-level="2.4.10" data-path="mcmcglmm-1.html"><a href="mcmcglmm-1.html#covariance-between-two-random-effects-1"><i class="fa fa-check"></i><b>2.4.10</b> Covariance between two random effects</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="brms-1.html"><a href="brms-1.html"><i class="fa fa-check"></i><b>2.5</b> brms</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="brms-1.html"><a href="brms-1.html#running-the-model-2"><i class="fa fa-check"></i><b>2.5.1</b> Running the model</a></li>
<li class="chapter" data-level="2.5.2" data-path="brms-1.html"><a href="brms-1.html#adding-fixed-effects-2"><i class="fa fa-check"></i><b>2.5.2</b> Adding fixed effects</a></li>
<li class="chapter" data-level="2.5.3" data-path="brms-1.html"><a href="brms-1.html#adding-random-effects-2"><i class="fa fa-check"></i><b>2.5.3</b> Adding random effects</a></li>
<li class="chapter" data-level="2.5.4" data-path="brms-1.html"><a href="brms-1.html#testing-significance-of-variance-components-1"><i class="fa fa-check"></i><b>2.5.4</b> Testing significance of variance components</a></li>
<li class="chapter" data-level="2.5.5" data-path="brms-1.html"><a href="brms-1.html#further-partitioning-of-the-variance"><i class="fa fa-check"></i><b>2.5.5</b> Further partitioning of the variance</a></li>
<li class="chapter" data-level="2.5.6" data-path="brms-1.html"><a href="brms-1.html#modification-of-model-parameter-1"><i class="fa fa-check"></i><b>2.5.6</b> Modification of model parameter</a></li>
<li class="chapter" data-level="2.5.7" data-path="brms-1.html"><a href="brms-1.html#covariance-between-two-random-effects-2"><i class="fa fa-check"></i><b>2.5.7</b> Covariance between two random effects</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="stan.html"><a href="stan.html"><i class="fa fa-check"></i><b>2.6</b> stan</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="multivariate-animal-model.html"><a href="multivariate-animal-model.html"><i class="fa fa-check"></i><b>3</b> Multivariate animal model</a>
<ul>
<li class="chapter" data-level="3.1" data-path="scenario-and-data-1.html"><a href="scenario-and-data-1.html"><i class="fa fa-check"></i><b>3.1</b> Scenario and data</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="scenario-and-data-1.html"><a href="scenario-and-data-1.html#scenario-1"><i class="fa fa-check"></i><b>3.1.1</b> Scenario</a></li>
<li class="chapter" data-level="3.1.2" data-path="scenario-and-data-1.html"><a href="scenario-and-data-1.html#gryphon-files"><i class="fa fa-check"></i><b>3.1.2</b> gryphon files</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="asreml-biv.html"><a href="asreml-biv.html"><i class="fa fa-check"></i><b>3.2</b> Asreml-R</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="asreml-biv.html"><a href="asreml-biv.html#running-the-model-3"><i class="fa fa-check"></i><b>3.2.1</b> Running the model</a></li>
<li class="chapter" data-level="3.2.2" data-path="asreml-biv.html"><a href="asreml-biv.html#adding-fixed-and-random-effects"><i class="fa fa-check"></i><b>3.2.2</b> Adding fixed and random effects</a></li>
<li class="chapter" data-level="3.2.3" data-path="asreml-biv.html"><a href="asreml-biv.html#significance-testing"><i class="fa fa-check"></i><b>3.2.3</b> Significance testing</a></li>
<li class="chapter" data-level="3.2.4" data-path="asreml-biv.html"><a href="asreml-biv.html#estimate-directly-the-genetic-correlation-within-the-model"><i class="fa fa-check"></i><b>3.2.4</b> Estimate directly the genetic correlation within the model</a></li>
<li class="chapter" data-level="3.2.5" data-path="asreml-biv.html"><a href="asreml-biv.html#visualisation-of-the-correlation-aka-blup-extraction"><i class="fa fa-check"></i><b>3.2.5</b> Visualisation of the correlation (aka BLUP extraction)</a></li>
<li class="chapter" data-level="3.2.6" data-path="asreml-biv.html"><a href="asreml-biv.html#partitionning-covariance-between-groups"><i class="fa fa-check"></i><b>3.2.6</b> Partitionning (co)variance between groups</a></li>
<li class="chapter" data-level="3.2.7" data-path="asreml-biv.html"><a href="asreml-biv.html#between-groups-covariances-and-the-b-matrix"><i class="fa fa-check"></i><b>3.2.7</b> Between groups (co)variances and the B-matrix</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="gremlin-2.html"><a href="gremlin-2.html"><i class="fa fa-check"></i><b>3.3</b> gremlin</a></li>
<li class="chapter" data-level="3.4" data-path="mcmcglmm-2.html"><a href="mcmcglmm-2.html"><i class="fa fa-check"></i><b>3.4</b> MCMCglmm</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="mcmcglmm-2.html"><a href="mcmcglmm-2.html#fitting-the-model"><i class="fa fa-check"></i><b>3.4.1</b> Fitting the model</a></li>
<li class="chapter" data-level="3.4.2" data-path="mcmcglmm-2.html"><a href="mcmcglmm-2.html#adding-fixed-and-random-effects-1"><i class="fa fa-check"></i><b>3.4.2</b> Adding fixed and random effects</a></li>
<li class="chapter" data-level="3.4.3" data-path="mcmcglmm-2.html"><a href="mcmcglmm-2.html#direct-estimate-of-the-correlation-instead-of-the-covariance."><i class="fa fa-check"></i><b>3.4.3</b> Direct estimate of the correlation instead of the covariance.</a></li>
<li class="chapter" data-level="3.4.4" data-path="mcmcglmm-2.html"><a href="mcmcglmm-2.html#partitioning-covariances"><i class="fa fa-check"></i><b>3.4.4</b> Partitioning (co)variances</a></li>
<li class="chapter" data-level="3.4.5" data-path="mcmcglmm-2.html"><a href="mcmcglmm-2.html#between-groups-covariances-and-the-b-matrix-1"><i class="fa fa-check"></i><b>3.4.5</b> Between groups (co)variances and the B-matrix</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="brms-2.html"><a href="brms-2.html"><i class="fa fa-check"></i><b>3.5</b> brms</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="brms-2.html"><a href="brms-2.html#fitting-the-model-1"><i class="fa fa-check"></i><b>3.5.1</b> Fitting the model</a></li>
<li class="chapter" data-level="3.5.2" data-path="brms-2.html"><a href="brms-2.html#adding-fixed-and-random-effects-2"><i class="fa fa-check"></i><b>3.5.2</b> Adding fixed and random effects</a></li>
<li class="chapter" data-level="3.5.3" data-path="brms-2.html"><a href="brms-2.html#partitioning-covariances-1"><i class="fa fa-check"></i><b>3.5.3</b> Partitioning (co)variances</a></li>
<li class="chapter" data-level="3.5.4" data-path="brms-2.html"><a href="brms-2.html#between-groups-covariances-and-the-b-matrix-2"><i class="fa fa-check"></i><b>3.5.4</b> Between groups (co)variances and the B-matrix</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="stan-1.html"><a href="stan-1.html"><i class="fa fa-check"></i><b>3.6</b> stan</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rep_measures.html"><a href="rep_measures.html"><i class="fa fa-check"></i><b>4</b> A repeated measures animal model</a>
<ul>
<li class="chapter" data-level="4.1" data-path="scenario-and-data-2.html"><a href="scenario-and-data-2.html"><i class="fa fa-check"></i><b>4.1</b> Scenario and data</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="scenario-and-data-2.html"><a href="scenario-and-data-2.html#scenario-2"><i class="fa fa-check"></i><b>4.1.1</b> scenario</a></li>
<li class="chapter" data-level="4.1.2" data-path="scenario-and-data-2.html"><a href="scenario-and-data-2.html#data-files-2"><i class="fa fa-check"></i><b>4.1.2</b> Data files</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="asreml-r-2.html"><a href="asreml-r-2.html"><i class="fa fa-check"></i><b>4.2</b> Asreml-R</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="asreml-r-2.html"><a href="asreml-r-2.html#estimating-repeatability"><i class="fa fa-check"></i><b>4.2.1</b> Estimating repeatability</a></li>
<li class="chapter" data-level="4.2.2" data-path="asreml-r-2.html"><a href="asreml-r-2.html#partitioning-additive-and-permanent-environment-effects"><i class="fa fa-check"></i><b>4.2.2</b> Partitioning additive and permanent environment effects</a></li>
<li class="chapter" data-level="4.2.3" data-path="asreml-r-2.html"><a href="asreml-r-2.html#adding-additional-effects-and-testing-significance"><i class="fa fa-check"></i><b>4.2.3</b> Adding additional effects and testing significance</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="gremlin-3.html"><a href="gremlin-3.html"><i class="fa fa-check"></i><b>4.3</b> gremlin</a></li>
<li class="chapter" data-level="4.4" data-path="mcmcglmm-3.html"><a href="mcmcglmm-3.html"><i class="fa fa-check"></i><b>4.4</b> MCMCglmm</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="mcmcglmm-3.html"><a href="mcmcglmm-3.html#estimating-repeatability-1"><i class="fa fa-check"></i><b>4.4.1</b> Estimating repeatability</a></li>
<li class="chapter" data-level="4.4.2" data-path="mcmcglmm-3.html"><a href="mcmcglmm-3.html#partitioning-additive-and-permanent-environment-effects-1"><i class="fa fa-check"></i><b>4.4.2</b> Partitioning additive and permanent environment effects</a></li>
<li class="chapter" data-level="4.4.3" data-path="mcmcglmm-3.html"><a href="mcmcglmm-3.html#adding-additional-effects-and-testing-significance-1"><i class="fa fa-check"></i><b>4.4.3</b> Adding additional effects and testing significance</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="brms-3.html"><a href="brms-3.html"><i class="fa fa-check"></i><b>4.5</b> brms</a></li>
<li class="chapter" data-level="4.6" data-path="stan-2.html"><a href="stan-2.html"><i class="fa fa-check"></i><b>4.6</b> stan</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="quick-comparison-of-codes.html"><a href="quick-comparison-of-codes.html"><i class="fa fa-check"></i><b>5</b> Quick comparison of codes</a>
<ul>
<li class="chapter" data-level="5.1" data-path="univariate-model-with-repeated-measures.html"><a href="univariate-model-with-repeated-measures.html"><i class="fa fa-check"></i><b>5.1</b> Univariate model with repeated measures</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="univariate-model-with-repeated-measures.html"><a href="univariate-model-with-repeated-measures.html#asreml-r-3"><i class="fa fa-check"></i><b>5.1.1</b> Asreml-R</a></li>
<li class="chapter" data-level="5.1.2" data-path="univariate-model-with-repeated-measures.html"><a href="univariate-model-with-repeated-measures.html#gremlin-4"><i class="fa fa-check"></i><b>5.1.2</b> gremlin</a></li>
<li class="chapter" data-level="5.1.3" data-path="univariate-model-with-repeated-measures.html"><a href="univariate-model-with-repeated-measures.html#mcmcglmm-4"><i class="fa fa-check"></i><b>5.1.3</b> MCMCglmm</a></li>
<li class="chapter" data-level="5.1.4" data-path="univariate-model-with-repeated-measures.html"><a href="univariate-model-with-repeated-measures.html#brms-4"><i class="fa fa-check"></i><b>5.1.4</b> brms</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="bivariate-model.html"><a href="bivariate-model.html"><i class="fa fa-check"></i><b>5.2</b> bivariate model</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="bivariate-model.html"><a href="bivariate-model.html#asreml-r-4"><i class="fa fa-check"></i><b>5.2.1</b> Asreml-R</a></li>
<li class="chapter" data-level="5.2.2" data-path="bivariate-model.html"><a href="bivariate-model.html#gremlin-5"><i class="fa fa-check"></i><b>5.2.2</b> gremlin</a></li>
<li class="chapter" data-level="5.2.3" data-path="bivariate-model.html"><a href="bivariate-model.html#mcmcglmm-5"><i class="fa fa-check"></i><b>5.2.3</b> MCMCglmm</a></li>
<li class="chapter" data-level="5.2.4" data-path="bivariate-model.html"><a href="bivariate-model.html#brms-5"><i class="fa fa-check"></i><b>5.2.4</b> brms</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="_blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">How to fit an animal model</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mcmcglmm-3" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> MCMCglmm<a href="mcmcglmm-3.html#mcmcglmm-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="estimating-repeatability-1" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Estimating repeatability<a href="mcmcglmm-3.html#estimating-repeatability-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>With repeated measures on individuals it is often of interest to see how repeatable a trait is.
We can estimate the repeatability of a trait as the proportion of phenotypic variance <span class="math inline">\(V_P\)</span> explained by individual variance <span class="math inline">\(V_{ind}\)</span>; <span class="math inline">\(R = V_{ind}/V_P = V_{ind}/(V_{ind}+V_R)\)</span>.
As you already know, bayesian modelisation requires prior. Here, we create a unformative prior with one estimate for the G matrix and one estimate for the Residual matrix, in addition
<!-- C1 I dont know wht you calculate p.var if you dont use it in the prior --></p>
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb634-1"><a href="mcmcglmm-3.html#cb634-1" aria-hidden="true"></a><span class="co"># p.var &lt;- var(gryphonRM$laydate, na.rm = TRUE)</span></span>
<span id="cb634-2"><a href="mcmcglmm-3.html#cb634-2" aria-hidden="true"></a>prior3<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">G =</span> <span class="kw">list</span>(<span class="dt">G1 =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="dv">1</span>, <span class="dt">nu =</span> <span class="fl">0.002</span>)), <span class="dt">R =</span> <span class="kw">list</span>(</span>
<span id="cb634-3"><a href="mcmcglmm-3.html#cb634-3" aria-hidden="true"></a>  <span class="dt">V =</span> <span class="dv">1</span>,</span>
<span id="cb634-4"><a href="mcmcglmm-3.html#cb634-4" aria-hidden="true"></a>  <span class="dt">nu =</span> <span class="fl">0.002</span></span>
<span id="cb634-5"><a href="mcmcglmm-3.html#cb634-5" aria-hidden="true"></a>))</span>
<span id="cb634-6"><a href="mcmcglmm-3.html#cb634-6" aria-hidden="true"></a>model3<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">MCMCglmm</span>(laydate <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb634-7"><a href="mcmcglmm-3.html#cb634-7" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span>animal, <span class="dt">data =</span> gryphonRM,</span>
<span id="cb634-8"><a href="mcmcglmm-3.html#cb634-8" aria-hidden="true"></a>  <span class="dt">prior =</span> prior3<span class="fl">.1</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span></span>
<span id="cb634-9"><a href="mcmcglmm-3.html#cb634-9" aria-hidden="true"></a>)</span>
<span id="cb634-10"><a href="mcmcglmm-3.html#cb634-10" aria-hidden="true"></a><span class="kw">posterior.mode</span>(model3<span class="fl">.1</span><span class="op">$</span>VCV)</span></code></pre></div>
<pre><code>##   animal    units 
## 10.32109 21.70384</code></pre>
<p>Note the use of the term <code>animal</code> as random allowed to partition the phenotypic variance <span class="math inline">\(V_P\)</span> into among individual variance <span class="math inline">\(V_{ind}\)</span> associated with <code>animal</code> and residual variance <span class="math inline">\(V_R\)</span> associated with <code>units</code>.</p>
<p>Here then the repeatability of the <code>laydate</code> can be determined as:
22.7
(<em>i.e.</em>, as 10.321/(10.321 + 21.704)). Just a friendly remember, we work with Monte Carlo chain with model iteration, so the point estimate can be different (but very similar) each time you run the model.</p>
<p>Mean lay date might change with age, so we could ask what the repeatability of lay date is after conditioning on age. This would be done by adding <code>age</code> into the model as a fixed effect.</p>
<div class="sourceCode" id="cb636"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb636-1"><a href="mcmcglmm-3.html#cb636-1" aria-hidden="true"></a>model3<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">MCMCglmm</span>(laydate <span class="op">~</span><span class="st"> </span>age,</span>
<span id="cb636-2"><a href="mcmcglmm-3.html#cb636-2" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span>animal, <span class="dt">data =</span> gryphonRM,</span>
<span id="cb636-3"><a href="mcmcglmm-3.html#cb636-3" aria-hidden="true"></a>  <span class="dt">prior =</span> prior3<span class="fl">.1</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span></span>
<span id="cb636-4"><a href="mcmcglmm-3.html#cb636-4" aria-hidden="true"></a>)</span>
<span id="cb636-5"><a href="mcmcglmm-3.html#cb636-5" aria-hidden="true"></a><span class="kw">plot</span>(model3<span class="fl">.2</span><span class="op">$</span>Sol)</span></code></pre></div>
<p><img src="wam_tuto_files/figure-html/unnamed-chunk-188-1.svg" width="672" /><img src="wam_tuto_files/figure-html/unnamed-chunk-188-2.svg" width="672" /></p>
<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb637-1"><a href="mcmcglmm-3.html#cb637-1" aria-hidden="true"></a><span class="kw">plot</span>(model3<span class="fl">.2</span><span class="op">$</span>VCV)</span></code></pre></div>
<p><img src="wam_tuto_files/figure-html/unnamed-chunk-188-3.svg" width="672" /></p>
<div class="sourceCode" id="cb638"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb638-1"><a href="mcmcglmm-3.html#cb638-1" aria-hidden="true"></a><span class="kw">posterior.mode</span>(model3<span class="fl">.2</span><span class="op">$</span>VCV)</span></code></pre></div>
<pre><code>##   animal    units 
## 12.00010 16.42399</code></pre>
<p>The model assumption seems correct, so we can look at the different estimates.
Note that the random effect structure has remained unchanged because we did not modified the prior <code>prior3.1</code>.
The repeatability of <code>laydate</code>, after accounting for age effects, is now estimated as
22.7
(<em>i.e.</em>, as 10.321/(10.321 + 21.704)).
Just as we saw when estimating <span class="math inline">\(h_2\)</span> in tutorial 1, the inclusion of fixed effects will alter the estimated effect size
<!-- C3 effect size or just the variance estimate -->
if we determine total phenotypic variance as the sum of the variance components. Thus, proper interpretation is vital.</p>
<div class="sourceCode" id="cb640"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb640-1"><a href="mcmcglmm-3.html#cb640-1" aria-hidden="true"></a><span class="kw">plot</span>(model3<span class="fl">.2</span><span class="op">$</span>Sol)</span></code></pre></div>
<p><img src="wam_tuto_files/figure-html/unnamed-chunk-189-1.svg" width="672" /><img src="wam_tuto_files/figure-html/unnamed-chunk-189-2.svg" width="672" /></p>
<div class="sourceCode" id="cb641"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb641-1"><a href="mcmcglmm-3.html#cb641-1" aria-hidden="true"></a><span class="kw">posterior.mode</span>(model3<span class="fl">.2</span><span class="op">$</span>Sol)</span></code></pre></div>
<pre><code>## (Intercept)        age3        age4        age5        age6 
##   20.483451    2.443290    4.101637    6.189125    3.139582</code></pre>
<div class="sourceCode" id="cb643"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb643-1"><a href="mcmcglmm-3.html#cb643-1" aria-hidden="true"></a><span class="kw">HPDinterval</span>(model3<span class="fl">.2</span><span class="op">$</span>Sol, <span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>##                 lower     upper
## (Intercept) 19.736242 20.851573
## age3         2.009199  3.345267
## age4         3.585232  4.898820
## age5         5.401072  6.704988
## age6         2.473282  3.725684
## attr(,&quot;Probability&quot;)
## [1] 0.95</code></pre>
<p>Here age is modeled as a 5-level factor (specified using the function <code>as.factor()</code> at the beginning of the analysis). We could equally have fitted it as a continuous variable, in which case, given potential for a late life decline, we would probably also include a quadratic term.
In addition, using <code>age</code> as continuous variable can help in saving some degree of freedom in the analysis.</p>
<div class="sourceCode" id="cb645"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb645-1"><a href="mcmcglmm-3.html#cb645-1" aria-hidden="true"></a>gryphonRM<span class="op">$</span>age_c &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(gryphonRM<span class="op">$</span>age)</span>
<span id="cb645-2"><a href="mcmcglmm-3.html#cb645-2" aria-hidden="true"></a></span>
<span id="cb645-3"><a href="mcmcglmm-3.html#cb645-3" aria-hidden="true"></a>model3<span class="fl">.2</span>_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">MCMCglmm</span>(laydate <span class="op">~</span><span class="st"> </span>age_c <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(age_c<span class="op">^</span><span class="dv">2</span>),</span>
<span id="cb645-4"><a href="mcmcglmm-3.html#cb645-4" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span>animal, <span class="dt">data =</span> gryphonRM,</span>
<span id="cb645-5"><a href="mcmcglmm-3.html#cb645-5" aria-hidden="true"></a>  <span class="dt">prior =</span> prior3<span class="fl">.1</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span></span>
<span id="cb645-6"><a href="mcmcglmm-3.html#cb645-6" aria-hidden="true"></a>)</span>
<span id="cb645-7"><a href="mcmcglmm-3.html#cb645-7" aria-hidden="true"></a><span class="kw">plot</span>(model3<span class="fl">.2</span>_<span class="dv">2</span><span class="op">$</span>Sol)</span></code></pre></div>
<p><img src="wam_tuto_files/figure-html/unnamed-chunk-190-1.svg" width="672" /></p>
<div class="sourceCode" id="cb646"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb646-1"><a href="mcmcglmm-3.html#cb646-1" aria-hidden="true"></a><span class="kw">plot</span>(model3<span class="fl">.2</span>_<span class="dv">2</span><span class="op">$</span>VCV)</span></code></pre></div>
<p><img src="wam_tuto_files/figure-html/unnamed-chunk-190-2.svg" width="672" /></p>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb647-1"><a href="mcmcglmm-3.html#cb647-1" aria-hidden="true"></a><span class="kw">posterior.mode</span>(model3<span class="fl">.2</span>_<span class="dv">2</span><span class="op">$</span>VCV)</span></code></pre></div>
<pre><code>##   animal    units 
## 11.97676 16.96256</code></pre>
<div class="sourceCode" id="cb649"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb649-1"><a href="mcmcglmm-3.html#cb649-1" aria-hidden="true"></a><span class="kw">posterior.mode</span>(model3<span class="fl">.2</span>_<span class="dv">2</span><span class="op">$</span>Sol)</span></code></pre></div>
<pre><code>## (Intercept)       age_c  I(age_c^2) 
##   14.992383    5.559982   -0.789399</code></pre>
<div class="sourceCode" id="cb651"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb651-1"><a href="mcmcglmm-3.html#cb651-1" aria-hidden="true"></a><span class="kw">HPDinterval</span>(model3<span class="fl">.2</span>_<span class="dv">2</span><span class="op">$</span>Sol, <span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>##                  lower      upper
## (Intercept) 14.1124088 16.2195293
## age_c        4.7966190  6.3279435
## I(age_c^2)  -0.8898095 -0.6487329
## attr(,&quot;Probability&quot;)
## [1] 0.95</code></pre>
</div>
<div id="partitioning-additive-and-permanent-environment-effects-1" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Partitioning additive and permanent environment effects<a href="mcmcglmm-3.html#partitioning-additive-and-permanent-environment-effects-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Generally we expect that the repeatability will set the upper limit for heritability since among individual variation can be decomposed in the additive genetic variation and non additive genetic variation. In other word, the additive genetic variation is a subcomponent of the difference between individuals.
Non-additive contributions to fixed among-individual differences are normally referred to as <em>permanent environment effects</em>. If a trait has repeated measures then it is necessary to model permanent environment effects in an animal model to prevent upward bias in <span class="math inline">\(V_A\)</span>.</p>
<p>To illustrate it, we first fit the animal model:</p>
<div class="sourceCode" id="cb653"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb653-1"><a href="mcmcglmm-3.html#cb653-1" aria-hidden="true"></a>Ainv &lt;-<span class="st"> </span><span class="kw">inverseA</span>(gryphonped)<span class="op">$</span>Ainv</span>
<span id="cb653-2"><a href="mcmcglmm-3.html#cb653-2" aria-hidden="true"></a>model3<span class="fl">.3</span> &lt;-<span class="st"> </span><span class="kw">MCMCglmm</span>(laydate <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>age,</span>
<span id="cb653-3"><a href="mcmcglmm-3.html#cb653-3" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span>animal, <span class="dt">ginv =</span> <span class="kw">list</span>(<span class="dt">animal =</span> Ainv),</span>
<span id="cb653-4"><a href="mcmcglmm-3.html#cb653-4" aria-hidden="true"></a>  <span class="dt">data =</span> gryphonRM, <span class="dt">prior =</span> prior3<span class="fl">.1</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span></span>
<span id="cb653-5"><a href="mcmcglmm-3.html#cb653-5" aria-hidden="true"></a>)</span></code></pre></div>
<p>Variance components are almost unchanged if we compare the previous model:</p>
<div class="sourceCode" id="cb654"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb654-1"><a href="mcmcglmm-3.html#cb654-1" aria-hidden="true"></a><span class="kw">posterior.mode</span>(model3<span class="fl">.3</span><span class="op">$</span>VCV)</span></code></pre></div>
<pre><code>##   animal    units 
## 13.89832 16.82945</code></pre>
<div class="sourceCode" id="cb656"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb656-1"><a href="mcmcglmm-3.html#cb656-1" aria-hidden="true"></a><span class="kw">posterior.mode</span>(model3<span class="fl">.2</span><span class="op">$</span>VCV)</span></code></pre></div>
<pre><code>##   animal    units 
## 12.00010 16.42399</code></pre>
<p>This suggests that most of the among-individual variance is – rightly or wrongly – being partitioned as <span class="math inline">\(V_A\)</span> here. In fact here the partition is wrong since the simulation included both additive genetic effects and additional fixed heterogeneity that was not associated with the pedigree structure (i.e. permanent environment effects).
In order to o obtain an unbiased estimate of <span class="math inline">\(V_A\)</span>, we need to fit the individual identity twice in the model: once linked to the pedigree (genetic effect) and once not linked to the pedigree (permanent environment effect).To do so, we need to duplicate the variable containing the individual identity <code>animal</code> and give it a new name. In addition, the prior need to be modified to integrate a seconf random effect.An more appropriate estimate of <span class="math inline">\(V_A\)</span> is given by the model:</p>
<div class="sourceCode" id="cb658"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb658-1"><a href="mcmcglmm-3.html#cb658-1" aria-hidden="true"></a>gryphonRM<span class="op">$</span>animal_pe &lt;-<span class="st"> </span>gryphonRM<span class="op">$</span>animal</span>
<span id="cb658-2"><a href="mcmcglmm-3.html#cb658-2" aria-hidden="true"></a><span class="co"># p.var &lt;- var(gryphonRM$laydate, na.rm = TRUE)</span></span>
<span id="cb658-3"><a href="mcmcglmm-3.html#cb658-3" aria-hidden="true"></a>prior3<span class="fl">.4</span> &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">G =</span> <span class="kw">list</span>(<span class="dt">G1 =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="dv">1</span>, <span class="dt">nu =</span> <span class="fl">0.002</span>), <span class="dt">G2 =</span> <span class="kw">list</span>(</span>
<span id="cb658-4"><a href="mcmcglmm-3.html#cb658-4" aria-hidden="true"></a>  <span class="dt">V =</span> <span class="dv">1</span>,</span>
<span id="cb658-5"><a href="mcmcglmm-3.html#cb658-5" aria-hidden="true"></a>  <span class="dt">nu =</span> <span class="fl">0.002</span></span>
<span id="cb658-6"><a href="mcmcglmm-3.html#cb658-6" aria-hidden="true"></a>)), <span class="dt">R =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="dv">1</span>, <span class="dt">nu =</span> <span class="fl">0.002</span>))</span>
<span id="cb658-7"><a href="mcmcglmm-3.html#cb658-7" aria-hidden="true"></a>model3<span class="fl">.4</span> &lt;-<span class="st"> </span><span class="kw">MCMCglmm</span>(laydate <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>age,</span>
<span id="cb658-8"><a href="mcmcglmm-3.html#cb658-8" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span>animal <span class="op">+</span><span class="st"> </span>animal_pe,</span>
<span id="cb658-9"><a href="mcmcglmm-3.html#cb658-9" aria-hidden="true"></a>  <span class="dt">ginv =</span> <span class="kw">list</span>(<span class="dt">animal =</span> Ainv), <span class="dt">data =</span> gryphonRM, <span class="dt">prior =</span> prior3<span class="fl">.4</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span></span>
<span id="cb658-10"><a href="mcmcglmm-3.html#cb658-10" aria-hidden="true"></a>)</span>
<span id="cb658-11"><a href="mcmcglmm-3.html#cb658-11" aria-hidden="true"></a><span class="kw">posterior.mode</span>(model3<span class="fl">.4</span><span class="op">$</span>VCV)</span></code></pre></div>
<pre><code>##    animal animal_pe     units 
##  4.324178  8.593354 16.300317</code></pre>
<p>The estimate of<span class="math inline">\(V_A\)</span> is now much lower (reduced from 13.6735 to 5.1238) due to a proper separation in the additive and permanent environment effects.
We can estimate <span class="math inline">\(h^2\)</span> and the repeatability from this model:</p>
<div class="sourceCode" id="cb660"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb660-1"><a href="mcmcglmm-3.html#cb660-1" aria-hidden="true"></a>model3.<span class="fl">4.</span>VP &lt;-<span class="st"> </span>model3<span class="fl">.4</span><span class="op">$</span>VCV[, <span class="st">&quot;animal&quot;</span>] <span class="op">+</span><span class="st"> </span>model3<span class="fl">.4</span><span class="op">$</span>VCV[, <span class="st">&quot;animal_pe&quot;</span>] <span class="op">+</span><span class="st"> </span>model3<span class="fl">.4</span><span class="op">$</span>VCV[, <span class="st">&quot;units&quot;</span>]</span>
<span id="cb660-2"><a href="mcmcglmm-3.html#cb660-2" aria-hidden="true"></a>model3.<span class="fl">4.</span>PE_VA &lt;-<span class="st"> </span>model3<span class="fl">.4</span><span class="op">$</span>VCV[, <span class="st">&quot;animal&quot;</span>] <span class="op">+</span><span class="st"> </span>model3<span class="fl">.4</span><span class="op">$</span>VCV[, <span class="st">&quot;animal_pe&quot;</span>]</span>
<span id="cb660-3"><a href="mcmcglmm-3.html#cb660-3" aria-hidden="true"></a><span class="kw">posterior.mode</span>(model3.<span class="fl">4.</span>PE_VA <span class="op">/</span><span class="st"> </span>model3.<span class="fl">4.</span>VP)</span></code></pre></div>
<pre><code>##      var1 
## 0.4255835</code></pre>
<div class="sourceCode" id="cb662"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb662-1"><a href="mcmcglmm-3.html#cb662-1" aria-hidden="true"></a><span class="kw">posterior.mode</span>(model3<span class="fl">.4</span><span class="op">$</span>VCV[, <span class="st">&quot;animal&quot;</span>] <span class="op">/</span><span class="st"> </span>model3.<span class="fl">4.</span>VP)</span></code></pre></div>
<pre><code>##      var1 
## 0.1246707</code></pre>
</div>
<div id="adding-additional-effects-and-testing-significance-1" class="section level3 hasAnchor" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> Adding additional effects and testing significance<a href="mcmcglmm-3.html#adding-additional-effects-and-testing-significance-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Models of repeated measures can be extended to include other fixed or random effects.
For example we can try including year of measurement (<code>year</code>) and birth year (<code>byear</code>) as other random effects.</p>
<div class="sourceCode" id="cb664"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb664-1"><a href="mcmcglmm-3.html#cb664-1" aria-hidden="true"></a><span class="co"># p.var &lt;- var(gryphonRM$laydate, na.rm = TRUE)</span></span>
<span id="cb664-2"><a href="mcmcglmm-3.html#cb664-2" aria-hidden="true"></a>prior3<span class="fl">.5</span> &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">G =</span> <span class="kw">list</span>(<span class="dt">G1 =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="dv">1</span>, <span class="dt">nu =</span> <span class="fl">0.002</span>), <span class="dt">G2 =</span> <span class="kw">list</span>(</span>
<span id="cb664-3"><a href="mcmcglmm-3.html#cb664-3" aria-hidden="true"></a>  <span class="dt">V =</span> <span class="dv">1</span>,</span>
<span id="cb664-4"><a href="mcmcglmm-3.html#cb664-4" aria-hidden="true"></a>  <span class="dt">nu =</span> <span class="fl">0.002</span></span>
<span id="cb664-5"><a href="mcmcglmm-3.html#cb664-5" aria-hidden="true"></a>), <span class="dt">G3 =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="dv">1</span>, <span class="dt">nu =</span> <span class="fl">0.002</span>), <span class="dt">G4 =</span> <span class="kw">list</span>(</span>
<span id="cb664-6"><a href="mcmcglmm-3.html#cb664-6" aria-hidden="true"></a>  <span class="dt">V =</span> <span class="dv">1</span>,</span>
<span id="cb664-7"><a href="mcmcglmm-3.html#cb664-7" aria-hidden="true"></a>  <span class="dt">nu =</span> <span class="fl">0.002</span></span>
<span id="cb664-8"><a href="mcmcglmm-3.html#cb664-8" aria-hidden="true"></a>)), <span class="dt">R =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="dv">1</span>, <span class="dt">nu =</span> <span class="fl">0.002</span>))</span>
<span id="cb664-9"><a href="mcmcglmm-3.html#cb664-9" aria-hidden="true"></a></span>
<span id="cb664-10"><a href="mcmcglmm-3.html#cb664-10" aria-hidden="true"></a>model3<span class="fl">.5</span> &lt;-<span class="st"> </span><span class="kw">MCMCglmm</span>(laydate <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>age,</span>
<span id="cb664-11"><a href="mcmcglmm-3.html#cb664-11" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span>animal <span class="op">+</span><span class="st"> </span>animal_pe <span class="op">+</span></span>
<span id="cb664-12"><a href="mcmcglmm-3.html#cb664-12" aria-hidden="true"></a><span class="st">    </span>year <span class="op">+</span><span class="st"> </span>byear, <span class="dt">ginv =</span> <span class="kw">list</span>(<span class="dt">animal =</span> Ainv), <span class="dt">data =</span> gryphonRM, <span class="dt">prior =</span> prior3<span class="fl">.5</span>,</span>
<span id="cb664-13"><a href="mcmcglmm-3.html#cb664-13" aria-hidden="true"></a>  <span class="dt">verbose =</span> <span class="ot">FALSE</span></span>
<span id="cb664-14"><a href="mcmcglmm-3.html#cb664-14" aria-hidden="true"></a>)</span>
<span id="cb664-15"><a href="mcmcglmm-3.html#cb664-15" aria-hidden="true"></a><span class="kw">posterior.mode</span>(model3<span class="fl">.5</span><span class="op">$</span>VCV)</span></code></pre></div>
<pre><code>##      animal   animal_pe        year       byear       units 
## 4.304918863 9.077350871 7.920407219 0.002651831 7.738514960</code></pre>
<div class="sourceCode" id="cb666"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb666-1"><a href="mcmcglmm-3.html#cb666-1" aria-hidden="true"></a><span class="kw">HPDinterval</span>(model3<span class="fl">.5</span><span class="op">$</span>VCV, <span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>##                  lower     upper
## animal    1.8927446261  7.545075
## animal_pe 5.6707092000 11.689607
## year      4.8648557490 12.609918
## byear     0.0003024825  0.270198
## units     7.1715856383  8.440370
## attr(,&quot;Probability&quot;)
## [1] 0.95</code></pre>
<div class="sourceCode" id="cb668"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb668-1"><a href="mcmcglmm-3.html#cb668-1" aria-hidden="true"></a><span class="kw">plot</span>(model3<span class="fl">.5</span><span class="op">$</span>VCV)</span></code></pre></div>
<p><img src="wam_tuto_files/figure-html/unnamed-chunk-195-1.svg" width="672" /><img src="wam_tuto_files/figure-html/unnamed-chunk-195-2.svg" width="672" /></p>
<p>This model will return additional variance components corresponding to year of measurement effects and birth year of the female effects.</p>
<p><span class="math inline">\(V_{byear}\)</span> is very low and its posterior distribution (via the function <code>HPDinterval</code> or <code>plot</code>) is very close to zero indicating its not significance. You have to remember bayesian model never estimate variable to 0 or passing zero, so you will never see a credible interval <code>CI</code> crossing zero for a variance.
If you compared the DIC of model3.5 to a reduced model without <code>byear</code>, it should be very similar.</p>
<div class="sourceCode" id="cb669"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb669-1"><a href="mcmcglmm-3.html#cb669-1" aria-hidden="true"></a>prior3<span class="fl">.5</span>_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb669-2"><a href="mcmcglmm-3.html#cb669-2" aria-hidden="true"></a>  <span class="dt">G =</span> <span class="kw">list</span>(<span class="dt">G1 =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="dv">1</span>, <span class="dt">nu =</span> <span class="fl">0.002</span>), <span class="dt">G2 =</span> <span class="kw">list</span>(</span>
<span id="cb669-3"><a href="mcmcglmm-3.html#cb669-3" aria-hidden="true"></a>    <span class="dt">V =</span> <span class="dv">1</span>,</span>
<span id="cb669-4"><a href="mcmcglmm-3.html#cb669-4" aria-hidden="true"></a>    <span class="dt">nu =</span> <span class="fl">0.002</span></span>
<span id="cb669-5"><a href="mcmcglmm-3.html#cb669-5" aria-hidden="true"></a>  ), <span class="dt">G3 =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="dv">1</span>, <span class="dt">nu =</span> <span class="fl">0.002</span>)),</span>
<span id="cb669-6"><a href="mcmcglmm-3.html#cb669-6" aria-hidden="true"></a>  <span class="dt">R =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="dv">1</span>, <span class="dt">nu =</span> <span class="fl">0.002</span>)</span>
<span id="cb669-7"><a href="mcmcglmm-3.html#cb669-7" aria-hidden="true"></a>)</span>
<span id="cb669-8"><a href="mcmcglmm-3.html#cb669-8" aria-hidden="true"></a></span>
<span id="cb669-9"><a href="mcmcglmm-3.html#cb669-9" aria-hidden="true"></a>model3<span class="fl">.5</span>_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">MCMCglmm</span>(laydate <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>age,</span>
<span id="cb669-10"><a href="mcmcglmm-3.html#cb669-10" aria-hidden="true"></a>  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span>animal <span class="op">+</span><span class="st"> </span>animal_pe <span class="op">+</span></span>
<span id="cb669-11"><a href="mcmcglmm-3.html#cb669-11" aria-hidden="true"></a><span class="st">    </span>year, <span class="dt">ginv =</span> <span class="kw">list</span>(<span class="dt">animal =</span> Ainv), <span class="dt">data =</span> gryphonRM, <span class="dt">prior =</span> prior3<span class="fl">.5</span>_<span class="dv">2</span>,</span>
<span id="cb669-12"><a href="mcmcglmm-3.html#cb669-12" aria-hidden="true"></a>  <span class="dt">verbose =</span> <span class="ot">FALSE</span></span>
<span id="cb669-13"><a href="mcmcglmm-3.html#cb669-13" aria-hidden="true"></a>)</span>
<span id="cb669-14"><a href="mcmcglmm-3.html#cb669-14" aria-hidden="true"></a><span class="kw">posterior.mode</span>(model3<span class="fl">.5</span>_<span class="dv">2</span><span class="op">$</span>VCV)</span></code></pre></div>
<pre><code>##    animal animal_pe      year     units 
##  4.660487  7.797882  8.393778  7.872222</code></pre>
<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb671-1"><a href="mcmcglmm-3.html#cb671-1" aria-hidden="true"></a>model3<span class="fl">.5</span><span class="op">$</span>DIC</span></code></pre></div>
<pre><code>## [1] 8290.222</code></pre>
<div class="sourceCode" id="cb673"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb673-1"><a href="mcmcglmm-3.html#cb673-1" aria-hidden="true"></a>model3<span class="fl">.5</span>_<span class="dv">2</span><span class="op">$</span>DIC</span></code></pre></div>
<pre><code>## [1] 8290.116</code></pre>
<p><code>year</code> effects could alternatively be included as fixed effects (try it!, you should be able to handle the new prior specification at this point). This will reduce <span class="math inline">\(V_R\)</span> and increase the estimates of heritability and repeatability, which must now be interpreted as proportions of phenotypic variance after conditioning on both age and year of measurement effects.</p>
<!-- CX  What to do more , may be extract BLUP also !-->

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="gremlin-3.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="brms-3.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/JulienGAMartin/wam_tuto/edit/master/04_03-rep_mcmcglmm.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["wam_tuto.pdf", "wam_tuto.epub", "wam_tuto.mobi"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toc_depth": 4
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
