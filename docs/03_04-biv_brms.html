<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Julien Martin">
<meta name="description" content="Tutorial on how to fit an animal model using multiple R packages. Updated and extended tutorials from An ecologist guide to animal model (Wilson et al. 2010).">
<title>How to fit an animal model - 10&nbsp; brms</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./03_05-biv_stan.html" rel="next">
<link href="./03_03-biv_mcmcglmm.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-LLHQEESR2L"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-LLHQEESR2L', { 'anonymize_ip': true});
</script><link rel="stylesheet" href="css/style.css">
</head>
<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Wam tutorial</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-extra-resources" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Extra resources</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-extra-resources">
<li>
    <a class="dropdown-item" href="https://wildanimalmodels.org/">
 <span class="dropdown-text">WamWiki</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://devillemereuil.legtux.org/downloads/">
 <span class="dropdown-text">Tutorials by P de Vilemereuil</span></a>
  </li>  
    </ul>
</li>
</ul>
</div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools tools-wide">
    <a href="https://github.com/juliengamartin/wam_tuto/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./How-to-fit-an-animal-model.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03_00-biv.html">Multivariate animal model</a></li><li class="breadcrumb-item"><a href="./03_04-biv_brms.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">brms</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./02_00-univ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Univariate animal model</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_01-univ_asreml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Asreml-R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_02-univ_gremlin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">gremlin</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_03-univ_mcmcglmm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">MCMCglmm</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_04-univ_brms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">brms</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_05-univ_stan.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">stan</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./03_00-biv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multivariate animal model</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_01-biv_asreml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Asreml-R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_02-biv_gremlin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">gremlin</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_03-biv_mcmcglmm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">MCMCglmm</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_04-biv_brms.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">brms</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_05-biv_stan.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">stan</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./04_00-rep.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A repeated measures animal model</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_01-rep_asreml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Asreml-R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_02-rep_gremlin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">gremlin</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_03-rep_mcmcglmm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">MCMCglmm</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_04-rep_brms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">brms</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_05-rep_stan.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">stan</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_code_cheatsheet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Quick comparison of codes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./98_references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#fitting-the-model" id="toc-fitting-the-model" class="nav-link active" data-scroll-target="#fitting-the-model"><span class="header-section-number">10.0.1</span> Fitting the model</a></li>
  <li><a href="#adding-fixed-and-random-effects" id="toc-adding-fixed-and-random-effects" class="nav-link" data-scroll-target="#adding-fixed-and-random-effects"><span class="header-section-number">10.0.2</span> Adding fixed and random effects</a></li>
  <li><a href="#partitioning-covariances" id="toc-partitioning-covariances" class="nav-link" data-scroll-target="#partitioning-covariances"><span class="header-section-number">10.0.3</span> Partitioning (co)variances</a></li>
  <li><a href="#between-groups-covariances-and-the-b-matrix" id="toc-between-groups-covariances-and-the-b-matrix" class="nav-link" data-scroll-target="#between-groups-covariances-and-the-b-matrix"><span class="header-section-number">10.0.4</span> Between groups (co)variances and the B-matrix</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/juliengamartin/wam_tuto/edit/main/03_04-biv_brms.Rmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/juliengamartin/wam_tuto/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03_00-biv.html">Multivariate animal model</a></li><li class="breadcrumb-item"><a href="./03_04-biv_brms.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">brms</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">10</span>&nbsp; <span class="chapter-title">brms</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>First load brms:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms">brms</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Rcpp</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading 'brms' package (version 2.20.4). Useful instructions
can be found by typing help('brms'). A more detailed introduction
to the package is available through vignette('brms_overview').</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'brms'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    ar</code></pre>
</div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Amat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu">nadiv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nadiv/man/makeA.html">makeA</a></span><span class="op">(</span><span class="va">gryphonped</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="fitting-the-model" class="level3" data-number="10.0.1"><h3 data-number="10.0.1" class="anchored" data-anchor-id="fitting-the-model">
<span class="header-section-number">10.0.1</span> Fitting the model</h3>
<p>Fitting a multivariate model in brms involves several new consideration above those for fitting univariate models. First, we need to create two models/objects with the function <code>bf</code> fitting the desired univariate model structure for each response variable (here <code>bwt</code> and <code>tarsus</code>). It is the equivalent of writing <code>mvbf(bwt, tarsus)</code>, but the advantage to create two distinct model is to specific different model structure (fixed or random effect) for each response variable.</p>
<p>Then, the two objects/models are added into a third model to quantify all the estimates in addition to their covariance. Contrary to MCMCglmm or asreml-R, brms directly estimate the covariance and the correlation in its outputs. Our most basic model can be specified as:</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bf_bwt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula.html">bf</a></span><span class="op">(</span><span class="va">bwt</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">a</span> <span class="op">|</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/gr.html">gr</a></span><span class="op">(</span><span class="va">animal</span>, cov <span class="op">=</span> <span class="va">Amat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bf_tarsus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula.html">bf</a></span><span class="op">(</span><span class="va">tarsus</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">a</span> <span class="op">|</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/gr.html">gr</a></span><span class="op">(</span><span class="va">animal</span>, cov <span class="op">=</span> <span class="va">Amat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">brms_m2.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brm.html">brm</a></span><span class="op">(</span></span>
<span>  <span class="va">bf_bwt</span> <span class="op">+</span> <span class="va">bf_tarsus</span> <span class="op">+</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula-helpers.html">set_rescor</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gryphon</span>,</span>
<span>  data2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Amat <span class="op">=</span> <span class="va">Amat</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">2</span>, cores <span class="op">=</span> <span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">brms_m2.1</span>, file <span class="op">=</span> <span class="st">"data/brms_m2_1.rda"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Again we have provided the data from one such run. It can be accessed using the code:</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/brms_m2_1.rda"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">brms_m2.1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Parts of the model have not converged (some Rhats are &gt; 1.05). Be
careful when analysing the results! We recommend running more iterations and/or
setting stronger priors.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: MV(gaussian, gaussian) 
  Links: mu = identity; sigma = identity
         mu = identity; sigma = identity 
Formula: bwt ~ 1 + (1 | p | gr(animal, cov = Amat)) 
         tarsus ~ 1 + (1 | p | gr(animal, cov = Amat)) 
   Data: gryphon (Number of observations: 683) 
  Draws: 2 chains, each with iter = 1000; warmup = 500; thin = 1;
         total post-warmup draws = 1000

Group-Level Effects: 
~animal (Number of levels: 683) 
                                    Estimate Est.Error l-95% CI u-95% CI Rhat
sd(bwt_Intercept)                       1.81      0.21     1.41     2.20 1.06
sd(tarsus_Intercept)                    3.44      0.43     2.49     4.25 1.05
cor(bwt_Intercept,tarsus_Intercept)     0.38      0.14     0.08     0.62 1.02
                                    Bulk_ESS Tail_ESS
sd(bwt_Intercept)                         31      192
sd(tarsus_Intercept)                      61      173
cor(bwt_Intercept,tarsus_Intercept)      101      232

Population-Level Effects: 
                 Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
bwt_Intercept        7.49      0.16     7.20     7.79 1.00      608      839
tarsus_Intercept    20.47      0.30    19.92    21.03 1.00      868      803

Family Specific Parameters: 
             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma_bwt        1.97      0.16     1.66     2.28 1.06       27      172
sigma_tarsus     4.24      0.30     3.63     4.82 1.04       72      162

Residual Correlations: 
                   Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
rescor(bwt,tarsus)     0.39      0.09     0.21     0.55 1.02       95      179

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">brms_m2.1</span>, ask <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">brms_m2.1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$animal
$animal$sd
                 Estimate Est.Error     Q2.5    Q97.5
bwt_Intercept    1.808171 0.2050233 1.412824 2.204805
tarsus_Intercept 3.438368 0.4283612 2.491218 4.245264

$animal$cor
, , bwt_Intercept

                  Estimate Est.Error       Q2.5     Q97.5
bwt_Intercept    1.0000000 0.0000000 1.00000000 1.0000000
tarsus_Intercept 0.3814062 0.1380014 0.07581464 0.6209038

, , tarsus_Intercept

                  Estimate Est.Error       Q2.5     Q97.5
bwt_Intercept    0.3814062 0.1380014 0.07581464 0.6209038
tarsus_Intercept 1.0000000 0.0000000 1.00000000 1.0000000


$animal$cov
, , bwt_Intercept

                 Estimate Est.Error      Q2.5    Q97.5
bwt_Intercept    3.311473 0.7430185 1.9960721 4.861167
tarsus_Intercept 2.440166 1.0901689 0.3870783 4.668720

, , tarsus_Intercept

                  Estimate Est.Error      Q2.5    Q97.5
bwt_Intercept     2.440166  1.090169 0.3870783  4.66872
tarsus_Intercept 12.005688  2.918741 6.2061701 18.02226



$residual__
$residual__$sd
       Estimate Est.Error     Q2.5    Q97.5
bwt    1.970532 0.1597581 1.658782 2.276074
tarsus 4.244704 0.2984518 3.632824 4.820109

$residual__$cor
, , bwt

        Estimate  Est.Error      Q2.5     Q97.5
bwt    1.0000000 0.00000000 1.0000000 1.0000000
tarsus 0.3888754 0.08510488 0.2127907 0.5526631

, , tarsus

        Estimate  Est.Error      Q2.5     Q97.5
bwt    0.3888754 0.08510488 0.2127907 0.5526631
tarsus 1.0000000 0.00000000 1.0000000 1.0000000


$residual__$cov
, , bwt

       Estimate Est.Error     Q2.5    Q97.5
bwt    3.908493 0.6282892 2.751557 5.180511
tarsus 3.289995 0.9305960 1.572647 5.147133

, , tarsus

        Estimate Est.Error      Q2.5     Q97.5
bwt     3.289995  0.930596  1.572647  5.147133
tarsus 18.106495  2.530138 13.197409 23.233452</code></pre>
</div>
</div>
<p>It is also possible to calculate the heritability for each trait using the function ‘as.mcmc’</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">v_animal</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">brms_m2.1</span>, summary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">animal</span><span class="op">$</span><span class="va">sd</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">v_r</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">brms_m2.1</span>, summary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">residual</span><span class="op">$</span><span class="va">sd</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span></span>
<span><span class="va">h.bwt.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">as.mcmc</a></span><span class="op">(</span><span class="va">v_animal</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="va">v_animal</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">v_r</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">h.tarsus.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">as.mcmc</a></span><span class="op">(</span><span class="va">v_animal</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="va">v_animal</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">v_r</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">h.bwt.2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 1:1000
Thinning interval = 1 
Number of chains = 1 
Sample size per chain = 1000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

          Mean             SD       Naive SE Time-series SE 
      0.457051       0.090878       0.002874       0.011675 

2. Quantiles for each variable:

  2.5%    25%    50%    75%  97.5% 
0.2878 0.3926 0.4596 0.5254 0.6297 </code></pre>
</div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">h.tarsus.2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 1:1000
Thinning interval = 1 
Number of chains = 1 
Sample size per chain = 1000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

          Mean             SD       Naive SE Time-series SE 
      0.397237       0.087350       0.002762       0.009971 

2. Quantiles for each variable:

  2.5%    25%    50%    75%  97.5% 
0.2174 0.3390 0.3982 0.4553 0.5682 </code></pre>
</div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">h.bwt.2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">h.tarsus.2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It is also possible to extract the correlation. Just to remember it is an example, the correlation distribution is skewed to 1 due to a weak prior and model parameters. Note, since</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cor_g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">as.mcmc</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">brms_m2.1</span>, summary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">animal</span><span class="op">$</span><span class="va">cor</span><span class="op">[</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cor_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">as.mcmc</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">brms_m2.1</span>, summary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">residual</span><span class="op">$</span><span class="va">cor</span><span class="op">[</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_g</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 1:1000
Thinning interval = 1 
Number of chains = 1 
Sample size per chain = 1000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

          Mean             SD       Naive SE Time-series SE 
      0.381406       0.138001       0.004364       0.014946 

2. Quantiles for each variable:

   2.5%     25%     50%     75%   97.5% 
0.07581 0.30354 0.39041 0.47497 0.62090 </code></pre>
</div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_res</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 1:1000
Thinning interval = 1 
Number of chains = 1 
Sample size per chain = 1000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

          Mean             SD       Naive SE Time-series SE 
      0.388875       0.085105       0.002691       0.009215 

2. Quantiles for each variable:

  2.5%    25%    50%    75%  97.5% 
0.2128 0.3319 0.3913 0.4484 0.5527 </code></pre>
</div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cor_g</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cor_res</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here we can plot the genetic correlation by extraction the breeding values or BLUP.</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bls_m2.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/random.effects.html">ranef</a></span><span class="op">(</span><span class="va">brms_m2.1</span><span class="op">)</span><span class="op">$</span><span class="va">animal</span></span>
<span><span class="va">bl_m2.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu">abind</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/abind/man/abind.html">abind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">bls_m2.1</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">bls_m2.1</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>, <span class="va">x</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">bl_m2.1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span><span class="op">(</span><span class="va">bls_m2.1</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"_lo"</span>, <span class="st">"_up"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bl_m2.1</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">bl_m2.1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, some simple code to plot the genetic correlation.</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">tarsus_Intercept</span> <span class="op">~</span> <span class="va">bwt_Intercept</span>, <span class="va">bl_m2.1</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">bl_m2.1</span><span class="op">$</span><span class="va">bwt_Intercept_lo</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">bl_m2.1</span><span class="op">$</span><span class="va">bwt_Intercept_up</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">bl_m2.1</span><span class="op">$</span><span class="va">tarsus_Intercept_lo</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">bl_m2.1</span><span class="op">$</span><span class="va">tarsus_Intercept_up</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  las <span class="op">=</span> <span class="fl">1.2</span>, type <span class="op">=</span> <span class="st">"n"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span></span>
<span>  <span class="va">bl_m2.1</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span></span>
<span>    x0 <span class="op">=</span> <span class="va">bwt_Intercept</span>, y0 <span class="op">=</span> <span class="va">tarsus_Intercept_lo</span>,</span>
<span>    x1 <span class="op">=</span> <span class="va">bwt_Intercept</span>, y1 <span class="op">=</span> <span class="va">tarsus_Intercept_up</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"black"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">bl_m2.1</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span></span>
<span>  x0 <span class="op">=</span> <span class="va">bwt_Intercept_lo</span>, y0 <span class="op">=</span> <span class="va">tarsus_Intercept</span>,</span>
<span>  x1 <span class="op">=</span> <span class="va">bwt_Intercept_up</span>, y1 <span class="op">=</span> <span class="va">tarsus_Intercept</span>,</span>
<span>  col <span class="op">=</span> <span class="st">"black"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">tarsus_Intercept</span> <span class="op">~</span> <span class="va">bwt_Intercept</span>, <span class="va">bl_m2.1</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="st">"red"</span>, cex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">tarsus_Intercept</span> <span class="op">~</span> <span class="va">bwt_Intercept</span>, <span class="va">bl_m2.1</span>, pch <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.3</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"btw (BV±CI)"</span>, side <span class="op">=</span> <span class="fl">1</span>, line <span class="op">=</span> <span class="fl">2.4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"tarsus (BV±CI)"</span>, side <span class="op">=</span> <span class="fl">2</span>, line <span class="op">=</span> <span class="fl">2</span>, las <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<!--
Here the code to plot the resiudal correlation.
#```{r}
res.model <- as.data.frame(residuals(brms_m2.1))

plot(Estimate.tarsus ~ Estimate.bwt, res.model, xlab = "", ylab = "", las = 1.2, bty = "o", col = "white")
segments(x0 = res.model$Estimate.bwt, y0 = res.model$Q2.5.tarsus, x1 = res.model$Estimate.bwt, y1 = res.model$Q97.5.tarsus, col = "black")
segments(x0 = res.model$Q2.5.bwt, y0 = res.model$Estimate.tarsus, x1 = res.model$Q97.5.bwt, y1 = res.model$Estimate.tarsus, col = "black")
points(Estimate.tarsus ~ Estimate.bwt, res.model, pch = 16, col = "red", cex = 1.5)
points(Estimate.tarsus ~ Estimate.bwt, res.model, pch = 1, col = rgb(0, 0, 0, 0.3), cex = c(1.5))
mtext("btw (residual±CI)", side = 1, line = 2.4)
mtext("tarsus (residual±CI)", side = 2, line = 2, las = 3)
#```
-->
</section><section id="adding-fixed-and-random-effects" class="level3" data-number="10.0.2"><h3 data-number="10.0.2" class="anchored" data-anchor-id="adding-fixed-and-random-effects">
<span class="header-section-number">10.0.2</span> Adding fixed and random effects</h3>
<p>Fixed and random effects can be added just as for the univariate case. Given that our full model of bwt from tutorial 1 had sex as a fixed effect as well as random effects of byear and mother, we could specify a bivariate formulation of this using the following code (including a line to save the output):</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bf_bwt_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula.html">bf</a></span><span class="op">(</span><span class="va">bwt</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">a</span> <span class="op">|</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/gr.html">gr</a></span><span class="op">(</span><span class="va">animal</span>, cov <span class="op">=</span> <span class="va">Amat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">b</span> <span class="op">|</span> <span class="va">byear</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">c</span> <span class="op">|</span> <span class="va">mother</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bf_tarsus_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula.html">bf</a></span><span class="op">(</span><span class="va">tarsus</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">a</span> <span class="op">|</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/gr.html">gr</a></span><span class="op">(</span><span class="va">animal</span>, cov <span class="op">=</span> <span class="va">Amat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">b</span> <span class="op">|</span> <span class="va">byear</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">c</span> <span class="op">|</span> <span class="va">mother</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">brms_m2.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brm.html">brm</a></span><span class="op">(</span></span>
<span>  <span class="va">bf_bwt_2</span> <span class="op">+</span> <span class="va">bf_tarsus_2</span> <span class="op">+</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula-helpers.html">set_rescor</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gryphon</span>,</span>
<span>  data2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Amat <span class="op">=</span> <span class="va">Amat</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">2</span>, cores <span class="op">=</span> <span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">brms_m2.2</span>, file <span class="op">=</span> <span class="st">"data/brms_m2_2.rda"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Again we have provided the data from one such run. It can be accessed using the code:</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/brms_m2_2.rda"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">brms_m2.2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Parts of the model have not converged (some Rhats are &gt; 1.05). Be
careful when analysing the results! We recommend running more iterations and/or
setting stronger priors.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 4 divergent transitions after warmup. Increasing
adapt_delta above 0.8 may help. See
http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: MV(gaussian, gaussian) 
  Links: mu = identity; sigma = identity
         mu = identity; sigma = identity 
Formula: bwt ~ 1 + sex + (1 | a | gr(animal, cov = Amat)) + (1 | b | byear) + (1 | c | mother) 
         tarsus ~ 1 + sex + (1 | a | gr(animal, cov = Amat)) + (1 | b | byear) + (1 | c | mother) 
   Data: gryphon (Number of observations: 683) 
  Draws: 2 chains, each with iter = 1000; warmup = 500; thin = 1;
         total post-warmup draws = 1000

Group-Level Effects: 
~animal (Number of levels: 683) 
                                    Estimate Est.Error l-95% CI u-95% CI Rhat
sd(bwt_Intercept)                       1.31      0.21     0.86     1.69 1.06
sd(tarsus_Intercept)                    2.88      0.47     1.88     3.70 1.01
cor(bwt_Intercept,tarsus_Intercept)     0.60      0.17     0.18     0.89 1.09
                                    Bulk_ESS Tail_ESS
sd(bwt_Intercept)                         54       58
sd(tarsus_Intercept)                      52      162
cor(bwt_Intercept,tarsus_Intercept)       25       30

~byear (Number of levels: 34) 
                                    Estimate Est.Error l-95% CI u-95% CI Rhat
sd(bwt_Intercept)                       0.99      0.17     0.71     1.39 1.00
sd(tarsus_Intercept)                    2.02      0.34     1.45     2.78 1.00
cor(bwt_Intercept,tarsus_Intercept)     0.01      0.22    -0.44     0.44 1.01
                                    Bulk_ESS Tail_ESS
sd(bwt_Intercept)                        424      509
sd(tarsus_Intercept)                     525      699
cor(bwt_Intercept,tarsus_Intercept)      478      492

~mother (Number of levels: 352) 
                                    Estimate Est.Error l-95% CI u-95% CI Rhat
sd(bwt_Intercept)                       1.14      0.12     0.90     1.36 1.01
sd(tarsus_Intercept)                    2.09      0.29     1.54     2.67 1.01
cor(bwt_Intercept,tarsus_Intercept)    -0.64      0.20    -0.97    -0.24 1.02
                                    Bulk_ESS Tail_ESS
sd(bwt_Intercept)                        370      764
sd(tarsus_Intercept)                     134      420
cor(bwt_Intercept,tarsus_Intercept)       84      147

Population-Level Effects: 
                 Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
bwt_Intercept        6.28      0.24     5.80     6.73 1.00      453      703
tarsus_Intercept    20.39      0.52    19.45    21.39 1.00      755      760
bwt_sex2             2.05      0.17     1.71     2.37 1.00     1097      715
tarsus_sex2          0.11      0.42    -0.67     0.90 1.00      780      578

Family Specific Parameters: 
             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma_bwt        1.40      0.16     1.05     1.68 1.04       59       60
sigma_tarsus     3.73      0.32     3.14     4.32 1.00       55      176

Residual Correlations: 
                   Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
rescor(bwt,tarsus)     0.89      0.07     0.72     0.98 1.50        4       24

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">brms_m2.2</span>, ask <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-10-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-10-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">brms_m2.2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$animal
$animal$sd
                 Estimate Est.Error      Q2.5    Q97.5
bwt_Intercept    1.306921 0.2109780 0.8555702 1.687254
tarsus_Intercept 2.876731 0.4718524 1.8827128 3.699873

$animal$cor
, , bwt_Intercept

                  Estimate Est.Error      Q2.5     Q97.5
bwt_Intercept    1.0000000 0.0000000 1.0000000 1.0000000
tarsus_Intercept 0.5961514 0.1727943 0.1849725 0.8929607

, , tarsus_Intercept

                  Estimate Est.Error      Q2.5     Q97.5
bwt_Intercept    0.5961514 0.1727943 0.1849725 0.8929607
tarsus_Intercept 1.0000000 0.0000000 1.0000000 1.0000000


$animal$cov
, , bwt_Intercept

                 Estimate Est.Error      Q2.5    Q97.5
bwt_Intercept    1.752510 0.5433004 0.7320013 2.846827
tarsus_Intercept 2.357852 1.0462644 0.3960956 4.526731

, , tarsus_Intercept

                 Estimate Est.Error      Q2.5     Q97.5
bwt_Intercept    2.357852  1.046264 0.3960956  4.526731
tarsus_Intercept 8.498003  2.672465 3.5446115 13.689062



$byear
$byear$sd
                  Estimate Est.Error      Q2.5    Q97.5
bwt_Intercept    0.9904858 0.1696752 0.7102391 1.390260
tarsus_Intercept 2.0166804 0.3366954 1.4463862 2.777005

$byear$cor
, , bwt_Intercept

                   Estimate Est.Error       Q2.5     Q97.5
bwt_Intercept    1.00000000 0.0000000  1.0000000 1.0000000
tarsus_Intercept 0.01351405 0.2206186 -0.4367809 0.4412319

, , tarsus_Intercept

                   Estimate Est.Error       Q2.5     Q97.5
bwt_Intercept    0.01351405 0.2206186 -0.4367809 0.4412319
tarsus_Intercept 1.00000000 0.0000000  1.0000000 1.0000000


$byear$cov
, , bwt_Intercept

                   Estimate Est.Error       Q2.5    Q97.5
bwt_Intercept    1.00982294 0.3583697  0.5044397 1.932823
tarsus_Intercept 0.06412895 0.4880116 -0.8559486 1.092317

, , tarsus_Intercept

                   Estimate Est.Error       Q2.5    Q97.5
bwt_Intercept    0.06412895 0.4880116 -0.8559486 1.092317
tarsus_Intercept 4.18025049 1.4249595  2.0920330 7.711755



$mother
$mother$sd
                 Estimate Est.Error      Q2.5    Q97.5
bwt_Intercept    1.137249 0.1175495 0.8968349 1.358078
tarsus_Intercept 2.088602 0.2865291 1.5425683 2.673791

$mother$cor
, , bwt_Intercept

                   Estimate Est.Error       Q2.5      Q97.5
bwt_Intercept     1.0000000 0.0000000  1.0000000  1.0000000
tarsus_Intercept -0.6413329 0.1968102 -0.9745925 -0.2367393

, , tarsus_Intercept

                   Estimate Est.Error       Q2.5      Q97.5
bwt_Intercept    -0.6413329 0.1968102 -0.9745925 -0.2367393
tarsus_Intercept  1.0000000 0.0000000  1.0000000  1.0000000


$mother$cov
, , bwt_Intercept

                  Estimate Est.Error       Q2.5      Q97.5
bwt_Intercept     1.307139 0.2669748  0.8043132  1.8443762
tarsus_Intercept -1.467511 0.3650113 -2.1491979 -0.6718737

, , tarsus_Intercept

                  Estimate Est.Error      Q2.5      Q97.5
bwt_Intercept    -1.467511 0.3650113 -2.149198 -0.6718737
tarsus_Intercept  4.444274 1.2018090  2.379517  7.1491575



$residual__
$residual__$sd
       Estimate Est.Error     Q2.5    Q97.5
bwt    1.396815 0.1597393 1.052042 1.684810
tarsus 3.733614 0.3170549 3.140204 4.319446

$residual__$cor
, , bwt

        Estimate Est.Error      Q2.5     Q97.5
bwt    1.0000000 0.0000000 1.0000000 1.0000000
tarsus 0.8925119 0.0672286 0.7167862 0.9774545

, , tarsus

        Estimate Est.Error      Q2.5     Q97.5
bwt    0.8925119 0.0672286 0.7167862 0.9774545
tarsus 1.0000000 0.0000000 1.0000000 1.0000000


$residual__$cov
, , bwt

       Estimate Est.Error     Q2.5    Q97.5
bwt    1.976584 0.4347085 1.106793 2.838585
tarsus 4.683451 0.9103808 2.846560 6.440550

, , tarsus

        Estimate Est.Error     Q2.5    Q97.5
bwt     4.683451 0.9103808 2.846560  6.44055
tarsus 14.040300 2.3674563 9.860883 18.65761</code></pre>
</div>
</div>
<p>Evaluation of the statistical support for these genetic and maternal correlations is straightforward. Because we imposed no constraint on their estimation, we can evaluate the extent to which the posterior distributions overlap zero:</p>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cor_g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">as.mcmc</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">brms_m2.2</span>, summary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">animal</span><span class="op">$</span><span class="va">cor</span><span class="op">[</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cor_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">as.mcmc</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">brms_m2.2</span>, summary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">residual</span><span class="op">$</span><span class="va">cor</span><span class="op">[</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cor_mother</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">as.mcmc</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">brms_m2.2</span>, summary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">mother</span><span class="op">$</span><span class="va">cor</span><span class="op">[</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cor_byear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">as.mcmc</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">brms_m2.2</span>, summary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">byear</span><span class="op">$</span><span class="va">cor</span><span class="op">[</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_g</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 1:1000
Thinning interval = 1 
Number of chains = 1 
Sample size per chain = 1000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

          Mean             SD       Naive SE Time-series SE 
      0.596151       0.172794       0.005464       0.028178 

2. Quantiles for each variable:

  2.5%    25%    50%    75%  97.5% 
0.1850 0.5065 0.6117 0.7064 0.8930 </code></pre>
</div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_mother</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 1:1000
Thinning interval = 1 
Number of chains = 1 
Sample size per chain = 1000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

          Mean             SD       Naive SE Time-series SE 
     -0.641333       0.196810       0.006224       0.021355 

2. Quantiles for each variable:

   2.5%     25%     50%     75%   97.5% 
-0.9746 -0.7933 -0.6507 -0.5027 -0.2367 </code></pre>
</div>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_byear</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 1:1000
Thinning interval = 1 
Number of chains = 1 
Sample size per chain = 1000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

          Mean             SD       Naive SE Time-series SE 
      0.013514       0.220619       0.006977       0.009633 

2. Quantiles for each variable:

    2.5%      25%      50%      75%    97.5% 
-0.43678 -0.13505  0.02408  0.16947  0.44123 </code></pre>
</div>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_res</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 1:1000
Thinning interval = 1 
Number of chains = 1 
Sample size per chain = 1000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

          Mean             SD       Naive SE Time-series SE 
      0.892512       0.067229       0.002126       0.026496 

2. Quantiles for each variable:

  2.5%    25%    50%    75%  97.5% 
0.7168 0.8620 0.9069 0.9425 0.9775 </code></pre>
</div>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cor_g</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cor_res</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cor_mother</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-11-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cor_byear</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-11-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Neither or these posterior distributions overlaps zero, so we can consider them both statistically supported.</p>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cor.est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_g</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_g</span><span class="op">)</span><span class="op">$</span><span class="va">quantiles</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_g</span><span class="op">)</span><span class="op">$</span><span class="va">quantiles</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_mother</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_mother</span><span class="op">)</span><span class="op">$</span><span class="va">quantiles</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_mother</span><span class="op">)</span><span class="op">$</span><span class="va">quantiles</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_byear</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_byear</span><span class="op">)</span><span class="op">$</span><span class="va">quantiles</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_byear</span><span class="op">)</span><span class="op">$</span><span class="va">quantiles</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_res</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_res</span><span class="op">)</span><span class="op">$</span><span class="va">quantiles</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_res</span><span class="op">)</span><span class="op">$</span><span class="va">quantiles</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span> <span class="op">~</span> <span class="va">cor.est</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>, cex <span class="op">=</span> <span class="fl">2</span>, yaxt <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>y0 <span class="op">=</span> <span class="fl">1</span>, x0 <span class="op">=</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span>, y1 <span class="op">=</span> <span class="fl">1</span>, x1 <span class="op">=</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>y0 <span class="op">=</span> <span class="fl">2</span>, x0 <span class="op">=</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span>, y1 <span class="op">=</span> <span class="fl">2</span>, x1 <span class="op">=</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>y0 <span class="op">=</span> <span class="fl">3</span>, x0 <span class="op">=</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">]</span>, y1 <span class="op">=</span> <span class="fl">3</span>, x1 <span class="op">=</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>y0 <span class="op">=</span> <span class="fl">4</span>, x0 <span class="op">=</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">]</span>, y1 <span class="op">=</span> <span class="fl">4</span>, x1 <span class="op">=</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"Correlation (±CI)"</span>, side <span class="op">=</span> <span class="fl">1</span>, las <span class="op">=</span> <span class="fl">1</span>, adj <span class="op">=</span> <span class="fl">0.4</span>, line <span class="op">=</span> <span class="fl">3</span>, cex <span class="op">=</span> <span class="fl">1.6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">2</span>, at <span class="op">=</span> <span class="fl">1</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"genetic"</span><span class="op">)</span>, las <span class="op">=</span> <span class="fl">2</span>, cex.axis <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">2</span>, at <span class="op">=</span> <span class="fl">2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mother"</span><span class="op">)</span>, las <span class="op">=</span> <span class="fl">2</span>, cex.axis <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">2</span>, at <span class="op">=</span> <span class="fl">3</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span><span class="op">)</span>, las <span class="op">=</span> <span class="fl">2</span>, cex.axis <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">2</span>, at <span class="op">=</span> <span class="fl">4</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"residual"</span><span class="op">)</span>, las <span class="op">=</span> <span class="fl">2</span>, cex.axis <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Note, brms estimates the correlation and also the covariance. We can also recalculate the correlation directly from the covariance.To facilitate the extraction of the different parameter, we can the fucntion <code>as_draws_df</code></p>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cov_g</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">brms_m2.2</span>, summary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">animal</span><span class="op">$</span><span class="va">cov</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">cov_res</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">brms_m2.2</span>, summary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">residual</span><span class="op">$</span><span class="va">cov</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">cov_mother</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">brms_m2.2</span>, summary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">mother</span><span class="op">$</span><span class="va">cov</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">cov_byear</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">brms_m2.2</span>, summary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">byear</span><span class="op">$</span><span class="va">cov</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span></span>
<span></span>
<span><span class="va">var.est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_df.html">as_draws_df</a></span><span class="op">(</span><span class="va">brms_m2.2</span>, variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sd"</span>, <span class="st">"sigma"</span><span class="op">)</span>, regex <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">var.est</span> <span class="op">&lt;-</span> <span class="va">var.est</span><span class="op">^</span><span class="fl">2</span></span>
<span></span>
<span><span class="va">cor_g_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">as.mcmc</a></span><span class="op">(</span><span class="va">cov_g</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var.est</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">var.est</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cor_byear_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">as.mcmc</a></span><span class="op">(</span><span class="va">cov_byear</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var.est</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">*</span> <span class="va">var.est</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cor_mother_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">as.mcmc</a></span><span class="op">(</span><span class="va">cov_g</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var.est</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span> <span class="op">*</span> <span class="va">var.est</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cor_res_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">as.mcmc</a></span><span class="op">(</span><span class="va">cov_res</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var.est</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span> <span class="op">*</span> <span class="va">var.est</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_g_2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 1:1000
Thinning interval = 1 
Number of chains = 1 
Sample size per chain = 1000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

          Mean             SD       Naive SE Time-series SE 
      0.596151       0.172794       0.005464       0.028178 

2. Quantiles for each variable:

  2.5%    25%    50%    75%  97.5% 
0.1850 0.5065 0.6117 0.7064 0.8930 </code></pre>
</div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_byear_2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 1:1000
Thinning interval = 1 
Number of chains = 1 
Sample size per chain = 1000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

          Mean             SD       Naive SE Time-series SE 
      0.013514       0.220619       0.006977       0.009633 

2. Quantiles for each variable:

    2.5%      25%      50%      75%    97.5% 
-0.43678 -0.13505  0.02408  0.16947  0.44123 </code></pre>
</div>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_mother_2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 1:1000
Thinning interval = 1 
Number of chains = 1 
Sample size per chain = 1000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

          Mean             SD       Naive SE Time-series SE 
       1.01862        0.46337        0.01465        0.06126 

2. Quantiles for each variable:

  2.5%    25%    50%    75%  97.5% 
0.1514 0.6969 1.0310 1.3241 2.0032 </code></pre>
</div>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_res_2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 1:1000
Thinning interval = 1 
Number of chains = 1 
Sample size per chain = 1000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

          Mean             SD       Naive SE Time-series SE 
      0.892512       0.067229       0.002126       0.026496 

2. Quantiles for each variable:

  2.5%    25%    50%    75%  97.5% 
0.7168 0.8620 0.9069 0.9425 0.9775 </code></pre>
</div>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cor_g_2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cor_byear_2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cor_mother_2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-13-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cor_res_2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-13-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="partitioning-covariances" class="level3" data-number="10.0.3"><h3 data-number="10.0.3" class="anchored" data-anchor-id="partitioning-covariances">
<span class="header-section-number">10.0.3</span> Partitioning (co)variances</h3>
<p>As in the tutorial 1, it is possible to partition the variance-covariance matrix between groups (here sex)</p>
<div class="cell">
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bf_bwt_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula.html">bf</a></span><span class="op">(</span><span class="va">bwt</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">a</span> <span class="op">|</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/gr.html">gr</a></span><span class="op">(</span><span class="va">animal</span>, cov <span class="op">=</span> <span class="va">Amat</span>, by <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">b</span> <span class="op">|</span> <span class="va">byear</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">c</span> <span class="op">|</span> <span class="va">mother</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bf_tarsus_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula.html">bf</a></span><span class="op">(</span><span class="va">tarsus</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">a</span> <span class="op">|</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/gr.html">gr</a></span><span class="op">(</span><span class="va">animal</span>, cov <span class="op">=</span> <span class="va">Amat</span>, by <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">b</span> <span class="op">|</span> <span class="va">byear</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">c</span> <span class="op">|</span> <span class="va">mother</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">brms_m2.3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brm.html">brm</a></span><span class="op">(</span></span>
<span>  <span class="va">bf_bwt_3</span> <span class="op">+</span> <span class="va">bf_tarsus_3</span> <span class="op">+</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula-helpers.html">set_rescor</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gryphon</span>,</span>
<span>  data2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Amat <span class="op">=</span> <span class="va">Amat</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">2</span>, cores <span class="op">=</span> <span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">brms_m2.3</span>, file <span class="op">=</span> <span class="st">"data/brms_m2_3.rda"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Again we have provided the data from one such run. It can be accessed using the code:</p>
<div class="cell">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/brms_m2_3.rda"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">brms_m2.3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Parts of the model have not converged (some Rhats are &gt; 1.05). Be
careful when analysing the results! We recommend running more iterations and/or
setting stronger priors.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 6 divergent transitions after warmup. Increasing
adapt_delta above 0.8 may help. See
http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: MV(gaussian, gaussian) 
  Links: mu = identity; sigma = identity
         mu = identity; sigma = identity 
Formula: bwt ~ 1 + sex + ((1 | a | gr(animal, cov = Amat, by = sex))) + (1 | b | byear) + (1 | c | mother) 
         tarsus ~ 1 + sex + (1 | a | gr(animal, cov = Amat, by = sex)) + (1 | b | byear) + (1 | c | mother) 
   Data: gryphon (Number of observations: 683) 
  Draws: 2 chains, each with iter = 1000; warmup = 500; thin = 1;
         total post-warmup draws = 1000

Group-Level Effects: 
~animal (Number of levels: 683) 
                                              Estimate Est.Error l-95% CI
sd(bwt_Intercept:sex1)                            1.05      0.28     0.48
sd(tarsus_Intercept:sex1)                         1.57      0.78     0.14
sd(bwt_Intercept:sex2)                            1.23      0.24     0.71
sd(tarsus_Intercept:sex2)                         3.24      0.48     2.17
cor(bwt_Intercept:sex1,tarsus_Intercept:sex1)     0.32      0.43    -0.78
cor(bwt_Intercept:sex2,tarsus_Intercept:sex2)     0.70      0.12     0.45
                                              u-95% CI Rhat Bulk_ESS Tail_ESS
sd(bwt_Intercept:sex1)                            1.58 1.27        6       39
sd(tarsus_Intercept:sex1)                         3.03 1.08       24      117
sd(bwt_Intercept:sex2)                            1.65 1.24        7       46
sd(tarsus_Intercept:sex2)                         4.13 1.05       37       79
cor(bwt_Intercept:sex1,tarsus_Intercept:sex1)     0.90 1.07       25      202
cor(bwt_Intercept:sex2,tarsus_Intercept:sex2)     0.90 1.09       28       44

~byear (Number of levels: 34) 
                                    Estimate Est.Error l-95% CI u-95% CI Rhat
sd(bwt_Intercept)                       0.97      0.14     0.70     1.26 1.01
sd(tarsus_Intercept)                    2.03      0.34     1.47     2.80 1.00
cor(bwt_Intercept,tarsus_Intercept)     0.01      0.21    -0.41     0.41 1.01
                                    Bulk_ESS Tail_ESS
sd(bwt_Intercept)                        282      292
sd(tarsus_Intercept)                     324      361
cor(bwt_Intercept,tarsus_Intercept)      183      393

~mother (Number of levels: 352) 
                                    Estimate Est.Error l-95% CI u-95% CI Rhat
sd(bwt_Intercept)                       1.18      0.11     0.96     1.39 1.02
sd(tarsus_Intercept)                    2.04      0.34     1.33     2.65 1.09
cor(bwt_Intercept,tarsus_Intercept)    -0.63      0.21    -0.97    -0.23 1.08
                                    Bulk_ESS Tail_ESS
sd(bwt_Intercept)                        170      352
sd(tarsus_Intercept)                      24       60
cor(bwt_Intercept,tarsus_Intercept)       22      100

Population-Level Effects: 
                 Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
bwt_Intercept        6.27      0.22     5.82     6.68 1.00      195      123
tarsus_Intercept    20.35      0.48    19.35    21.21 1.00      494      578
bwt_sex2             2.04      0.17     1.71     2.36 1.01      265      384
tarsus_sex2          0.14      0.39    -0.60     0.88 1.00      691      621

Family Specific Parameters: 
             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma_bwt        1.49      0.15     1.16     1.74 1.33        5       81
sigma_tarsus     3.88      0.27     3.27     4.35 1.04       42       85

Residual Correlations: 
                   Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
rescor(bwt,tarsus)     0.87      0.05     0.78     0.94 1.04       22       94

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">brms_m2.3</span>, ask <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-15-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-15-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-15-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">brms_m2.3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$animal
$animal$sd
                      Estimate Est.Error      Q2.5    Q97.5
bwt_Intercept:sex1    1.051791 0.2757021 0.4836926 1.575837
tarsus_Intercept:sex1 1.573820 0.7777373 0.1389929 3.025426
bwt_Intercept:sex2    1.232722 0.2436415 0.7075357 1.650628
tarsus_Intercept:sex2 3.237363 0.4773725 2.1667846 4.126560

$animal$cor
, , bwt_Intercept:sex1

                       Estimate Est.Error       Q2.5     Q97.5
bwt_Intercept:sex1    1.0000000 0.0000000  1.0000000 1.0000000
tarsus_Intercept:sex1 0.3232502 0.4324034 -0.7811983 0.9007145
bwt_Intercept:sex2    0.0000000 0.0000000  0.0000000 0.0000000
tarsus_Intercept:sex2 0.0000000 0.0000000  0.0000000 0.0000000

, , tarsus_Intercept:sex1

                       Estimate Est.Error       Q2.5     Q97.5
bwt_Intercept:sex1    0.3232502 0.4324034 -0.7811983 0.9007145
tarsus_Intercept:sex1 1.0000000 0.0000000  1.0000000 1.0000000
bwt_Intercept:sex2    0.0000000 0.0000000  0.0000000 0.0000000
tarsus_Intercept:sex2 0.0000000 0.0000000  0.0000000 0.0000000

, , bwt_Intercept:sex2

                       Estimate Est.Error      Q2.5     Q97.5
bwt_Intercept:sex1    0.0000000 0.0000000 0.0000000 0.0000000
tarsus_Intercept:sex1 0.0000000 0.0000000 0.0000000 0.0000000
bwt_Intercept:sex2    1.0000000 0.0000000 1.0000000 1.0000000
tarsus_Intercept:sex2 0.6975925 0.1213692 0.4474181 0.9047623

, , tarsus_Intercept:sex2

                       Estimate Est.Error      Q2.5     Q97.5
bwt_Intercept:sex1    0.0000000 0.0000000 0.0000000 0.0000000
tarsus_Intercept:sex1 0.0000000 0.0000000 0.0000000 0.0000000
bwt_Intercept:sex2    0.6975925 0.1213692 0.4474181 0.9047623
tarsus_Intercept:sex2 1.0000000 0.0000000 1.0000000 1.0000000


$animal$cov
, , bwt_Intercept:sex1

                       Estimate Est.Error       Q2.5    Q97.5
bwt_Intercept:sex1    1.1821990 0.5768155  0.2339592 2.483263
tarsus_Intercept:sex1 0.7957577 0.9482719 -0.4879668 3.035395
bwt_Intercept:sex2    0.0000000 0.0000000  0.0000000 0.000000
tarsus_Intercept:sex2 0.0000000 0.0000000  0.0000000 0.000000

, , tarsus_Intercept:sex1

                       Estimate Est.Error        Q2.5    Q97.5
bwt_Intercept:sex1    0.7957577 0.9482719 -0.48796685 3.035395
tarsus_Intercept:sex1 3.0811806 2.5183190  0.01931907 9.153208
bwt_Intercept:sex2    0.0000000 0.0000000  0.00000000 0.000000
tarsus_Intercept:sex2 0.0000000 0.0000000  0.00000000 0.000000

, , bwt_Intercept:sex2

                      Estimate Est.Error      Q2.5    Q97.5
bwt_Intercept:sex1    0.000000 0.0000000 0.0000000 0.000000
tarsus_Intercept:sex1 0.000000 0.0000000 0.0000000 0.000000
bwt_Intercept:sex2    1.578907 0.5865683 0.5006069 2.724572
tarsus_Intercept:sex2 2.842372 1.0153859 1.1593760 5.086448

, , tarsus_Intercept:sex2

                       Estimate Est.Error     Q2.5     Q97.5
bwt_Intercept:sex1     0.000000  0.000000 0.000000  0.000000
tarsus_Intercept:sex1  0.000000  0.000000 0.000000  0.000000
bwt_Intercept:sex2     2.842372  1.015386 1.159376  5.086448
tarsus_Intercept:sex2 10.708178  3.017245 4.694964 17.028497



$byear
$byear$sd
                  Estimate Est.Error      Q2.5    Q97.5
bwt_Intercept    0.9676965 0.1434955 0.7018779 1.258518
tarsus_Intercept 2.0290144 0.3382466 1.4650518 2.801932

$byear$cor
, , bwt_Intercept

                    Estimate Est.Error       Q2.5    Q97.5
bwt_Intercept    1.000000000 0.0000000  1.0000000 1.000000
tarsus_Intercept 0.009103073 0.2077977 -0.4096021 0.410902

, , tarsus_Intercept

                    Estimate Est.Error       Q2.5    Q97.5
bwt_Intercept    0.009103073 0.2077977 -0.4096021 0.410902
tarsus_Intercept 1.000000000 0.0000000  1.0000000 1.000000


$byear$cov
, , bwt_Intercept

                   Estimate Est.Error       Q2.5    Q97.5
bwt_Intercept    0.95700691 0.2875804  0.4926327 1.583869
tarsus_Intercept 0.04233908 0.4457863 -0.8475401 1.014920

, , tarsus_Intercept

                   Estimate Est.Error       Q2.5    Q97.5
bwt_Intercept    0.04233908 0.4457863 -0.8475401 1.014920
tarsus_Intercept 4.23119588 1.4453420  2.1463767 7.850826



$mother
$mother$sd
                 Estimate Est.Error     Q2.5    Q97.5
bwt_Intercept    1.175168 0.1083817 0.958963 1.388926
tarsus_Intercept 2.038471 0.3445355 1.327549 2.648997

$mother$cor
, , bwt_Intercept

                   Estimate Est.Error       Q2.5      Q97.5
bwt_Intercept     1.0000000 0.0000000  1.0000000  1.0000000
tarsus_Intercept -0.6301934 0.2113836 -0.9652044 -0.2283133

, , tarsus_Intercept

                   Estimate Est.Error       Q2.5      Q97.5
bwt_Intercept    -0.6301934 0.2113836 -0.9652044 -0.2283133
tarsus_Intercept  1.0000000 0.0000000  1.0000000  1.0000000


$mother$cov
, , bwt_Intercept

                  Estimate Est.Error       Q2.5     Q97.5
bwt_Intercept     1.392755 0.2562907  0.9196105  1.929117
tarsus_Intercept -1.434727 0.3664843 -2.0769067 -0.674943

, , tarsus_Intercept

                  Estimate Est.Error      Q2.5     Q97.5
bwt_Intercept    -1.434727 0.3664843 -2.076907 -0.674943
tarsus_Intercept  4.273951 1.3914013  1.762387  7.017188



$residual__
$residual__$sd
       Estimate Est.Error     Q2.5    Q97.5
bwt    1.489342 0.1489641 1.162192 1.741559
tarsus 3.875633 0.2650604 3.268802 4.345400

$residual__$cor
, , bwt

        Estimate  Est.Error      Q2.5     Q97.5
bwt    1.0000000 0.00000000 1.0000000 1.0000000
tarsus 0.8685184 0.04534008 0.7772864 0.9414488

, , tarsus

        Estimate  Est.Error      Q2.5     Q97.5
bwt    0.8685184 0.04534008 0.7772864 0.9414488
tarsus 1.0000000 0.00000000 1.0000000 1.0000000


$residual__$cov
, , bwt

       Estimate Est.Error     Q2.5    Q97.5
bwt    2.240307 0.4341334 1.350691 3.033029
tarsus 5.034739 0.7852137 3.272088 6.400539

, , tarsus

        Estimate Est.Error      Q2.5     Q97.5
bwt     5.034739 0.7852137  3.272088  6.400539
tarsus 15.090721 2.0309529 10.685067 18.882505</code></pre>
</div>
</div>
<p>However, this model is lacking an important and essentiel group-specific partitionning (we do with the asreml-R and MCMCglmm). We need to partition the residual variance (or sigma) as well. Doing so, we will use the argument `sigma`` to parititon the model by sex. To avoid an estimation of the difference between sexes, we need to remove the estimate of the intercept at the sigma level.</p>
<div class="cell">
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bf_bwt_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula.html">bf</a></span><span class="op">(</span><span class="va">bwt</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">a</span> <span class="op">|</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/gr.html">gr</a></span><span class="op">(</span><span class="va">animal</span>, cov <span class="op">=</span> <span class="va">Amat</span>, by <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">b</span> <span class="op">|</span> <span class="va">byear</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">c</span> <span class="op">|</span> <span class="va">mother</span><span class="op">)</span>, <span class="va">sigma</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">bf_tarsus_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula.html">bf</a></span><span class="op">(</span><span class="va">tarsus</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">a</span> <span class="op">|</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/gr.html">gr</a></span><span class="op">(</span><span class="va">animal</span>, cov <span class="op">=</span> <span class="va">Amat</span>, by <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">b</span> <span class="op">|</span> <span class="va">byear</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">c</span> <span class="op">|</span> <span class="va">mother</span><span class="op">)</span>, <span class="va">sigma</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">brms_m2.4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brm.html">brm</a></span><span class="op">(</span></span>
<span>  <span class="va">bf_bwt_4</span> <span class="op">+</span> <span class="va">bf_tarsus_4</span> <span class="op">+</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula-helpers.html">set_rescor</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gryphon</span>,</span>
<span>  data2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Amat <span class="op">=</span> <span class="va">Amat</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">2</span>, cores <span class="op">=</span> <span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">brms_m2.4</span>, file <span class="op">=</span> <span class="st">"data/brms_m2_4.rda"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Again we have provided the data from one such run. It can be accessed using the code:</p>
<div class="cell">
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/brms_m2_4.rda"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">brms_m2.4</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Parts of the model have not converged (some Rhats are &gt; 1.05). Be
careful when analysing the results! We recommend running more iterations and/or
setting stronger priors.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 6 divergent transitions after warmup. Increasing
adapt_delta above 0.8 may help. See
http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: MV(gaussian, gaussian) 
  Links: mu = identity; sigma = log
         mu = identity; sigma = log 
Formula: bwt ~ 1 + sex + ((1 | a | gr(animal, cov = Amat, by = sex))) + (1 | b | byear) + (1 | c | mother) 
         sigma ~ sex - 1
         tarsus ~ 1 + sex + (1 | a | gr(animal, cov = Amat, by = sex)) + (1 | b | byear) + (1 | c | mother) 
         sigma ~ sex - 1
   Data: gryphon (Number of observations: 683) 
  Draws: 2 chains, each with iter = 1000; warmup = 500; thin = 1;
         total post-warmup draws = 1000

Group-Level Effects: 
~animal (Number of levels: 683) 
                                              Estimate Est.Error l-95% CI
sd(bwt_Intercept:sex1)                            0.86      0.35     0.14
sd(tarsus_Intercept:sex1)                         1.40      0.82     0.10
sd(bwt_Intercept:sex2)                            1.40      0.23     0.94
sd(tarsus_Intercept:sex2)                         3.49      0.72     1.96
cor(bwt_Intercept:sex1,tarsus_Intercept:sex1)     0.28      0.51    -0.85
cor(bwt_Intercept:sex2,tarsus_Intercept:sex2)     0.78      0.10     0.56
                                              u-95% CI Rhat Bulk_ESS Tail_ESS
sd(bwt_Intercept:sex1)                            1.48 1.00       59      101
sd(tarsus_Intercept:sex1)                         3.00 1.07       45      111
sd(bwt_Intercept:sex2)                            1.83 1.04       42       40
sd(tarsus_Intercept:sex2)                         4.62 1.22        8       50
cor(bwt_Intercept:sex1,tarsus_Intercept:sex1)     0.94 1.05       60      287
cor(bwt_Intercept:sex2,tarsus_Intercept:sex2)     0.97 1.09       30       94

~byear (Number of levels: 34) 
                                    Estimate Est.Error l-95% CI u-95% CI Rhat
sd(bwt_Intercept)                       0.97      0.15     0.73     1.30 1.01
sd(tarsus_Intercept)                    2.01      0.33     1.41     2.70 1.00
cor(bwt_Intercept,tarsus_Intercept)    -0.00      0.22    -0.42     0.45 1.02
                                    Bulk_ESS Tail_ESS
sd(bwt_Intercept)                        283      412
sd(tarsus_Intercept)                     349      554
cor(bwt_Intercept,tarsus_Intercept)      225      256

~mother (Number of levels: 352) 
                                    Estimate Est.Error l-95% CI u-95% CI Rhat
sd(bwt_Intercept)                       1.19      0.11     0.98     1.42 1.00
sd(tarsus_Intercept)                    2.14      0.30     1.57     2.71 1.05
cor(bwt_Intercept,tarsus_Intercept)    -0.55      0.21    -0.96    -0.16 1.04
                                    Bulk_ESS Tail_ESS
sd(bwt_Intercept)                        279      434
sd(tarsus_Intercept)                      46      227
cor(bwt_Intercept,tarsus_Intercept)       46      122

Population-Level Effects: 
                  Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
bwt_Intercept         6.27      0.23     5.82     6.73 1.01      336      556
tarsus_Intercept     20.39      0.49    19.42    21.37 1.00      384      509
bwt_sex2              2.04      0.17     1.70     2.38 1.00      483      507
sigma_bwt_sex1        0.45      0.12     0.18     0.63 1.00       68      128
sigma_bwt_sex2        0.26      0.17    -0.17     0.52 1.06       38       33
tarsus_sex2           0.10      0.41    -0.69     0.92 1.00      658      659
sigma_tarsus_sex1     1.37      0.08     1.19     1.50 1.04       65      215
sigma_tarsus_sex2     1.24      0.16     0.91     1.50 1.22        7       67

Residual Correlations: 
                   Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
rescor(bwt,tarsus)     0.84      0.05     0.73     0.93 1.15       11       29

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">brms_m2.4</span>, ask <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-17-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-17-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-17-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">brms_m2.4</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$animal
$animal$sd
                       Estimate Est.Error       Q2.5    Q97.5
bwt_Intercept:sex1    0.8628389 0.3531696 0.14360929 1.481121
tarsus_Intercept:sex1 1.3985239 0.8163731 0.09977045 3.002609
bwt_Intercept:sex2    1.4023202 0.2325863 0.93896619 1.833688
tarsus_Intercept:sex2 3.4858243 0.7167230 1.96177030 4.620105

$animal$cor
, , bwt_Intercept:sex1

                      Estimate Est.Error       Q2.5     Q97.5
bwt_Intercept:sex1    1.000000 0.0000000  1.0000000 1.0000000
tarsus_Intercept:sex1 0.277338 0.5119501 -0.8479996 0.9398158
bwt_Intercept:sex2    0.000000 0.0000000  0.0000000 0.0000000
tarsus_Intercept:sex2 0.000000 0.0000000  0.0000000 0.0000000

, , tarsus_Intercept:sex1

                      Estimate Est.Error       Q2.5     Q97.5
bwt_Intercept:sex1    0.277338 0.5119501 -0.8479996 0.9398158
tarsus_Intercept:sex1 1.000000 0.0000000  1.0000000 1.0000000
bwt_Intercept:sex2    0.000000 0.0000000  0.0000000 0.0000000
tarsus_Intercept:sex2 0.000000 0.0000000  0.0000000 0.0000000

, , bwt_Intercept:sex2

                       Estimate  Est.Error     Q2.5     Q97.5
bwt_Intercept:sex1    0.0000000 0.00000000 0.000000 0.0000000
tarsus_Intercept:sex1 0.0000000 0.00000000 0.000000 0.0000000
bwt_Intercept:sex2    1.0000000 0.00000000 1.000000 1.0000000
tarsus_Intercept:sex2 0.7781659 0.09850178 0.564036 0.9699765

, , tarsus_Intercept:sex2

                       Estimate  Est.Error     Q2.5     Q97.5
bwt_Intercept:sex1    0.0000000 0.00000000 0.000000 0.0000000
tarsus_Intercept:sex1 0.0000000 0.00000000 0.000000 0.0000000
bwt_Intercept:sex2    0.7781659 0.09850178 0.564036 0.9699765
tarsus_Intercept:sex2 1.0000000 0.00000000 1.000000 1.0000000


$animal$cov
, , bwt_Intercept:sex1

                       Estimate Est.Error       Q2.5    Q97.5
bwt_Intercept:sex1    0.8690949 0.6002446  0.0206250 2.193721
tarsus_Intercept:sex1 0.6483841 0.9143700 -0.4481203 2.989048
bwt_Intercept:sex2    0.0000000 0.0000000  0.0000000 0.000000
tarsus_Intercept:sex2 0.0000000 0.0000000  0.0000000 0.000000

, , tarsus_Intercept:sex1

                       Estimate Est.Error         Q2.5    Q97.5
bwt_Intercept:sex1    0.6483841  0.914370 -0.448120294 2.989048
tarsus_Intercept:sex1 2.6216677  2.500989  0.009954235 9.015666
bwt_Intercept:sex2    0.0000000  0.000000  0.000000000 0.000000
tarsus_Intercept:sex2 0.0000000  0.000000  0.000000000 0.000000

, , bwt_Intercept:sex2

                      Estimate Est.Error      Q2.5    Q97.5
bwt_Intercept:sex1    0.000000  0.000000 0.0000000 0.000000
tarsus_Intercept:sex1 0.000000  0.000000 0.0000000 0.000000
bwt_Intercept:sex2    2.020544  0.639550 0.8816577 3.362416
tarsus_Intercept:sex2 3.875299  1.298562 1.4247624 6.415724

, , tarsus_Intercept:sex2

                       Estimate Est.Error     Q2.5     Q97.5
bwt_Intercept:sex1     0.000000  0.000000 0.000000  0.000000
tarsus_Intercept:sex1  0.000000  0.000000 0.000000  0.000000
bwt_Intercept:sex2     3.875299  1.298562 1.424762  6.415724
tarsus_Intercept:sex2 12.664149  4.814957 3.848544 21.345370



$byear
$byear$sd
                  Estimate Est.Error      Q2.5    Q97.5
bwt_Intercept    0.9707654 0.1478361 0.7256973 1.298668
tarsus_Intercept 2.0073203 0.3290043 1.4102530 2.699770

$byear$cor
, , bwt_Intercept

                     Estimate Est.Error       Q2.5     Q97.5
bwt_Intercept     1.000000000 0.0000000  1.0000000 1.0000000
tarsus_Intercept -0.001551923 0.2236193 -0.4237849 0.4526618

, , tarsus_Intercept

                     Estimate Est.Error       Q2.5     Q97.5
bwt_Intercept    -0.001551923 0.2236193 -0.4237849 0.4526618
tarsus_Intercept  1.000000000 0.0000000  1.0000000 1.0000000


$byear$cov
, , bwt_Intercept

                  Estimate Est.Error       Q2.5    Q97.5
bwt_Intercept    0.9642191 0.3021042  0.5266366 1.686538
tarsus_Intercept 0.0252866 0.4713288 -0.8080314 1.069567

, , tarsus_Intercept

                  Estimate Est.Error       Q2.5    Q97.5
bwt_Intercept    0.0252866 0.4713288 -0.8080314 1.069567
tarsus_Intercept 4.1374703 1.3676889  1.9888135 7.288761



$mother
$mother$sd
                 Estimate Est.Error      Q2.5    Q97.5
bwt_Intercept    1.189902 0.1113270 0.9791374 1.423333
tarsus_Intercept 2.139290 0.2985875 1.5714814 2.708199

$mother$cor
, , bwt_Intercept

                   Estimate Est.Error       Q2.5      Q97.5
bwt_Intercept     1.0000000 0.0000000  1.0000000  1.0000000
tarsus_Intercept -0.5501934 0.2066985 -0.9589938 -0.1591737

, , tarsus_Intercept

                   Estimate Est.Error       Q2.5      Q97.5
bwt_Intercept    -0.5501934 0.2066985 -0.9589938 -0.1591737
tarsus_Intercept  1.0000000 0.0000000  1.0000000  1.0000000


$mother$cov
, , bwt_Intercept

                  Estimate Est.Error      Q2.5      Q97.5
bwt_Intercept     1.428247 0.2672833  0.958710  2.0258758
tarsus_Intercept -1.335450 0.3932707 -2.051866 -0.5146954

, , tarsus_Intercept

                  Estimate Est.Error      Q2.5      Q97.5
bwt_Intercept    -1.335450 0.3932707 -2.051866 -0.5146954
tarsus_Intercept  4.665626 1.2688941  2.469554  7.3343400</code></pre>
</div>
</div>
<p>Evaluation of the statistical support for these sex-specific correlations is straightforward. Because we imposed no constraint on their estimation, we can evaluate the extent to which the posterior distributions overlap zero or overlap each other:</p>
<div class="cell">
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cor_g_F</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">as.mcmc</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">brms_m2.4</span>, summary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">animal</span><span class="op">$</span><span class="va">cor</span><span class="op">[</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cor_g_M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">as.mcmc</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">brms_m2.4</span>, summary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">animal</span><span class="op">$</span><span class="va">cor</span><span class="op">[</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_g_F</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 1:1000
Thinning interval = 1 
Number of chains = 1 
Sample size per chain = 1000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

          Mean             SD       Naive SE Time-series SE 
       0.27734        0.51195        0.01619        0.05981 

2. Quantiles for each variable:

    2.5%      25%      50%      75%    97.5% 
-0.84800 -0.02476  0.43226  0.67124  0.93982 </code></pre>
</div>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_g_M</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 1:1000
Thinning interval = 1 
Number of chains = 1 
Sample size per chain = 1000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

          Mean             SD       Naive SE Time-series SE 
      0.778166       0.098502       0.003115       0.013827 

2. Quantiles for each variable:

  2.5%    25%    50%    75%  97.5% 
0.5640 0.7240 0.7805 0.8424 0.9700 </code></pre>
</div>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cor_g_F</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cor_g_M</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-18-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here a plot to visualize the overlaps of covariances.</p>
<div class="cell">
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cor.est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_g_F</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_g_F</span><span class="op">)</span><span class="op">$</span><span class="va">quantiles</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_g_F</span><span class="op">)</span><span class="op">$</span><span class="va">quantiles</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_g_M</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_g_M</span><span class="op">)</span><span class="op">$</span><span class="va">quantiles</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cor_g_M</span><span class="op">)</span><span class="op">$</span><span class="va">quantiles</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">~</span> <span class="va">cor.est</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2.5</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">17</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">2</span>, yaxt <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>y0 <span class="op">=</span> <span class="fl">1</span>, x0 <span class="op">=</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span>, y1 <span class="op">=</span> <span class="fl">1</span>, x1 <span class="op">=</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">]</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>y0 <span class="op">=</span> <span class="fl">2</span>, x0 <span class="op">=</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span>, y1 <span class="op">=</span> <span class="fl">2</span>, x1 <span class="op">=</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">]</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"Covariance (±CI)"</span>, side <span class="op">=</span> <span class="fl">1</span>, las <span class="op">=</span> <span class="fl">1</span>, adj <span class="op">=</span> <span class="fl">0.4</span>, line <span class="op">=</span> <span class="fl">3</span>, cex <span class="op">=</span> <span class="fl">1.6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">2</span>, at <span class="op">=</span> <span class="fl">1</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"female"</span><span class="op">)</span>, las <span class="op">=</span> <span class="fl">3</span>, cex.axis <span class="op">=</span> <span class="fl">1.6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">2</span>, at <span class="op">=</span> <span class="fl">2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"male"</span><span class="op">)</span>, las <span class="op">=</span> <span class="fl">3</span>, cex.axis <span class="op">=</span> <span class="fl">1.6</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here a simple plot of the sex-specific genetic correlation using the BLUPs</p>
<div class="cell">
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bls_m2.4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/random.effects.html">ranef</a></span><span class="op">(</span><span class="va">brms_m2.4</span><span class="op">)</span><span class="op">$</span><span class="va">animal</span></span>
<span><span class="va">bl_m2.4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu">abind</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/abind/man/abind.html">abind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">bls_m2.4</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">bls_m2.4</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>, <span class="va">x</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">bl_m2.4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span><span class="op">(</span><span class="va">bls_m2.4</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"_lo"</span>, <span class="st">"_up"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bl_m2.4</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">bl_m2.4</span><span class="op">)</span></span>
<span><span class="va">bl_m2.4</span><span class="op">$</span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span><span class="op">(</span><span class="va">bls_m2.4</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">"by"</span><span class="op">)</span></span>
<span><span class="va">FEM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">bl_m2.4</span>, <span class="va">sex</span> <span class="op">==</span> <span class="st">"1"</span><span class="op">)</span></span>
<span><span class="va">MAL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">bl_m2.4</span>, <span class="va">sex</span> <span class="op">==</span> <span class="st">"2"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">tarsus_Intercept</span> <span class="op">~</span> <span class="va">bwt_Intercept</span>, <span class="va">FEM</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">FEM</span><span class="op">$</span><span class="va">bwt_Intercept_lo</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">FEM</span><span class="op">$</span><span class="va">bwt_Intercept_up</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">FEM</span><span class="op">$</span><span class="va">tarsus_Intercept_lo</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">FEM</span><span class="op">$</span><span class="va">tarsus_Intercept_up</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  las <span class="op">=</span> <span class="fl">1.2</span>, type <span class="op">=</span> <span class="st">"n"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span></span>
<span>  x0 <span class="op">=</span> <span class="va">FEM</span><span class="op">$</span><span class="va">bwt_Intercept</span>, y0 <span class="op">=</span> <span class="va">FEM</span><span class="op">$</span><span class="va">tarsus_Intercept_lo</span>,</span>
<span>  x1 <span class="op">=</span> <span class="va">FEM</span><span class="op">$</span><span class="va">bwt_Intercept</span>, y1 <span class="op">=</span> <span class="va">FEM</span><span class="op">$</span><span class="va">tarsus_Intercept_up</span>,</span>
<span>  col <span class="op">=</span> <span class="st">"black"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span></span>
<span>  x0 <span class="op">=</span> <span class="va">FEM</span><span class="op">$</span><span class="va">bwt_Intercept_lo</span>, y0 <span class="op">=</span> <span class="va">FEM</span><span class="op">$</span><span class="va">tarsus_Intercept</span>,</span>
<span>  x1 <span class="op">=</span> <span class="va">FEM</span><span class="op">$</span><span class="va">bwt_Intercept_up</span>, y1 <span class="op">=</span> <span class="va">FEM</span><span class="op">$</span><span class="va">tarsus_Intercept</span>,</span>
<span>  col <span class="op">=</span> <span class="st">"black"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">tarsus_Intercept</span> <span class="op">~</span> <span class="va">bwt_Intercept</span>, <span class="va">FEM</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="st">"red"</span>, cex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">tarsus_Intercept</span> <span class="op">~</span> <span class="va">bwt_Intercept</span>, <span class="va">FEM</span>, pch <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.3</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"btw (BV±CI)"</span>, side <span class="op">=</span> <span class="fl">1</span>, line <span class="op">=</span> <span class="fl">2.4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"tarsus (BV±CI)"</span>, side <span class="op">=</span> <span class="fl">2</span>, line <span class="op">=</span> <span class="fl">2</span>, las <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">tarsus_Intercept</span> <span class="op">~</span> <span class="va">bwt_Intercept</span>, <span class="va">MAL</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">MAL</span><span class="op">$</span><span class="va">bwt_Intercept_lo</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">MAL</span><span class="op">$</span><span class="va">bwt_Intercept_up</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">MAL</span><span class="op">$</span><span class="va">tarsus_Intercept_lo</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">MAL</span><span class="op">$</span><span class="va">tarsus_Intercept_up</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  las <span class="op">=</span> <span class="fl">1.2</span>, type <span class="op">=</span> <span class="st">"n"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span></span>
<span>  x0 <span class="op">=</span> <span class="va">MAL</span><span class="op">$</span><span class="va">bwt_Intercept</span>, y0 <span class="op">=</span> <span class="va">MAL</span><span class="op">$</span><span class="va">tarsus_Intercept_lo</span>,</span>
<span>  x1 <span class="op">=</span> <span class="va">MAL</span><span class="op">$</span><span class="va">bwt_Intercept</span>, y1 <span class="op">=</span> <span class="va">MAL</span><span class="op">$</span><span class="va">tarsus_Intercept_up</span>, col <span class="op">=</span> <span class="st">"black"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span></span>
<span>  x0 <span class="op">=</span> <span class="va">MAL</span><span class="op">$</span><span class="va">bwt_Intercept_lo</span>, y0 <span class="op">=</span> <span class="va">MAL</span><span class="op">$</span><span class="va">tarsus_Intercept</span>,</span>
<span>  x1 <span class="op">=</span> <span class="va">MAL</span><span class="op">$</span><span class="va">bwt_Intercept_up</span>, y1 <span class="op">=</span> <span class="va">MAL</span><span class="op">$</span><span class="va">tarsus_Intercept</span>, col <span class="op">=</span> <span class="st">"black"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">tarsus_Intercept</span> <span class="op">~</span> <span class="va">bwt_Intercept</span>, <span class="va">MAL</span>, pch <span class="op">=</span> <span class="fl">17</span>, col <span class="op">=</span> <span class="st">"blue"</span>, cex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">tarsus_Intercept</span> <span class="op">~</span> <span class="va">bwt_Intercept</span>, <span class="va">MAL</span>, pch <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.3</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"btw (BV±CI)"</span>, side <span class="op">=</span> <span class="fl">1</span>, line <span class="op">=</span> <span class="fl">2.4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"tarsus (BV±CI)"</span>, side <span class="op">=</span> <span class="fl">2</span>, line <span class="op">=</span> <span class="fl">2</span>, las <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="between-groups-covariances-and-the-b-matrix" class="level3" data-number="10.0.4"><h3 data-number="10.0.4" class="anchored" data-anchor-id="between-groups-covariances-and-the-b-matrix">
<span class="header-section-number">10.0.4</span> Between groups (co)variances and the B-matrix</h3>
<p>Animal models are amazing model. With different group within a population, it is also possible to estimate how much the different groups shared the same genetic via the cross-group genetic covariance. This covariance is essential to understand ontogenic or sexual conflict, which can constraint or enhanced response to evolution. As an example, we estimate the cross-sex genetic correlation <code>r_{fm}</code></p>
<p>It is important to keep in mind the covariance matrix at the residual level is zero and it is important to avoid estimating the cross-sex residual covariance because no individual switched sex during the experiment.</p>
<p>Note: the way of partitionning variance per sex is a bit different then the previous code “,by=sex”.<br>
This code is faster and also easier to understand. Note, it is possible to play with the <code>|</code> or <code>||</code> to estimate or not covariance between sexes.</p>
<div class="cell">
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bf_bwt_5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula.html">bf</a></span><span class="op">(</span></span>
<span>  <span class="va">bwt</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="op">(</span><span class="fl">0</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">|</span> <span class="va">a</span> <span class="op">|</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/gr.html">gr</a></span><span class="op">(</span><span class="va">animal</span>, cov <span class="op">=</span> <span class="va">Amat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">0</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">|</span> <span class="va">b</span> <span class="op">|</span> <span class="va">mother</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">0</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">|</span> <span class="va">c</span> <span class="op">|</span> <span class="va">byear</span><span class="op">)</span>,</span>
<span>  <span class="va">sigma</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">bf_tarsus_5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula.html">bf</a></span><span class="op">(</span></span>
<span>  <span class="va">tarsus</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="op">(</span><span class="fl">0</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">|</span> <span class="va">a</span> <span class="op">|</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/gr.html">gr</a></span><span class="op">(</span><span class="va">animal</span>, cov <span class="op">=</span> <span class="va">Amat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">0</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">|</span> <span class="va">b</span> <span class="op">|</span> <span class="va">mother</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">0</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">|</span> <span class="va">c</span> <span class="op">|</span> <span class="va">byear</span><span class="op">)</span>,</span>
<span>  <span class="va">sigma</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">brms_m2.5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brm.html">brm</a></span><span class="op">(</span></span>
<span>  <span class="va">bf_bwt_5</span> <span class="op">+</span> <span class="va">bf_tarsus_5</span> <span class="op">+</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula-helpers.html">set_rescor</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gryphon</span>,</span>
<span>  data2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Amat <span class="op">=</span> <span class="va">Amat</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">2</span>, cores <span class="op">=</span> <span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">brms_m2.5</span>, file <span class="op">=</span> <span class="st">"data/brms_m2_5.rda"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Again we have provided the data from one such run. It can be accessed using the code:</p>
<div class="cell">
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/brms_m2_5.rda"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">brms_m2.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Parts of the model have not converged (some Rhats are &gt; 1.05). Be
careful when analysing the results! We recommend running more iterations and/or
setting stronger priors.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 45 divergent transitions after warmup. Increasing
adapt_delta above 0.8 may help. See
http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: MV(gaussian, gaussian) 
  Links: mu = identity; sigma = log
         mu = identity; sigma = log 
Formula: bwt ~ 1 + sex + (0 + sex | a | gr(animal, cov = Amat)) + (0 + sex | b | mother) + (0 + sex | c | byear) 
         sigma ~ sex - 1
         tarsus ~ 1 + sex + (0 + sex | a | gr(animal, cov = Amat)) + (0 + sex | b | mother) + (0 + sex | c | byear) 
         sigma ~ sex - 1
   Data: gryphon (Number of observations: 683) 
  Draws: 2 chains, each with iter = 1000; warmup = 500; thin = 1;
         total post-warmup draws = 1000

Group-Level Effects: 
~animal (Number of levels: 683) 
                             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
sd(bwt_sex1)                     1.26      0.30     0.63     1.73 1.06       21
sd(bwt_sex2)                     1.08      0.42     0.20     1.77 1.08       18
sd(tarsus_sex1)                  2.26      0.72     0.61     3.57 1.04       40
sd(tarsus_sex2)                  2.74      1.05     0.61     4.47 1.13       12
cor(bwt_sex1,bwt_sex2)           0.48      0.29    -0.24     0.87 1.02       84
cor(bwt_sex1,tarsus_sex1)        0.57      0.25    -0.07     0.89 1.14       10
cor(bwt_sex2,tarsus_sex1)        0.38      0.38    -0.53     0.91 1.25        7
cor(bwt_sex1,tarsus_sex2)        0.17      0.31    -0.49     0.75 1.04       60
cor(bwt_sex2,tarsus_sex2)        0.52      0.33    -0.37     0.87 1.20        8
cor(tarsus_sex1,tarsus_sex2)     0.44      0.29    -0.30     0.87 1.03       47
                             Tail_ESS
sd(bwt_sex1)                      104
sd(bwt_sex2)                       25
sd(tarsus_sex1)                    99
sd(tarsus_sex2)                    42
cor(bwt_sex1,bwt_sex2)            112
cor(bwt_sex1,tarsus_sex1)         145
cor(bwt_sex2,tarsus_sex1)          67
cor(bwt_sex1,tarsus_sex2)          94
cor(bwt_sex2,tarsus_sex2)          50
cor(tarsus_sex1,tarsus_sex2)       44

~byear (Number of levels: 34) 
                             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
sd(bwt_sex1)                     0.80      0.16     0.53     1.16 1.00      394
sd(bwt_sex2)                     1.14      0.19     0.81     1.55 1.01      358
sd(tarsus_sex1)                  2.23      0.46     1.50     3.18 1.01      297
sd(tarsus_sex2)                  2.34      0.49     1.56     3.41 1.01      229
cor(bwt_sex1,bwt_sex2)           0.74      0.15     0.35     0.96 1.01      266
cor(bwt_sex1,tarsus_sex1)       -0.11      0.24    -0.55     0.35 1.01      190
cor(bwt_sex2,tarsus_sex1)       -0.39      0.20    -0.73     0.00 1.01      410
cor(bwt_sex1,tarsus_sex2)        0.29      0.23    -0.17     0.71 1.00      256
cor(bwt_sex2,tarsus_sex2)        0.29      0.21    -0.16     0.66 1.01      327
cor(tarsus_sex1,tarsus_sex2)     0.52      0.19     0.12     0.84 1.00      285
                             Tail_ESS
sd(bwt_sex1)                      619
sd(bwt_sex2)                      653
sd(tarsus_sex1)                   559
sd(tarsus_sex2)                   239
cor(bwt_sex1,bwt_sex2)            433
cor(bwt_sex1,tarsus_sex1)         603
cor(bwt_sex2,tarsus_sex1)         656
cor(bwt_sex1,tarsus_sex2)         319
cor(bwt_sex2,tarsus_sex2)         474
cor(tarsus_sex1,tarsus_sex2)      600

~mother (Number of levels: 352) 
                             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
sd(bwt_sex1)                     1.08      0.15     0.79     1.39 1.01      281
sd(bwt_sex2)                     1.33      0.15     1.03     1.62 1.00      233
sd(tarsus_sex1)                  2.21      0.40     1.36     2.95 1.01       72
sd(tarsus_sex2)                  2.31      0.49     1.38     3.34 1.05       50
cor(bwt_sex1,bwt_sex2)           0.83      0.11     0.57     0.98 1.01       68
cor(bwt_sex1,tarsus_sex1)       -0.50      0.24    -0.91    -0.07 1.01       57
cor(bwt_sex2,tarsus_sex1)       -0.64      0.17    -0.93    -0.28 1.06       50
cor(bwt_sex1,tarsus_sex2)       -0.51      0.22    -0.88    -0.08 1.05       67
cor(bwt_sex2,tarsus_sex2)       -0.36      0.26    -0.84     0.11 1.05       54
cor(tarsus_sex1,tarsus_sex2)     0.72      0.16     0.37     0.95 1.01      249
                             Tail_ESS
sd(bwt_sex1)                      518
sd(bwt_sex2)                      585
sd(tarsus_sex1)                   224
sd(tarsus_sex2)                   191
cor(bwt_sex1,bwt_sex2)            296
cor(bwt_sex1,tarsus_sex1)         156
cor(bwt_sex2,tarsus_sex1)         268
cor(bwt_sex1,tarsus_sex2)         124
cor(bwt_sex2,tarsus_sex2)         297
cor(tarsus_sex1,tarsus_sex2)      596

Population-Level Effects: 
                  Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
bwt_Intercept         6.18      0.22     5.81     6.66 1.01      421      413
tarsus_Intercept     20.24      0.55    19.12    21.25 1.01      497      527
bwt_sex2              2.11      0.24     1.61     2.57 1.01      541      569
sigma_bwt_sex1        0.27      0.20    -0.16     0.56 1.08       18       66
sigma_bwt_sex2        0.31      0.23    -0.35     0.59 1.11       18       22
tarsus_sex2           0.29      0.63    -0.96     1.56 1.00      490      535
sigma_tarsus_sex1     1.26      0.12     1.01     1.47 1.02       50      109
sigma_tarsus_sex2     1.28      0.20     0.80     1.53 1.13       12       42

Residual Correlations: 
                   Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
rescor(bwt,tarsus)     0.88      0.05     0.71     0.95 1.32        5       33

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">brms_m2.5</span>, ask <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-23-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-23-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-23-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-23-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-23-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-23-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-23-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">brms_m2.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$animal
$animal$sd
            Estimate Est.Error      Q2.5    Q97.5
bwt_sex1    1.256797 0.3027123 0.6293789 1.733715
bwt_sex2    1.077842 0.4168427 0.1958640 1.767136
tarsus_sex1 2.259727 0.7239967 0.6135135 3.567762
tarsus_sex2 2.744785 1.0537686 0.6051135 4.468542

$animal$cor
, , bwt_sex1

             Estimate Est.Error        Q2.5     Q97.5
bwt_sex1    1.0000000 0.0000000  1.00000000 1.0000000
bwt_sex2    0.4823461 0.2872049 -0.23539931 0.8699222
tarsus_sex1 0.5711397 0.2473353 -0.06616842 0.8936581
tarsus_sex2 0.1685774 0.3102320 -0.48914110 0.7539686

, , bwt_sex2

             Estimate Est.Error       Q2.5     Q97.5
bwt_sex1    0.4823461 0.2872049 -0.2353993 0.8699222
bwt_sex2    1.0000000 0.0000000  1.0000000 1.0000000
tarsus_sex1 0.3772862 0.3765302 -0.5312556 0.9085651
tarsus_sex2 0.5246223 0.3336679 -0.3678213 0.8692250

, , tarsus_sex1

             Estimate Est.Error        Q2.5     Q97.5
bwt_sex1    0.5711397 0.2473353 -0.06616842 0.8936581
bwt_sex2    0.3772862 0.3765302 -0.53125561 0.9085651
tarsus_sex1 1.0000000 0.0000000  1.00000000 1.0000000
tarsus_sex2 0.4401433 0.2929178 -0.29616405 0.8720453

, , tarsus_sex2

             Estimate Est.Error       Q2.5     Q97.5
bwt_sex1    0.1685774 0.3102320 -0.4891411 0.7539686
bwt_sex2    0.5246223 0.3336679 -0.3678213 0.8692250
tarsus_sex1 0.4401433 0.2929178 -0.2961641 0.8720453
tarsus_sex2 1.0000000 0.0000000  1.0000000 1.0000000


$animal$cov
, , bwt_sex1

             Estimate Est.Error        Q2.5    Q97.5
bwt_sex1    1.6710810 0.7317405  0.39611874 3.005768
bwt_sex2    0.7428820 0.5579922 -0.10600955 2.049110
tarsus_sex1 1.8733421 1.2159805 -0.05815667 4.340959
tarsus_sex2 0.6471034 1.0646022 -1.25297349 2.930019

, , bwt_sex2

            Estimate Est.Error        Q2.5    Q97.5
bwt_sex1    0.742882 0.5579922 -0.10600955 2.049110
bwt_sex2    1.335327 0.8557561  0.03836336 3.122771
tarsus_sex1 1.105102 1.0991534 -0.68104784 3.388813
tarsus_sex2 2.171388 1.8198507 -0.18718074 5.946047

, , tarsus_sex1

            Estimate Est.Error        Q2.5     Q97.5
bwt_sex1    1.873342  1.215980 -0.05815667  4.340959
bwt_sex2    1.105102  1.099153 -0.68104784  3.388813
tarsus_sex1 5.630014  3.143741  0.37639882 12.728924
tarsus_sex2 3.150235  2.476892 -0.67170548  8.755673

, , tarsus_sex2

             Estimate Est.Error       Q2.5     Q97.5
bwt_sex1    0.6471034  1.064602 -1.2529735  2.930019
bwt_sex2    2.1713876  1.819851 -0.1871807  5.946047
tarsus_sex1 3.1502347  2.476892 -0.6717055  8.755673
tarsus_sex2 8.6431609  5.649764  0.3661935 19.967865



$byear
$byear$sd
             Estimate Est.Error      Q2.5    Q97.5
bwt_sex1    0.7989572 0.1620838 0.5318383 1.156162
bwt_sex2    1.1420876 0.1912205 0.8090083 1.549360
tarsus_sex1 2.2286834 0.4609182 1.4995560 3.183107
tarsus_sex2 2.3428101 0.4941316 1.5596304 3.405106

$byear$cor
, , bwt_sex1

              Estimate Est.Error       Q2.5     Q97.5
bwt_sex1     1.0000000 0.0000000  1.0000000 1.0000000
bwt_sex2     0.7404024 0.1542690  0.3534945 0.9558481
tarsus_sex1 -0.1137836 0.2357386 -0.5534464 0.3543949
tarsus_sex2  0.2922708 0.2345550 -0.1749420 0.7113421

, , bwt_sex2

              Estimate Est.Error       Q2.5       Q97.5
bwt_sex1     0.7404024 0.1542690  0.3534945 0.955848060
bwt_sex2     1.0000000 0.0000000  1.0000000 1.000000000
tarsus_sex1 -0.3874250 0.1987378 -0.7323699 0.004258363
tarsus_sex2  0.2937354 0.2059346 -0.1577533 0.659531338

, , tarsus_sex1

              Estimate Est.Error       Q2.5       Q97.5
bwt_sex1    -0.1137836 0.2357386 -0.5534464 0.354394929
bwt_sex2    -0.3874250 0.1987378 -0.7323699 0.004258363
tarsus_sex1  1.0000000 0.0000000  1.0000000 1.000000000
tarsus_sex2  0.5226217 0.1897518  0.1183176 0.839911077

, , tarsus_sex2

             Estimate Est.Error       Q2.5     Q97.5
bwt_sex1    0.2922708 0.2345550 -0.1749420 0.7113421
bwt_sex2    0.2937354 0.2059346 -0.1577533 0.6595313
tarsus_sex1 0.5226217 0.1897518  0.1183176 0.8399111
tarsus_sex2 1.0000000 0.0000000  1.0000000 1.0000000


$byear$cov
, , bwt_sex1

              Estimate Est.Error       Q2.5     Q97.5
bwt_sex1     0.6645776 0.2761781  0.2828520 1.3367115
bwt_sex2     0.6843681 0.2597687  0.2749460 1.2955568
tarsus_sex1 -0.1581409 0.4589758 -1.0281983 0.8339776
tarsus_sex2  0.5456796 0.5013040 -0.3608892 1.5951028

, , bwt_sex2

              Estimate Est.Error       Q2.5       Q97.5
bwt_sex1     0.6843681 0.2597687  0.2749460 1.295556807
bwt_sex2     1.3408929 0.4593417  0.6544951 2.400516888
tarsus_sex1 -1.0167438 0.6693667 -2.4775184 0.009371017
tarsus_sex2  0.8646682 0.7242669 -0.3384814 2.623722863

, , tarsus_sex1

              Estimate Est.Error       Q2.5        Q97.5
bwt_sex1    -0.1581409 0.4589758 -1.0281983  0.833977585
bwt_sex2    -1.0167438 0.6693667 -2.4775184  0.009371017
tarsus_sex1  5.1792626 2.3047474  2.2486683 10.132170288
tarsus_sex2  2.7818157 1.5318128  0.5297591  5.970346660

, , tarsus_sex2

             Estimate Est.Error       Q2.5     Q97.5
bwt_sex1    0.5456796 0.5013040 -0.3608892  1.595103
bwt_sex2    0.8646682 0.7242669 -0.3384814  2.623723
tarsus_sex1 2.7818157 1.5318128  0.5297591  5.970347
tarsus_sex2 5.7326811 2.5639312  2.4324504 11.594758



$mother
$mother$sd
            Estimate Est.Error      Q2.5    Q97.5
bwt_sex1    1.076447 0.1526711 0.7866154 1.390273
bwt_sex2    1.325206 0.1540539 1.0256350 1.621175
tarsus_sex1 2.214033 0.3976449 1.3647309 2.946910
tarsus_sex2 2.310902 0.4940802 1.3795156 3.339175

$mother$cor
, , bwt_sex1

              Estimate Est.Error       Q2.5       Q97.5
bwt_sex1     1.0000000 0.0000000  1.0000000  1.00000000
bwt_sex2     0.8260360 0.1110784  0.5676601  0.97826511
tarsus_sex1 -0.5024557 0.2385053 -0.9137423 -0.06798800
tarsus_sex2 -0.5073494 0.2162931 -0.8806394 -0.07677131

, , bwt_sex2

              Estimate Est.Error       Q2.5      Q97.5
bwt_sex1     0.8260360 0.1110784  0.5676601  0.9782651
bwt_sex2     1.0000000 0.0000000  1.0000000  1.0000000
tarsus_sex1 -0.6373889 0.1744852 -0.9272366 -0.2775698
tarsus_sex2 -0.3593672 0.2577845 -0.8364419  0.1135921

, , tarsus_sex1

              Estimate Est.Error       Q2.5      Q97.5
bwt_sex1    -0.5024557 0.2385053 -0.9137423 -0.0679880
bwt_sex2    -0.6373889 0.1744852 -0.9272366 -0.2775698
tarsus_sex1  1.0000000 0.0000000  1.0000000  1.0000000
tarsus_sex2  0.7206209 0.1561300  0.3688228  0.9518425

, , tarsus_sex2

              Estimate Est.Error       Q2.5       Q97.5
bwt_sex1    -0.5073494 0.2162931 -0.8806394 -0.07677131
bwt_sex2    -0.3593672 0.2577845 -0.8364419  0.11359208
tarsus_sex1  0.7206209 0.1561300  0.3688228  0.95184250
tarsus_sex2  1.0000000 0.0000000  1.0000000  1.00000000


$mother$cov
, , bwt_sex1

             Estimate Est.Error       Q2.5      Q97.5
bwt_sex1     1.182023 0.3330334  0.6187659  1.9328578
bwt_sex2     1.179468 0.2744898  0.6821359  1.7479435
tarsus_sex1 -1.110068 0.4557029 -1.9379754 -0.2103052
tarsus_sex2 -1.223308 0.5582766 -2.3558658 -0.1900476

, , bwt_sex2

              Estimate Est.Error       Q2.5      Q97.5
bwt_sex1     1.1794683 0.2744898  0.6821359  1.7479435
bwt_sex2     1.7798788 0.4088241  1.0519272  2.6282093
tarsus_sex1 -1.8437371 0.5678929 -2.9129058 -0.7723013
tarsus_sex2 -0.9438083 0.6393327 -2.0044262  0.4581811

, , tarsus_sex1

             Estimate Est.Error      Q2.5      Q97.5
bwt_sex1    -1.110068 0.4557029 -1.937975 -0.2103052
bwt_sex2    -1.843737 0.5678929 -2.912906 -0.7723013
tarsus_sex1  5.059904 1.7495725  1.862491  8.6842757
tarsus_sex2  3.692391 1.3309441  1.432767  6.5202798

, , tarsus_sex2

              Estimate Est.Error      Q2.5      Q97.5
bwt_sex1    -1.2233079 0.5582766 -2.355866 -0.1900476
bwt_sex2    -0.9438083 0.6393327 -2.004426  0.4581811
tarsus_sex1  3.6923914 1.3309441  1.432767  6.5202798
tarsus_sex2  5.5841373 2.3245515  1.903063 11.1500916</code></pre>
</div>
</div>
<p>The cross-sex genetic correlation can estimate form the output of the model. For tarsus length at fledging, sexes shared a lot of genetic variance which is commun for a trait with low sexual dimorphism. If the selection is antagonistic between males and females, sexes can not evolve freely from the other sexes and a intralocus sexual conflict can appeared.</p>
<div class="cell">
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cross_sex.cor.btw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">as.mcmc</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">brms_m2.5</span>, summary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">animal</span><span class="op">$</span><span class="va">cor</span><span class="op">[</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cross_sex.cor.tarsus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">as.mcmc</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">brms_m2.5</span>, summary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">animal</span><span class="op">$</span><span class="va">cor</span><span class="op">[</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cross_sex.cor.btw</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 1:1000
Thinning interval = 1 
Number of chains = 1 
Sample size per chain = 1000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

          Mean             SD       Naive SE Time-series SE 
      0.482346       0.287205       0.009082       0.032430 

2. Quantiles for each variable:

   2.5%     25%     50%     75%   97.5% 
-0.2354  0.3433  0.5365  0.6861  0.8699 </code></pre>
</div>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cross_sex.cor.tarsus</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 1:1000
Thinning interval = 1 
Number of chains = 1 
Sample size per chain = 1000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

          Mean             SD       Naive SE Time-series SE 
      0.440143       0.292918       0.009263       0.048863 

2. Quantiles for each variable:

   2.5%     25%     50%     75%   97.5% 
-0.2962  0.2950  0.4846  0.6419  0.8720 </code></pre>
</div>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cross_sex.cor.btw</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cross_sex.cor.tarsus</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-24-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here, some simple code to extract the BLUP.</p>
<div class="cell">
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bls_m2.5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/random.effects.html">ranef</a></span><span class="op">(</span><span class="va">brms_m2.5</span><span class="op">)</span><span class="op">$</span><span class="va">animal</span></span>
<span><span class="va">bl_m2.5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu">abind</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/abind/man/abind.html">abind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">bls_m2.5</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>, <span class="va">x</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">bl_m2.5</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span><span class="op">(</span><span class="va">bls_m2.5</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"_lo"</span>, <span class="st">"_up"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bl_m2.5</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">bl_m2.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, some simple code to plot the cross-sex genetic correlation.</p>
<div class="cell">
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">bwt_sex2</span> <span class="op">~</span> <span class="va">bwt_sex1</span>, <span class="va">bl_m2.5</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>, las <span class="op">=</span> <span class="fl">1.2</span>, type <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">bl_m2.5</span><span class="op">$</span><span class="va">bwt_sex1_lo</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">bl_m2.5</span><span class="op">$</span><span class="va">bwt_sex1_up</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">bl_m2.5</span><span class="op">$</span><span class="va">bwt_sex2_lo</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">bl_m2.5</span><span class="op">$</span><span class="va">bwt_sex2_up</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">bl_m2.5</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">bwt_sex1</span>, y0 <span class="op">=</span> <span class="va">bwt_sex2_lo</span>, x1 <span class="op">=</span> <span class="va">bwt_sex1</span>, y1 <span class="op">=</span> <span class="va">bwt_sex2_up</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">bl_m2.5</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">bwt_sex1_lo</span>, y0 <span class="op">=</span> <span class="va">bwt_sex2</span>, x1 <span class="op">=</span> <span class="va">bwt_sex1_up</span>, y1 <span class="op">=</span> <span class="va">bwt_sex2</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">bwt_sex2</span> <span class="op">~</span> <span class="va">bwt_sex1</span>, <span class="va">bl_m2.5</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="st">"red"</span>, cex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">bwt_sex2</span> <span class="op">~</span> <span class="va">bwt_sex1</span>, <span class="va">bl_m2.5</span>, pch <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.3</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"bwt male (BV±CI)"</span>, side <span class="op">=</span> <span class="fl">1</span>, line <span class="op">=</span> <span class="fl">2.4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"bwt female (BV±CI)"</span>, side <span class="op">=</span> <span class="fl">2</span>, line <span class="op">=</span> <span class="fl">2</span>, las <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">tarsus_sex2</span> <span class="op">~</span> <span class="va">tarsus_sex1</span>, <span class="va">bl_m2.5</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>, las <span class="op">=</span> <span class="fl">1.2</span>, type <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">bl_m2.5</span><span class="op">$</span><span class="va">tarsus_sex1_lo</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">bl_m2.5</span><span class="op">$</span><span class="va">tarsus_sex1_up</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">bl_m2.5</span><span class="op">$</span><span class="va">tarsus_sex2_lo</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">bl_m2.5</span><span class="op">$</span><span class="va">tarsus_sex2_up</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">bl_m2.5</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">tarsus_sex1</span>, y0 <span class="op">=</span> <span class="va">tarsus_sex2_lo</span>, x1 <span class="op">=</span> <span class="va">tarsus_sex1</span>, y1 <span class="op">=</span> <span class="va">tarsus_sex2_up</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">bl_m2.5</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">tarsus_sex1_lo</span>, y0 <span class="op">=</span> <span class="va">tarsus_sex2</span>, x1 <span class="op">=</span> <span class="va">tarsus_sex1_up</span>, y1 <span class="op">=</span> <span class="va">tarsus_sex2</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">tarsus_sex2</span> <span class="op">~</span> <span class="va">tarsus_sex1</span>, <span class="va">bl_m2.5</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="st">"red"</span>, cex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">tarsus_sex2</span> <span class="op">~</span> <span class="va">tarsus_sex1</span>, <span class="va">bl_m2.5</span>, pch <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.3</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"tarsus male (BV±CI)"</span>, side <span class="op">=</span> <span class="fl">1</span>, line <span class="op">=</span> <span class="fl">2.4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"tarsus female (BV±CI)"</span>, side <span class="op">=</span> <span class="fl">2</span>, line <span class="op">=</span> <span class="fl">2</span>, las <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_04-biv_brms_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Within this model, we also have acces to the rest of the B-matrix. Note, the cross-sex genetic correlation is just the diagonal of the B matrix. For now on, you can explore this matrix and estimate the cross-sex-cross-trait genetic correlation.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-wilson2010" class="csl-entry" role="listitem">
Wilson, A. J., D. Réale, M. N. Clements, M. M. Morrissey, E. Postma, C. A. Walling, L. E. B. Kruuk, and D. H. Nussey. 2010. <a href="https://doi.org/10.1111/j.1365-2656.2009.01639.x">An ecologist’s guide to the animal model</a>. Journal of Animal Ecology 79:13–26.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./03_03-biv_mcmcglmm.html" class="pagination-link" aria-label="MCMCglmm">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">MCMCglmm</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./03_05-biv_stan.html" class="pagination-link" aria-label="stan">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">stan</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>By J Martin &amp; M Videlier</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/juliengamartin/wam_tuto/edit/main/03_04-biv_brms.Rmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/juliengamartin/wam_tuto/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


</body></html>